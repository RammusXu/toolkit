{"config":{"lang":["en","zh"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome","text":"<p>Hello world. It's Rammus, yo!</p>"},{"location":"help/","title":"Help","text":"<p>Tips about writing in mkdocs.</p> <ul> <li>mkdocs.org</li> <li>mkdocs-material<ul> <li>codehilite</li> <li>admonition - note block</li> <li>Pymdown</li> </ul> </li> <li>Writing in Visual Studio Code</li> </ul>"},{"location":"help/#tabs","title":"Tabs","text":"<p>This need pymdownx.tabbed</p> <pre><code>=== \"bash\"\n    ```\n    echo hi\n    ```\n\n\n=== \"python\"\n    ```\n    print('hi')\n    ```\n</code></pre> bashpython <pre><code>echo hi\n</code></pre> <pre><code>print('hi')\n</code></pre>"},{"location":"help/#hightlight","title":"Hightlight","text":"<p>This need pymdownx.mark <pre><code>This is a ==highlight==.\n</code></pre> This is a highlight.</p>"},{"location":"help/#hightlight-code-changes","title":"Hightlight code changes","text":"<p>This need pymdownx.critic</p> <pre><code>location = @gcsfiles {\nlocation @gcsfiles {\n</code></pre>"},{"location":"help/#highlight-code","title":"Highlight Code","text":"<p>This need pymdownx.superfences</p> <pre><code>```yaml hl_lines=\"9 10 11 17\"\nkind: Service\napiVersion: v1\nmetadata:\n  name: dnsmasq\nspec:\n  selector:\n    name: dnsmasq\n  type: LoadBalancer\n  externalIPs:\n  - a.a.a.a\n  - a.a.a.b\n  ports:\n  - name: dnsmasq-udp\n    port: 53\n    protocol: UDP\n    targetPort: dnsmasq-udp\n  # loadBalancerIP: a.a.a.a\n```\n</code></pre> <pre><code>kind: Service\napiVersion: v1\nmetadata:\n  name: dnsmasq\nspec:\n  selector:\n    name: dnsmasq\n  type: LoadBalancer\n  externalIPs:\n  - a.a.a.a\n  - a.a.a.b\n  ports:\n  - name: dnsmasq-udp\n    port: 53\n    protocol: UDP\n    targetPort: dnsmasq-udp\n  # loadBalancerIP: a.a.a.a\n</code></pre>"},{"location":"help/#escape-in-markdown","title":"Escape ``` in markdown","text":"<p>Wrap it by one more ` <pre><code>````\n```yaml\nkind: Service\napiVersion: v1\nmetadata:\n  name: dnsmasq\n```\n````\n</code></pre></p> <pre><code>```yaml\nkind: Service\napiVersion: v1\nmetadata:\n  name: dnsmasq\n```\n</code></pre>"},{"location":"help/#linkreference-to-internal-documents","title":"Link(reference) to internal documents","text":"<pre><code>[Writing in Visual Studio Code](snippets/visual-studio.md)\n[Mac Setup](mac-setup.md)\n[Help](../help.md)\n</code></pre>"},{"location":"help/#table","title":"Table","text":"name num string ram 1 hi mus 12 hh xu 9 jjj"},{"location":"writing-tools/","title":"\u5beb\u4f5c\u5de5\u5177","text":"<p>\u6574\u7406\u4e00\u4e9b\u5e38\u7528\u7684\u5beb\u4f5c\u5de5\u5177\uff0c\u5e6b\u52a9\u500b\u4eba\u5b78\u7fd2\u6216\u662f\u89e3\u91cb\u6587\u7ae0\u3002</p> <ul> <li>xmind: \u5fc3\u667a\u5716 (Mind Map)\u3002</li> <li>hatchful: logo \u7522\u751f\u5668\u3002</li> <li>imagemagick: \u7522\u751f\u6d6e\u6c34\u5370\u3002   <pre><code>docker run --rm -it -v /Users/rammus/workspace/toolkit/docs/Today-I-Learned/img:/workdir avitase/docker-imagemagick:latest /bin/bash -c \"\n  composite -gravity east -dissolve 40 logo.png source.png out.jpg\n\"\n</code></pre></li> </ul>"},{"location":"writing-tools/#_1","title":"\u5c08\u6848\u7ba1\u7406","text":"<ul> <li>clockify: \u7ba1\u7406\u6642\u7a0b\u3001\u82b1\u8cbb\u591a\u5c11\u6642\u9593\u3002(2021)</li> <li>toggl: \u7ba1\u7406\u6642\u7a0b\u3001\u82b1\u8cbb\u591a\u5c11\u6642\u9593\u3001\u6709 chrome \u63d2\u4ef6\u3001\u6709 iOS app\u3001\u53ef\u96e2\u7dda\u64cd\u4f5c\u3002</li> <li>clickup: \u5c08\u6848\u7ba1\u7406\u3001\u8ddf\u591a\u7a2e\u5de5\u5177\u90fd\u53ef\u4ee5\u6574\u5408\u3001\u6709 chrome \u63d2\u4ef6\u3001time tracker</li> <li>notion: \u5c08\u6848\u7ba1\u7406\u5de5\u5177</li> </ul>"},{"location":"Today-I-Learned/2019/","title":"2019","text":"<p>What I learned in 2019.</p>"},{"location":"Today-I-Learned/2019/#2019-12-05","title":"2019-12-05","text":""},{"location":"Today-I-Learned/2019/#local-https-application-service-webhook","title":"\u5728 local \u958b\u767c https application, service, webhook","text":"<p>ref: https://ngrok.com/ <pre><code>brew cask install ngrok\n</code></pre> <pre><code>ngrok authtoken xxxx\nngrok http 4000\n</code></pre></p>"},{"location":"Today-I-Learned/2019/#2019-08-28","title":"2019-08-28","text":""},{"location":"Today-I-Learned/2019/#ctf-hacker-game","title":"CTF - Hacker Game","text":"<ul> <li>https://github.com/samsheff/docker-xsser</li> <li>https://github.com/apsdehal/awesome-ctf</li> </ul>"},{"location":"Today-I-Learned/2019/#2019-05-21","title":"2019-05-21","text":""},{"location":"Today-I-Learned/2019/#mongodb-production-configuration","title":"MongoDB Production Configuration","text":"<p>ref: https://docs.mongodb.com/manual/core/sharded-cluster-components/</p> <ul> <li>Deploy Config Servers as a 3 member replica set</li> <li>Deploy each Shard as a 3 member replica set</li> <li>Deploy one or more mongos routers</li> </ul>"},{"location":"Today-I-Learned/2020/","title":"2020","text":"<p>What I learned in 2020.</p>"},{"location":"Today-I-Learned/2020/#2020-12-17","title":"2020-12-17","text":""},{"location":"Today-I-Learned/2020/#nginx-brotli-behavior","title":"Nginx - brotli behavior","text":"<p><code>gzip_vary       on;</code> will affect <code>brotli_static</code>. <code>brotli_static</code> will look this config.</p>"},{"location":"Today-I-Learned/2020/#2020-12-04","title":"2020-12-04","text":""},{"location":"Today-I-Learned/2020/#gcp-internal-load-balancer-behavior","title":"GCP - Internal Load Balancer Behavior","text":"<p>Internal Load Balancer 192.168.0.101 have a Instance Group contains</p> <ul> <li>192.168.0.3</li> <li>192.168.0.4</li> </ul> <p>in 192.168.0.3 curl 192.168.0.101, will always request to 192.168.0.3</p> <p>in 192.168.0.4 curl 192.168.0.101, will always request to 192.168.0.4</p>"},{"location":"Today-I-Learned/2020/#2020-12-03","title":"2020-12-03","text":""},{"location":"Today-I-Learned/2020/#cn2-network-go-out-from-china","title":"\bCN2 network - go out from China","text":"<ul> <li>59.43.. is CN2 GIA better</li> <li>202.97.. is CN2 GT</li> </ul> <p>Traceroute from China: https://tools.ipip.net/traceroute.php</p>"},{"location":"Today-I-Learned/2020/#curl-get-current-ip-and-geo-location-in-china","title":"curl - get current ip and geo location in China","text":"<pre><code>curl https://myip.ipip.net\\?json\n\u5f53\u524d IP\uff1a183.240.8.10  \u6765\u81ea\u4e8e\uff1a\u4e2d\u56fd \u5e7f\u4e1c \u5e7f\u5dde  \u79fb\u52a8\n</code></pre>"},{"location":"Today-I-Learned/2020/#kubernetes-resourcememory-mi-vs-m","title":"Kubernetes - resource.memory Mi vs M","text":"<p>Mi = 1024*1024 = 1048576</p> <p>M = 1000*1000 = 1000000</p>"},{"location":"Today-I-Learned/2020/#2020-11-20","title":"2020-11-20","text":""},{"location":"Today-I-Learned/2020/#k9s-install-k9s-on-ubuntu-linux","title":"k9s - Install k9s on Ubuntu Linux","text":"<pre><code>/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)\"\n# brew install derailed/k9s/k9s\nbrew install k9s\n</code></pre> <p>ref:</p> <ul> <li>https://brew.sh/</li> <li>https://k9scli.io/topics/install/</li> </ul>"},{"location":"Today-I-Learned/2020/#k3sup","title":"k3sup","text":"<p>https://github.com/alexellis/k3sup <pre><code>curl -sLS https://get.k3sup.dev | sh\nsudo install k3sup /usr/local/bin/\n\nk3sup --help\n</code></pre></p> <pre><code>ssh-keygen -f ~/.ssh/k3s -N \"\"\n</code></pre> <p>Add ssh-rsa.pub https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys#block-project-keys https://console.cloud.google.com/compute/metadata/sshKeys</p> <pre><code>export SSH_USER=rammus\nexport MASTER_IP=10.0.0.2\nk3sup install --ip $MASTER_IP --user $SSH_USER --ssh-key ~/.ssh/k3s\n\nexport KUBECONFIG=/home/rammus_xu/kubeconfig\nkubectl get node -o wide\n\nexport AGENT_IP=10.0.0.3\nk3sup join --ip $AGENT_IP --server-ip $MASTER_IP --user $SSH_USER --ssh-key ~/.ssh/k3s\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-11-12","title":"2020-11-12","text":""},{"location":"Today-I-Learned/2020/#kuberntes-pod-injecthijackdebug","title":"Kuberntes - Pod inject/hijack/debug","text":"<pre><code>        command: [\"/bin/sh\", \"-c\"]\n        args:\n        - |\n          tail -f /dev/null\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-11-10","title":"2020-11-10","text":""},{"location":"Today-I-Learned/2020/#mongodb-not-master-and-slaveokfalse","title":"MongoDB - not master and slaveOk=false","text":"<pre><code>rs0:SECONDARY&gt; show dbs\n...\n    \"errmsg\" : \"not master and slaveOk=false\",\n    \"code\" : 13435,\n    \"codeName\" : \"NotMasterNoSlaveOk\",\n...\n</code></pre> <pre><code>rs0:SECONDARY&gt; rs.slaveOk()\nrs0:SECONDARY&gt; show dbs\nadmin   0.000GB\nconfig  0.000GB\ndemo    0.000GB\nlocal   0.000GB\n</code></pre>"},{"location":"Today-I-Learned/2020/#mongodb-could-not-find-host-matching-read-preference-mode-primary-for-set-rs0","title":"MongoDB - Could not find host matching read preference { mode: \\\"primary\\\" } for set rs0","text":"<pre><code>mongos&gt; sh.addShard( \"rs0/mongo-rs0-0.mongo-rs0.testing-mongo.svc.cluster.local:27017,mongo-rs0-1.mongo-rs0.testing-mongo.svc.cluster.local:27017,mongo-rs0-2.mongo-rs0.testing-mongo.svc.cluster.local:27017\")\n{\n    \"ok\" : 0,\n    \"errmsg\" : \"Could not find host matching read preference { mode: \\\"primary\\\" } for set rs0\",\n    \"code\" : 133,\n    \"codeName\" : \"FailedToSatisfyReadPreference\",\n    \"operationTime\" : Timestamp(1604989375, 2),\n    \"$clusterTime\" : {\n        \"clusterTime\" : Timestamp(1604989377, 1),\n        \"signature\" : {\n            \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"),\n            \"keyId\" : NumberLong(0)\n        }\n    }\n}\n</code></pre> <p>Debug:</p> <ul> <li>config rs seems ok. not error log on mongos</li> <li>mongo mongo-rs0-0.mongo-rs0.testing-mongo.svc.cluster.local:27017 rs0-0, rs0-1 rs0-2 are ok</li> <li>rs0-0 is primary, read/write ok</li> </ul> <p>Solution</p> <p>mongos version and replica set version should be same.</p> <p>This error occurs when:</p> <ul> <li>shardsvr 4.0.20 + mongos 4.0.20 + configsvr 4.0.20 </li> <li>shardsvr 4.0.20 + mongos 4.0.20 + configsvr 4.4 </li> <li>shardsvr 4.0.20 + mongos 4.4 + configsvr 4.4 </li> <li>shardsvr 4.0.20, 3.6.6 mixed + mongos 4.0.20 + configsvr 4.0.20 </li> </ul>"},{"location":"Today-I-Learned/2020/#2020-11-08","title":"2020-11-08","text":""},{"location":"Today-I-Learned/2020/#gke-node-auto-repair","title":"GKE - Node auto repair","text":"<p>https://cloud.google.com/kubernetes-engine/docs/how-to/node-auto-repair</p> <p>GKE \u6703\u5b9a\u671f\u6aa2\u67e5 nodes\uff0c\u5982\u679c\u767c\u751f\u6301\u7e8c\u6027\u7684\u4e0d\u5065\u5eb7\uff0c GKE \u5c07\u6703\u958b\u59cb\u9032\u884c\u4fee\u5fa9\u7684\u7a0b\u5e8f\u3002</p> <p>\u4ee5 Status:<code>Ready</code> \u7576\u4f5c\u57fa\u6e96\uff0c\u4ee5\u4e0b\u60c5\u6cc1\u6703\u8996\u70ba\u4e0d\u5065\u5eb7: - \u9023\u7e8c 10 \u5206\u9418 Status:<code>NotReady</code> - \u9023\u7e8c 10 \u5206\u9418\u6c92\u6709\u4efb\u4f55\u72c0\u614b - boot disk \u7528\u5b8c\u786c\u789f\u7a7a\u9593\uff0c\u8d85\u904e 30 \u5206\u9418</p> <p>\u6aa2\u67e5\u6700\u8fd1\u7684 operations\uff0c\u53ef\u4ee5\u770b\u5230\u6709\u6c92\u6709 <code>auto repair</code>\u3002 <pre><code>gcloud container operations list\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-11-06","title":"2020-11-06","text":""},{"location":"Today-I-Learned/2020/#kubernetes-cusotmize-a-hostname","title":"Kubernetes - Cusotmize a hostname","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  namespace: testing-mongo\n  name: rammus-cf\n  labels:\n    name: rammus-cf\nspec:\n  hostname: rammus\n  subdomain: cf\n  containers:\n  - name: nginx\n    image: nginx\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: cf\nspec:\n  selector:\n    name: rammus-cf\n  clusterIP: None\n</code></pre> <p>\u5728 cluster \u88e1\u9762\u53ef\u4ee5\u7528 <pre><code>curl rammus.cf\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-11-03","title":"2020-11-03","text":""},{"location":"Today-I-Learned/2020/#gke-node-auto-repair-notes","title":"GKE node auto repair notes","text":"<p>https://cloud.google.com/kubernetes-engine/docs/how-to/node-auto-repair</p> <p>GKE \u6703\u5b9a\u671f\u6aa2\u67e5 nodes\uff0c\u5982\u679c\u767c\u751f\u6301\u7e8c\u6027\u7684\u4e0d\u5065\u5eb7\uff0c GKE \u5c07\u6703\u958b\u59cb\u9032\u884c\u4fee\u5fa9\u7684\u7a0b\u5e8f\u3002</p> <p>\u4ee5 Status:<code>Ready</code> \u7576\u4f5c\u57fa\u6e96\uff0c\u4ee5\u4e0b\u60c5\u6cc1\u6703\u8996\u70ba\u4e0d\u5065\u5eb7: - \u9023\u7e8c 10 \u5206\u9418 Status:<code>NotReady</code> - \u9023\u7e8c 10 \u5206\u9418\u6c92\u6709\u4efb\u4f55\u72c0\u614b - boot disk \u7528\u5b8c\u786c\u789f\u7a7a\u9593\uff0c\u8d85\u904e 30 \u5206\u9418</p> <p>Checking command: <pre><code>gcloud container operations list\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-10-30","title":"2020-10-30","text":""},{"location":"Today-I-Learned/2020/#sign-a-gcs-object","title":"Sign a GCS object","text":"<p>This will use <code>gcs-service.json</code> to generate a URL with expired time <code>-d 1m</code>. You can give someone the URL to access <code>gs://rammus.cf/a-file.txt</code>. <pre><code>gsutil signurl -d 1m gcs-service.json gs://rammus.cf/a-file.txt\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-10-22","title":"2020-10-22","text":""},{"location":"Today-I-Learned/2020/#kubernetes-install-godaddy-ssl-certificate-into-secrets-kubernetesiotls","title":"Kubernetes - Install godaddy ssl certificate into secrets kubernetes.io/tls","text":"<pre><code>cat 9faxxxxxxxxxxxxx.crt gd_bundle-g2-g1.crt &gt; chain.crt\nkubectl create secret tls --cert chain.crt --key generated-private-key.txt rammusxu.tw-tls\n</code></pre> <p>Test it on local:</p> <ol> <li>Add domain in /etc/hosts.</li> <li>Test it with CLI. <pre><code>\u274c curl -kv https://localhost/ -H 'Host: rammusxu.tw'\n\ud83d\udc4d curl -kv https://rammusxu.tw\n\n\u274c openssl s_client -showcerts -connect rammusxu.tw:443\n\ud83d\udc4d openssl s_client -showcerts -connect rammusxu.tw:443 -servername rammusxu.tw\n</code></pre></li> </ol>"},{"location":"Today-I-Learned/2020/#2020-10-19","title":"2020-10-19","text":""},{"location":"Today-I-Learned/2020/#nginx-cache-static-with-cache-control","title":"Nginx - Cache static with Cache-Control","text":"<pre><code>        expires max;\n        add_header                      Cache-Control \"public\";\n</code></pre>"},{"location":"Today-I-Learned/2020/#nginx-react-app-serve-spa-htmls","title":"Nginx - React app serve SPA htmls","text":"<p>ref: https://stackoverflow.com/questions/51367160/nginx-tries-to-find-index-html-in-a-directory-according-to-the-uri <pre><code>        root /app;\n        index index.html;\n        location / {\n            try_files $uri $uri/ /index.html;\n        }\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-10-16","title":"2020-10-16","text":""},{"location":"Today-I-Learned/2020/#nginx-automatical-content-type","title":"Nginx - automatical content type","text":"<pre><code>    include    mime.types;\n</code></pre> <p>path: - <code>/usr/local/openresty/nginx/conf/mime.types;</code> - <code>conf/mime.types;</code></p>"},{"location":"Today-I-Learned/2020/#2020-10-07","title":"2020-10-07","text":""},{"location":"Today-I-Learned/2020/#mongodb-install-mongo-cli-on-mac","title":"MongoDB - Install mongo cli on Mac","text":"<p>ref: https://dba.stackexchange.com/questions/196330/is-it-possible-to-install-just-the-mongo-shell</p> <pre><code>brew tap mongodb/brew\nbrew install mongodb-community-shell\n</code></pre>"},{"location":"Today-I-Learned/2020/#mongodb-dump-and-restore","title":"MongoDB - dump and restore","text":"<pre><code>mongodump --gzip --db=test\n# mongorestore &lt;target&gt; &lt;folder&gt;\nmongorestore mongodb://localhost:27017 dump\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-09-30","title":"2020-09-30","text":""},{"location":"Today-I-Learned/2020/#1-nodes-had-volume-node-affinity-conflict","title":"1 node(s) had volume node affinity conflict.","text":"<p>ref: https://cloud.google.com/kubernetes-engine/docs/concepts/persistent-volumes#pd-zones</p> <p>Just add <code>volumeBindingMode: WaitForFirstConsumer</code></p> <p>Solution</p> <pre><code>apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: slow\nprovisioner: kubernetes.io/gce-pd\nparameters:\n  type: pd-standard\n  fstype: ext4\nvolumeBindingMode: WaitForFirstConsumer\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-09-29","title":"2020-09-29","text":""},{"location":"Today-I-Learned/2020/#gke-dont-enable-podpreset","title":"GKE don\u2019t enable podpreset","text":"<p>no matches for kind \"PodPreset\" in version \"settings.k8s.io/v1alpha1</p> <pre><code>kubectl apply -f podpreset.yaml\nerror: unable to recognize \"podpreset.yaml\": no matches for kind \"PodPreset\" in version \"settings.k8s.io/v1alpha1\"\n</code></pre> <p>no settings.k8s.io API <pre><code>$ kubectl api-resources|grep settings.k8s.io\n$ kubectl api-versions|grep settings.k8s.io\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#kubernetes-taint-and-tolerations","title":"kubernetes - Taint and Tolerations","text":"<p>ref: https://godleon.github.io/blog/Kubernetes/k8s-Taints-and-Tolerations/</p> <pre><code>kubectl taint nodes gke-edge-tw-reserved-4c3f498d-068s preemptible=false:NoSchedule\nkubectl taint nodes gke-edge-tw-reserved-4c3f498d-068s preemptible=false:NoExecute\n</code></pre> <p><code>preemptible=false:NoExecute</code> will evicts all pod immediately</p> <p>this means the pod can tolerate a taint node, so it can be deploy <pre><code>  nodeSelector:\n    cloud.google.com/gke-nodepool: reserved\n  tolerations:\n  - key: \"preemptible\"\n    operator: \"Equal\"\n    value: \"false\"\n</code></pre></p> <p>This can\u2019t deploy <pre><code>  nodeSelector:\n    cloud.google.com/gke-nodepool: reserved\n  tolerations:\n  - key: \"preemptible\"\n    operator: \"Equal\"\n    value: \"false\"\n    effect: \"NoSchedule\"\n</code></pre></p> <p>Error Message</p> <pre><code>  conditions:\n  - lastProbeTime: null\n    lastTransitionTime: \"2020-09-29T07:37:03Z\"\n    message: '0/4 nodes are available: 1 node(s) had taint {preemptible: false}, that\n      the pod didn''t tolerate, 3 node(s) didn''t match node selector.'\n    reason: Unschedulable\n    status: \"False\"\n    type: PodScheduled\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-09-17","title":"2020-09-17","text":""},{"location":"Today-I-Learned/2020/#give-a-set-of-files-a-hash-key","title":"Give a set of files a hash key","text":"<pre><code>~ # md5sum a b\nd41d8cd98f00b204e9800998ecf8427e  a\nd41d8cd98f00b204e9800998ecf8427e  b\n~ # md5sum a b | md5sum\nfe84858e5913eaed7bf248d8b25a77d7  -\n~ # md5sum a b | md5sum | cut -b-32\nfe84858e5913eaed7bf248d8b25a77d7\n~ # echo a &gt; a\n~ # md5sum a b | md5sum | cut -b-32\ne849952f425275e21c0d5c46ba2549f5\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-09-10","title":"2020-09-10","text":""},{"location":"Today-I-Learned/2020/#kubernetes-verticalpodautoscaler","title":"Kubernetes - VerticalPodAutoscaler","text":"<p>https://cloud.google.com/kubernetes-engine/docs/how-to/vertical-pod-autoscaling</p> <p>Limitations</p> <p>https://cloud.google.com/kubernetes-engine/docs/concepts/verticalpodautoscaler#limitations_for_vertical_pod_autoscaling</p> <ul> <li>Can\u2019t use with HPA</li> </ul> <pre><code>  updatePolicy:\n    updateMode: \"Off\"\n</code></pre> <pre><code>$ kubectl get vpa my-vpa --output yaml\n...\n  recommendation:\n    containerRecommendations:\n    - containerName: my-container\n      lowerBound:\n        cpu: 536m\n        memory: 262144k\n      target:\n        cpu: 587m\n        memory: 262144k\n      upperBound:\n        cpu: 27854m\n        memory: \"545693548\"\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-09-09","title":"2020-09-09","text":""},{"location":"Today-I-Learned/2020/#disable-gke-release-channel","title":"Disable GKE release channel","text":"<p>ref: https://cloud.google.com/kubernetes-engine/docs/concepts/release-channels#updating_the_cluster_release_channel</p> <p>It's not possible to exit RAPID channel for now.</p> <pre><code>$ gcloud container clusters update edge-tw --release-channel None --region asia-east1\nERROR: (gcloud.container.clusters.update) INVALID_ARGUMENT: Migrating off of releaseChannel RAPID is not supported.\n</code></pre>"},{"location":"Today-I-Learned/2020/#fatal-error-linuxversionh-no-such-file-or-directory","title":"fatal error: linux/version.h: No such file or directory","text":"<pre><code>In file included from config.h:21,\n                 from ae.c:45:\nredis_config.h:38:10: fatal error: linux/version.h: No such file or directory\n   38 | #include &lt;linux/version.h&gt;\n      |          ^~~~~~~~~~~~~~~~~\ncompilation terminated.\nmake[1]: *** [Makefile:190: ae.o] Error 1\nmake[1]: Leaving directory '/redis-cluster-proxy/src'\nmake: *** [Makefile:4: all] Error 2\n</code></pre> <p>Solution</p> <pre><code>apk add linux-headers\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-09-06","title":"2020-09-06","text":""},{"location":"Today-I-Learned/2020/#upgrade-buildx-version-on-mac","title":"Upgrade buildx version on Mac","text":"<p>https://gist.github.com/RammusXu/8eb867e2a2dedd3c07149016829da5c3 <pre><code>docker buildx version\n\nmkdir -p ~/.docker/cli-plugins\nBUILDX_VERSION=\"v0.4.2\"\nwget https://github.com/docker/buildx/releases/download/${BUILDX_VERSION}/buildx-${BUILDX_VERSION}.darwin-amd64 -O ~/.docker/cli-plugins/docker-buildx\nchmod a+x ~/.docker/cli-plugins/docker-buildx\n\ndocker buildx version\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-09-03","title":"2020-09-03","text":""},{"location":"Today-I-Learned/2020/#nginx-change-host-not-found-response-status-and-content","title":"Nginx - Change host not found response status and content","text":"<pre><code>curl localhost:8001/host \"host:backend\"\n</code></pre> <pre><code>location /host {\n    resolver 127.0.0.11;\n    proxy_pass              http://$http_host$uri;\n\n    proxy_cache_key                 $http_host$uri;\n    proxy_cache_valid               200 60s;\n\n    proxy_intercept_errors          on;\n    error_page 502 503 =404 /;\n}\n\nlocation @host_not_found {\n    echo \"not found\";\n}\n</code></pre> <p>Host not found <pre><code>frontend_1  | 172.18.0.1 - - - MISS [03/Sep/2020:09:01:52 +0000] \"GET /host HTTP/1.1\" 404 20 \"-\" \"HTTPie/1.0.2\" \"-\"\nfrontend_1  | 2020/09/03 09:01:52 [error] 6#6: *12 backend2 could not be resolved (3: Host not found), client: 172.18.0.1, server: , request: \"GET /host HTTP/1.1\", host: \"backend2\"\nfrontend_1  | 2020/09/03 09:01:53 [error] 6#6: *13 backend2 could not be resolved (3: Host not found), client: 172.18.0.1, server: , request: \"GET /host HTTP/1.1\", host: \"backend2\"\nfrontend_1  | 172.18.0.1 - - - MISS [03/Sep/2020:09:01:53 +0000] \"GET /host HTTP/1.1\" 404 20 \"-\" \"HTTPie/1.0.2\" \"-\"\n</code></pre></p> <p>Host found <pre><code>backend_1   | 172.18.0.3 - - [03/Sep/2020:09:02:30 +0000] \"GET /host HTTP/1.0\" 200 6 \"-\" \"HTTPie/1.0.2\" \"-\"\nfrontend_1  | 172.18.0.1 - - - MISS [03/Sep/2020:09:02:30 +0000] \"GET /host HTTP/1.1\" 200 16 \"-\" \"HTTPie/1.0.2\" \"-\"\nfrontend_1  | 172.18.0.1 - - - HIT [03/Sep/2020:09:02:38 +0000] \"GET /host HTTP/1.1\" 200 16 \"-\" \"HTTPie/1.0.2\" \"-\"\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-08-27","title":"2020-08-27","text":""},{"location":"Today-I-Learned/2020/#2020-cert-manager-request-a-certificate-with-ingress-in-place","title":"2020 cert-manager request a certificate with ingress in place","text":"<p>ref: https://kosyfrances.github.io/ingress-gce-letsencrypt/</p> <p>Environment</p> <ul> <li>kuberentes: v1.17.9-gke</li> <li>cert-manager: v0.15.0</li> </ul> <pre><code>apiVersion: cert-manager.io/v1alpha2\nkind: ClusterIssuer\nmetadata:\n  name: ci-http01\nspec:\n  acme:\n    email: rammus.xu@gmail.com\n    server: https://acme-v02.api.letsencrypt.org/directory\n    privateKeySecretRef:\n      name: issuer-account-key-rammus\n    solvers:\n      - http01:\n          ingress:\n            class: ingress-gce\n---\napiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  namespace: web\n  name: china-landing\n  annotations:\n    kubernetes.io/ingress.class: \"gce\"\n    cert-manager.io/cluster-issuer: ci-http01\n    acme.cert-manager.io/http01-edit-in-place: \"true\"\nspec:\n  tls:\n    - hosts:\n        - rammus.dev\n      secretName: rammus-dev-tls\n  rules:\n    - host: rammus.dev\n      http:\n        paths:\n          - backend:\n              serviceName: http-service-np\n              servicePort: http\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: http-service-np\n  namespace: web\nspec:\n  type: NodePort\n  ports:\n  - name: http\n    port: 80\n    targetPort: http\n  selector:\n    app: http-app\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-08-21","title":"2020-08-21","text":""},{"location":"Today-I-Learned/2020/#copy-docker-image-to-another-registry","title":"Copy docker image to another registry","text":"<p>ref: https://cloud.google.com/artifact-registry/docs/docker/copy-from-gcr#copy-gcloud</p> <pre><code>gcloud container images add-tag GCR-IMAGE AR-IMAGE\n</code></pre>"},{"location":"Today-I-Learned/2020/#nginx-cors-with-map-example","title":"Nginx - CORS with map example","text":"<p>ref:</p> <ul> <li>https://blog.51cto.com/tchuairen/2175525</li> <li>https://github.com/openresty/headers-more-nginx-module <pre><code>map $http_origin $cors_origin {\n    default               https://rammus.dev;\n    \"~rammus2020.dev\"     $http_origin;\n}\n\nserver {\n    listen 80;\n    location / {\n        more_set_headers Access-Control-Allow-Origin $cors_origin;\n    }\n}\n</code></pre></li> </ul>"},{"location":"Today-I-Learned/2020/#docker-registry-gitlab-registry","title":"Docker Registry - Gitlab Registry","text":"<pre><code>docker pull registry.gitlab.com/rammus.xu/docker-alpine:3.12.0\n</code></pre> <ul> <li>Public git repo = Public docker registry</li> <li>No need to login to pull Gitlab public registry image</li> <li>10GB storage, as part of the repository size limit</li> </ul> <pre><code>docker login registry.gitlab.com -u rammus.xu -p\ndocker pull nginx:1.19.2-alpine\ndocker tag nginx:1.19.2-alpine registry.gitlab.com/rammus.xu/docker-alpine:nginx-1.19.2\ndocker push registry.gitlab.com/rammus.xu/docker-alpine:nginx-1.19.2\n\ndocker pull registry.gitlab.com/rammus.xu/docker-alpine:nginx-1.19.2\n</code></pre>"},{"location":"Today-I-Learned/2020/#docker-registry-github-registry","title":"Docker Registry - Github Registry","text":"<ul> <li>Can't pull without docker credential<ul> <li><code>docker login https://docker.pkg.github.com -u rammusxu -p</code></li> </ul> </li> </ul> <pre><code>docker login https://docker.pkg.github.com -u rammusxu -p\ndocker pull nginx:1.19.2-alpine\ndocker tag nginx:1.19.2-alpine docker.pkg.github.com/rammusxu/docker-alpine/nginx:1.19.2-alpine\ndocker push docker.pkg.github.com/rammusxu/docker-alpine/nginx:1.19.2-alpine\n\ndocker pull docker.pkg.github.com/rammusxu/docker-alpine/nginx:1.19.2-alpine\nError response from daemon: Get https://docker.pkg.github.com/v2/rammusxu/docker-alpine/nginx/manifests/1.19.2-alpine: no basic auth credentials\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-08-19","title":"2020-08-19","text":""},{"location":"Today-I-Learned/2020/#dockerhub-is-rate-limiting-download-layers","title":"Dockerhub is rate limiting download layers","text":"<ul> <li>https://www.docker.com/pricing</li> <li>https://docs.docker.com/docker-hub/download-rate-limit/</li> <li>https://www.docker.com/pricing/retentionfaq</li> <li>https://github.com/testcontainers/testcontainers-java/issues/3099 <p>As of 2020-08-13, Docker have updated their terms of service and pricing page, indicating that:</p> <ul> <li>unauthenticated pulls will be rate limited to 100 per 6h</li> <li>authenticated pulls will be rate limited to 200 per 6h</li> </ul> </li> </ul> <p>Community - https://www.reddit.com/r/docker/comments/i93bui/docker_terms_of_service_change/ - https://www.reddit.com/r/docker/comments/i9lxq3/docker_reduces_image_retaining_to_6_months_for/</p>"},{"location":"Today-I-Learned/2020/#wheres-disk-storage-locationpath-of-gke-emptydir","title":"Where's disk storage location(path) of GKE emptyDir","text":"<pre><code># docker container inspect k8s_packager-public_stream-5ad4d9decc14623f43ed1325_default_247be3c5-227d-46cc-9f9c-7aad8cfaeb47_0 | grep Source\n                \"Source\": \"/var/lib/kubelet/pods/247be3c5-227d-46cc-9f9c-7aad8cfaeb47/volumes/kubernetes.io~empty-dir/dist\",\n                \"Source\": \"/var/lib/kubelet/pods/247be3c5-227d-46cc-9f9c-7aad8cfaeb47/volume-subpaths/workdir/packager-public/1\",\n                \"Source\": \"/var/lib/kubelet/pods/247be3c5-227d-46cc-9f9c-7aad8cfaeb47/volumes/kubernetes.io~secret/default-token-vvrzk\",\n                \"Source\": \"/var/lib/kubelet/pods/247be3c5-227d-46cc-9f9c-7aad8cfaeb47/etc-hosts\",\n                \"Source\": \"/var/lib/kubelet/pods/247be3c5-227d-46cc-9f9c-7aad8cfaeb47/containers/packager-public/0fa5ef38\",\n\n# df /var/lib/kubelet/pods/247be3c5-227d-46cc-9f9c-7aad8cfaeb47 -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda1       2.0T  173G  1.8T   9% /var/lib/kubelet\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-08-12","title":"2020-08-12","text":""},{"location":"Today-I-Learned/2020/#markdown","title":"markdown \u6587\u4ef6\u88fd\u4f5c","text":"<p>https://docsify.js.org/#/</p>"},{"location":"Today-I-Learned/2020/#2020-08-10","title":"2020-08-10","text":""},{"location":"Today-I-Learned/2020/#istio-on-k3d","title":"istio on k3d","text":"<pre><code>curl -L https://istio.io/downloadIstio | sh -\ncp istio-1.6.7/bin/istioctl $HOME/bin/\n\n# ~/.zshrc\nexport PATH=$HOME/bin:/usr/local/bin:$PATH\n\n~ istioctl version\nno running Istio pods in \"istio-system\"\n1.6.7\n</code></pre> <pre><code>brew install k3d\n</code></pre> <pre><code>k3d cluster create dc0 --k3s-server-arg --disable=traefik --publish 8080:80\nk3d cluster create dc1 --port 8081:80 --no-lb --k3s-server-arg --disable=traefik\n</code></pre> <pre><code>kubectl create namespace istio-system\nkubectl create secret generic cacerts -n istio-system \\\n  --from-file=samples/certs/ca-cert.pem \\\n  --from-file=samples/certs/ca-key.pem \\\n  --from-file=samples/certs/root-cert.pem \\\n  --from-file=samples/certs/cert-chain.pem\n\n# Install istio\nistioctl install \\\n    -f manifests/examples/multicluster/values-istio-multicluster-gateways.yaml\n\n# Update coreDNS\nkubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        health\n        ready\n        kubernetes cluster.local in-addr.arpa ip6.arpa {\n           pods insecure\n           upstream\n           fallthrough in-addr.arpa ip6.arpa\n        }\n        prometheus :9153\n        forward . /etc/resolv.conf\n        cache 30\n        loop\n        reload\n        loadbalance\n    }\n    global:53 {\n        errors\n        cache 30\n        forward . $(kubectl get svc -n istio-system istiocoredns -o jsonpath={.spec.clusterIP}):53\n    }\nEOF\n</code></pre> <p>ref: https://dev.to/bufferings/tried-k8s-istio-in-my-local-machine-with-k3d-52gg</p>"},{"location":"Today-I-Learned/2020/#configure-k3d-on-mac-zsh","title":"Configure k3d on Mac zsh","text":"<pre><code>brew instsall k3d\nmkdir -p ~/.oh-my-zsh/custom/plugins/k3d/_k3d\nk3d completion zsh &gt; ~/.oh-my-zsh/custom/plugins/k3d/_k3d\n\nvi ~/.zshrc\nplugins=(... k3d)\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-08-07","title":"2020-08-07","text":""},{"location":"Today-I-Learned/2020/#testing-websocket","title":"Testing websocket","text":"<pre><code>npm install -g wscat\ndocker run -it --rm  -p 10000:8080 jmalloc/echo-server\nwscat -c ws://localhost:10000\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-08-06","title":"2020-08-06","text":""},{"location":"Today-I-Learned/2020/#gcp-monitoring-response-throughput-is-including-cdn-hit","title":"GCP Monitoring - Response Throughput is including CDN hit","text":"<ul> <li>Miss 0</li> <li>Hit 21688/s</li> </ul>"},{"location":"Today-I-Learned/2020/#nginx-add_header-is-not-working-on-indexhtml","title":"Nginx - add_header is not working on index.html","text":"<p> <pre><code>      location / {\n        add_header                      \"Cache-Control\" \"public, max-age=600000\";\n        index index.html;\n      }\n</code></pre></p> <p> <pre><code>      location / {\n        add_header                      \"Cache-Control\" \"public, max-age=600000\";\n        index index.html;\n      }\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#cc-40","title":"CC 4.0 \u8457\u4f5c\u6b0a\u61f6\u4eba\u5305","text":"<p>ref: https://xie.infoq.cn/copyright</p> <pre><code>&lt;a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-nd/4.0/\"&gt;&lt;img alt=\"Creative Commons License\" style=\"border-width:0\" src=\"https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png\" /&gt;&lt;/a&gt;&lt;br /&gt;This work is licensed under a &lt;a rel=\"license\" href=\"http://creativecommons.org/licenses/by-nc-nd/4.0/\"&gt;Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License&lt;/a&gt;.\n</code></pre> <p>This work is licensed under a Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License.</p> <p>\u57fa\u65bc CC 4.0 \u5354\u8b70\u9032\u884c\u5982\u4e0b\u985e\u578b\u6388\u6b0a\uff1a</p> <ul> <li>CC BY\uff08\u7f72\u540d\uff09\uff1a\u53ea\u8981\u5728\u4f7f\u7528\u6642\u7f72\u540d\uff0c\u90a3\u9ebc\u4f7f\u7528\u8005\u53ef\u4ee5\u5c0d\u672c\u5275\u4f5c\u9032\u884c\u8f49\u8f09\u3001\u7bc0\u9078\u3001\u6df7\u7de8\u3001\u4e8c\u6b21\u5275\u4f5c\u4ee5\u53ca\u5546\u696d\u76ee\u7684\u4f7f\u7528\u3002</li> <li>CC BY-NC\uff08\u7f72\u540d+ \u975e\u76c8\u5229\uff09\uff1a\u53ea\u8981\u5728\u4f7f\u7528\u3001\u516c\u958b\u6642\u9032\u884c\u7f72\u540d\uff0c\u90a3\u9ebc\u4f7f\u7528\u8005\u53ef\u4ee5\u5c0d\u672c\u5275\u4f5c\u9032\u884c\u8f49\u8f09\u3001\u7bc0\u9078\u3001\u6df7\u7de8\u3001\u4e8c\u6b21\u5275\u4f5c\uff0c\u4f46\u4e0d\u5f97\u5c07\u672c\u5275\u4f5c\u6216\u7531\u672c\u5275\u4f5c\u884d\u751f\u7684\u5275\u4f5c\u904b\u7528\u65bc\u5546\u696d\u76ee\u7684\u3002</li> <li>CC BY-ND\uff08\u7f72\u540d + \u7981\u6b62\u6f14\u7e79\uff09\uff1a\u53ea\u8981\u5728\u4f7f\u7528\u3001\u516c\u958b\u6642\u9032\u884c\u7f72\u540d\uff0c\u4e26\u4e14\u5c0d\u5275\u4f5c\u4e0d\u52a0\u4efb\u4f55\u6539\u52d5\uff0c\u90a3\u9ebc\u4f7f\u7528\u8005\u53ef\u4ee5\u4f7f\u7528\u672c\u5275\u4f5c\uff0c\u5305\u62ec\u5c07\u5176\u904b\u7528\u65bc\u5546\u696d\u76ee\u7684\u3002</li> <li>CC BY-NC-ND\uff08\u7f72\u540d + \u975e\u76c8\u5229 + \u7981\u6b62\u6f14\u7e79\uff09\uff1a\u4f7f\u7528\u8005\u53ef\u4ee5\u5c0d\u672c\u5275\u4f5c\u9032\u884c\u8f49\u8f09\uff0c\u4f46\u4e0d\u5f97\u5c0d\u672c\u5275\u4f5c\u9032\u884c\u4fee\u6539\uff0c\u4ea6\u4e0d\u5f97\u4f9d\u64da\u672c\u5275\u4f5c\u9032\u884c\u518d\u5275\u4f5c\uff0c\u4e0d\u5f97\u5c07\u672c\u5275\u4f5c\u904b\u7528\u65bc\u5546\u696d\u7528\u9014\u3002</li> <li>CC BY-SA\uff08\u7f72\u540d+ \u7e7c\u627f\uff09\uff1a\u4f7f\u7528\u8005\u53ef\u4ee5\u5c0d\u672c\u5275\u4f5c\u9032\u884c\u8f49\u8f09\u3001\u7bc0\u9078\u3001\u6df7\u7de8\u3001\u4e8c\u6b21\u5275\u4f5c\uff0c\u53ef\u4ee5\u5c07\u5176\u904b\u7528\u65bc\u5546\u696d\u7528\u9014\uff0c\u552f\u9808\u7f72\u540d\u4f5c\u8005\uff0c\u4e26\u4e14\u63a1\u7528\u672c\u5275\u4f5c\u7684\u5167\u5bb9\u5fc5\u9808\u540c\u6a23\u63a1\u7528\u672c\u5354\u8b70\u9032\u884c\u6388\u6b0a\u3002</li> <li>CC BY-NC-SA\uff08\u7f72\u540d+ \u975e\u76c8\u5229+ \u7e7c\u627f\uff09\uff1a\u4f7f\u7528\u8005\u53ef\u4ee5\u5c0d\u672c\u5275\u4f5c\u9032\u884c\u8f49\u8f09\u3001\u7bc0\u9078\u3001\u6df7\u7de8\u3001\u4e8c\u6b21\u5275\u4f5c\uff0c\u4f46\u4e0d\u5f97\u904b\u7528\u65bc\u5546\u696d\u76ee\u7684\uff0c\u4e14\u4f7f\u7528\u6642\u9808\u9032\u884c\u7f72\u540d\uff0c\u63a1\u7528\u672c\u5275\u4f5c\u7684\u5167\u5bb9\u5fc5\u9808\u540c\u6a23\u63a1\u7528\u672c\u5354\u8b70\u9032\u884c\u6388\u6b0a\u3002</li> </ul>"},{"location":"Today-I-Learned/2020/#2020-08-05","title":"2020-08-05","text":""},{"location":"Today-I-Learned/2020/#no-more-google-google-alternatives","title":"No more google - Google alternatives","text":"<p>https://nomoregoogle.com/</p> <p>Privacy-friendly alternatives to Google that don't track you</p>"},{"location":"Today-I-Learned/2020/#2020-08-03","title":"2020-08-03","text":""},{"location":"Today-I-Learned/2020/#service-mesh","title":"Service mesh","text":"<p>https://www.youtube.com/watch?v=-KWvlW9CSn8</p> <ul> <li>Istio</li> <li>Linkerd</li> <li>Kuma</li> <li>Mosn</li> </ul>"},{"location":"Today-I-Learned/2020/#2020-07-30","title":"2020-07-30","text":""},{"location":"Today-I-Learned/2020/#grouped-bar-chart-online","title":"\u88fd\u4f5c grouped bar chart online","text":"<p>https://codepen.io/pen/?&amp;editable=true=https%3A%2F%2Fwww.highcharts.com%2Fsamples%2Fhighcharts%2Fdemo%2Fcolumn-basic%3Fcodepen https://www.highcharts.com/demo</p>"},{"location":"Today-I-Learned/2020/#2020-07-24","title":"2020-07-24","text":""},{"location":"Today-I-Learned/2020/#ab-load-testing-in-alpine-linux","title":"AB load testing in Alpine Linux","text":"<pre><code>apk add apache2-utils\nab -n1000 -c10 -k http://localhost/\n</code></pre>"},{"location":"Today-I-Learned/2020/#to-generate-ecdsa-p-256-certificate-with-step-cli","title":"To generate ECDSA P-256 certificate with step-cli","text":"<p>step-cli: https://smallstep.com/cli/ <pre><code>brew install step\n</code></pre></p> <p>ref: https://linkerd.io/2/tasks/generate-certificates/#trust-anchor-certificate <pre><code>step certificate create identity.linkerd.cluster.local ca.crt ca.key \\\n--profile root-ca --no-password --insecure\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#import-ssl-cert-to-kubernetes-secret","title":"Import ssl cert to kubernetes secret","text":"<pre><code>cat 34_120_61_244.crt IntermediateCA.crt &gt; ip.crt\n\nkubectl create secret tls web-ip1 \\\n  --cert 34_120_61_244.crt \\\n  --key 34_120_61_244.key \\\n  -n web\n</code></pre> <p>update cert <pre><code>kubectl create secret tls web-ip1 \\\n  --cert 34_120_61_244.crt \\\n  --key 34_120_61_244.key \\\n  -n web --dry-run -o yaml \\\n  | kubectl apply -f -\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-07-22","title":"2020-07-22","text":""},{"location":"Today-I-Learned/2020/#nginx-access-control-allow-origin","title":"Nginx - Access-Control-Allow-Origin: *","text":"<p>Good <pre><code>        more_set_headers                \"Access-Control-Allow-Origin: $http_origin\";\n</code></pre></p> <p>Bad <pre><code>        more_set_headers                \"Access-Control-Allow-Origin: *\";\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-07-14","title":"2020-07-14","text":""},{"location":"Today-I-Learned/2020/#is-possible-to-use-ip-address-in-managedcertificate-in-gke","title":"Is possible to use ip address in ManagedCertificate in GKE?","text":"<p>No.</p> <p>Error</p> <pre><code>The ManagedCertificate \"my-ip1\" is invalid: spec.domains: Invalid value: \"\": spec.domains in body should match '^(([a-zA-Z0-9]+|[a-zA-Z0-9][-a-zA-Z0-9]*[a-zA-Z0-9])\\.)+[a-zA-Z][-a-zA-Z0-9]*[a-zA-Z0-9]\\.?$'\n</code></pre> <pre><code>apiVersion: networking.gke.io/v1beta2\nkind: ManagedCertificate\nmetadata:\n  name: my-ip1\nspec:\n  domains:\n    - \"34.120.100.100\"\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-07-06","title":"2020-07-06","text":""},{"location":"Today-I-Learned/2020/#nginx-as-an-forward-proxy-server","title":"Nginx - as an forward proxy server","text":"<p>https://www.alibabacloud.com/blog/how-to-use-nginx-as-an-https-forward-proxy-server_595799 <pre><code>server {\n     listen  443;\n\n     # dns resolver used by forward proxying\n     resolver  114.114.114.114;\n\n     # forward proxy for CONNECT request\n     proxy_connect;\n     proxy_connect_allow            443;\n     proxy_connect_connect_timeout  10s;\n     proxy_connect_read_timeout     10s;\n     proxy_connect_send_timeout     10s;\n\n     # forward proxy for non-CONNECT request\n     location / {\n         proxy_pass http://$host;\n         proxy_set_header Host $host;\n     }\n}\n</code></pre></p> <pre><code>curl https://www.baidu.com -svo /dev/null -x 39.105.196.164:443\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-06-30","title":"2020-06-30","text":""},{"location":"Today-I-Learned/2020/#github-api-delete-branch-with-personal-access-token","title":"Github API - Delete branch with Personal Access Token","text":"<pre><code>export INPUT_AUTH_TOKEN=\nexport GITHUB_REPOSITORY=\nexport GITHUB_HEAD_REF=\n\nhttp DELETE \"https://api.github.com/repos/$GITHUB_REPOSITORY/git/refs/heads/$GITHUB_HEAD_REF\" \\\n    \"Authorization: token $INPUT_AUTH_TOKEN\"\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-06-24","title":"2020-06-24","text":""},{"location":"Today-I-Learned/2020/#linux-get-geo-infomation-in-curl","title":"Linux - Get Geo infomation in curl","text":"<p><pre><code>curl https://ipinfo.io/\n{\n  \"ip\": \"59.124.114.73\",\n  \"hostname\": \"59-124-114-73.hinet-ip.hinet.net\",\n  \"city\": \"Taipei\",\n  \"region\": \"Taiwan\",\n  \"country\": \"TW\",\n  \"loc\": \"25.0478,121.5319\",\n  \"org\": \"AS3462 Data Communication Business Group\",\n  \"timezone\": \"Asia/Taipei\",\n  \"readme\": \"https://ipinfo.io/missingauth\"\n}\n</code></pre> <pre><code>curl ifconfig.co/json\n{\n    \"asn\": \"AS3462\",\n    \"asn_org\": \"Data Communication Business Group\",\n    \"city\": \"Taipei\",\n    \"country\": \"Taiwan\",\n    \"country_eu\": false,\n    \"country_iso\": \"TW\",\n    \"hostname\": \"59-124-114-73.HINET-IP.hinet.net\",\n    \"ip\": \"59.124.114.73\",\n    \"ip_decimal\": 998011465,\n    \"latitude\": 25.0478,\n    \"longitude\": 121.5318,\n    \"region_code\": \"TPE\",\n    \"region_name\": \"Taipei City\",\n    \"time_zone\": \"Asia/Taipei\",\n    \"user_agent\": {\n        \"product\": \"HTTPie\",\n        \"raw_value\": \"HTTPie/1.0.2\",\n        \"version\": \"1.0.2\"\n    }\n}\n</code></pre></p> <pre><code>curl -s https://ipvigilante.com/$(curl -s https://ipinfo.io/ip)\n{\"status\":\"success\",\"data\":{\"ipv4\":\"59.124.114.73\",\"continent_name\":\"Asia\",\"country_name\":\"Taiwan\",\"subdivision_1_name\":null,\"subdivision_2_name\":null,\"city_name\":null,\"latitude\":\"23.50000\",\"longitude\":\"121.00000\"}}\n</code></pre>"},{"location":"Today-I-Learned/2020/#nginx-ingress-will-use-default-fake-certificate","title":"Nginx Ingress will use default fake certificate","text":"<pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  namespace: staging\n  name: demo\n  annotations:\n    kubernetes.io/ingress.class: \"nginx\"\n    nginx.ingress.kubernetes.io/ssl-redirect: \"false\" # Default:true\nspec:\n  tls:\n  - secretName: staging-tls\n  rules:\n  - http:\n      paths:\n      - backend:\n          serviceName: demo-web\n          servicePort: http\n</code></pre> <pre><code>curl -kvL https://api.r-live.swaggg.dev\n\n* Server certificate:\n*  subject: O=Acme Co; CN=Kubernetes Ingress Controller Fake Certificate\n*  start date: Jun 24 04:25:00 2020 GMT\n*  expire date: Jun 24 04:25:00 2021 GMT\n*  issuer: O=Acme Co; CN=Kubernetes Ingress Controller Fake Certificate\n*  SSL certificate verify result: unable to get local issuer certificate (20), continuing anyway.\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-06-23","title":"2020-06-23","text":""},{"location":"Today-I-Learned/2020/#intall-google-cloud-sdk-in-docker-image","title":"Intall Google Cloud SDK in docker image","text":"<pre><code>FROM docker:stable\n\nRUN \\\n    apk add curl bash python git &amp;&amp; \\\n    curl https://sdk.cloud.google.com | bash -s -- --disable-prompts\n\nENV PATH $PATH:/root/google-cloud-sdk/bin\n</code></pre>"},{"location":"Today-I-Learned/2020/#linux-get-external-ip-in-curl-cli","title":"Linux - Get external ip in curl cli","text":"<p>ref: https://www.tecmint.com/find-linux-server-public-ip-address/ <pre><code>$ curl ifconfig.co\n$ curl ifconfig.me\n$ curl icanhazip.com\n$ curl https://ipinfo.io/ip\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#kubernetes-gkegcp-proxy-to-internal-load-balancer","title":"Kubernetes - GKE/GCP proxy to internal load balancer","text":"<ul> <li>https://cloud.google.com/kubernetes-engine/docs/how-to/internal-load-balancing</li> <li>https://cloud.google.com/kubernetes-engine/docs/how-to/internal-load-balancing#global_access</li> </ul> <p>Internal load balancer <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  namespace: default\n  name: ilb-api\n  annotations:\n    cloud.google.com/load-balancer-type: \"Internal\"\n\n    # This is beta. So it needs to follow this: https://stackoverflow.com/a/59658742/3854890\n    # gcloud beta compute forwarding-rules update xxxxx --region us-central1 --allow-global-access\n    # networking.gke.io/internal-load-balancer-allow-global-access: \"true\" # This is for same VPC different region.\nspec:\n  externalTrafficPolicy: Local\n  type: LoadBalancer\n  selector:\n    role: api\n  ports:\n  - port: 80\n    targetPort: http\n    protocol: TCP\n</code></pre></p> <p>Proxy service to internal load balancer <pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  namespace: web\n  name: api-proxy\nspec:\n  ports:\n  - protocol: TCP\n    port: 80\n    targetPort: 80\n\n---\nkind: Endpoints\napiVersion: v1\nmetadata:\n  namespace: web\n  name: api-proxy\nsubsets:\n  - addresses:\n      - ip: 10.100.0.100\n    ports:\n      - port: 80\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#gke-internal-load-balancer-dont-need-extra-firewalls","title":"GKE - Internal Load Balancer don't need extra firewalls","text":"<p>ref: https://cloud.google.com/kubernetes-engine/docs/how-to/internal-load-balancing#global_access</p> <p>no need to add additional firewalls. Default can access same region+project Internal Load Balancer.</p> <ul> <li>Without global access, traffic originating from clients in your VPC network must be in the same region as the load balancer.</li> <li>Global access is enabled per-Service using the following <code>annotation:\u00a0networking.gke.io/internal-load-balancer-allow-global-access: \"true\".</code></li> <li>Global access is available in Beta on GKE clusters 1.16 and up.</li> </ul>"},{"location":"Today-I-Learned/2020/#2020-06-18","title":"2020-06-18","text":""},{"location":"Today-I-Learned/2020/#linux-adduser-without-prompts","title":"Linux - adduser without prompts","text":"<pre><code>adduser runner --disabled-password  --gecos \"\"\n</code></pre>"},{"location":"Today-I-Learned/2020/#linux-add-sudoer-group-to-user","title":"Linux - Add sudoer group to user","text":"<pre><code>echo \"runner ALL=(ALL) NOPASSWD: ALL\" &gt;&gt; /etc/sudoers &amp;&amp;\\\nusermod -aG sudo runner\n</code></pre>"},{"location":"Today-I-Learned/2020/#github-action-runner-fix-gifsicle-command-failed","title":"Github Action Runner - Fix gifsicle: Command failed","text":"<p>Solution</p> <p>ref: https://github.com/imagemin/imagemin-gifsicle/issues/37#issuecomment-577889854 <pre><code>apt-get install -y --no-install-recommends autoconf automake libtool dh-autoreconf\n</code></pre></p> <pre><code>error /home/runner/_work/runner-demo/node_modules/gifsicle: Command failed.\nExit code: 1\nCommand: node lib/install.js\ninfo Visit https://yarnpkg.com/en/docs/cli/install for documentation about this command.\nArguments:\nDirectory: /home/runner/_work/runner-demo/node_modules/gifsicle\nOutput:\n\u26a0 Response code 404 (Not Found)\n  \u26a0 gifsicle pre-build test failed\n  \u2139 compiling from source\n  \u2716 Error: Command failed: /bin/sh -c ./configure --disable-gifview --disable-gifdiff --prefix=\"/home/runner/_work/runner-demo/node_modules/gifsicle/vendor\" --bindir=\"/home/runner/_work/runner-demo/node_modules/gifsicle/vendor\"\nconfig.status: error: in `/tmp/ee647f58-0c5e-49d4-995d-bf84ec21ed4e':\nconfig.status: error: Something went wrong bootstrapping makefile fragments\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-06-11","title":"2020-06-11","text":""},{"location":"Today-I-Learned/2020/#failed-to-determine-a-valid-solver-configuration-for-the-set-of-domains-on-the-order-no-configured-challenge-solvers-can-be-used-for-this-challenge","title":"Failed to determine a valid solver configuration for the set of domains on the Order: no configured challenge solvers can be used for this challenge","text":"<p>That's because Let's encrypt HTTP01 doesn't support wildcard(*) domains.</p> <p>So, we can't use <code>*.rammus.cf</code> in</p> <pre><code>apiVersion: cert-manager.io/v1alpha2\nkind: Issuer\nmetadata:\n  namespace: web\n  name: rammus\nspec:\n  acme:\n    email: rammus@rammus.cf\n    server: https://acme-v02.api.letsencrypt.org/directory\n    privateKeySecretRef:\n      name: rammus\n    solvers:\n    - http01:\n       ingress:\n         class: nginx\n---\napiVersion: cert-manager.io/v1alpha2\nkind: Certificate\nmetadata:\n  namespace: web\n  name: rammus\nspec:\n  secretName: rammus-tls\n  issuerRef:\n    # The issuer created previously\n    kind: Issuer\n    name: rammus\n  dnsNames:\n  - 'rammus.cf'\n  - '*.rammus.cf'\n  - 'api.rammus.cf'\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-06-05","title":"2020-06-05","text":""},{"location":"Today-I-Learned/2020/#gsutil-verify-a-google-service-account-with-docker-and-a-environment-variable","title":"gsutil - Verify a google service account with docker and a environment variable","text":"<pre><code>docker run -it --rm --entrypoint bash gcr.io/cloud-builders/gsutil\nsa='{key.json,....}'\ngcloud auth activate-service-account --key-file=&lt;(echo $sa)\ngsutil ls gs://rammus.dev\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-06-02","title":"2020-06-02","text":""},{"location":"Today-I-Learned/2020/#kubernetes-get-client-ip-from-google-network-load-balancer","title":"Kubernetes - Get client ip from Google Network Load Balancer","text":"<p>https://kubernetes.io/docs/tutorials/services/source-ip/#source-ip-for-services-with-typeloadbalancer <pre><code>spec:\n  externalTrafficPolicy: Local\n  type: LoadBalancer\n</code></pre></p> <p>kubernetes issue: https://github.com/kubernetes/kubernetes/issues/10921</p>"},{"location":"Today-I-Learned/2020/#direct-server-return-dsr","title":"Direct server return (DSR)","text":"<p>https://blog.envoyproxy.io/introduction-to-modern-network-load-balancing-and-proxying-a57f6ff80236</p>"},{"location":"Today-I-Learned/2020/#2020-05-26","title":"2020-05-26","text":""},{"location":"Today-I-Learned/2020/#nginx-get-request-connection-id","title":"Nginx - get request connection id","text":"<p>ref: - https://stackoverflow.com/questions/17748735/setting-a-trace-id-in-nginx-load-balancer - http://nginx.org/en/docs/http/ngx_http_upstream_module.html#keepalive <pre><code>    server {\n      listen                          80 default_server deferred;\n\n        set  $trace_id  $connection-$connection_requests;\n\n        location / {\n            proxy_set_header          Host 'api.swag.live';\n            proxy_pass                https://api$request_uri;\n            proxy_cache_key           api$request_uri;\n            proxy_set_header X-Request-Id $trace_id;\n        }\n    }\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#nginx-proxy_set_header-will-diable-persistent-connection","title":"Nginx - proxy_set_header will diable persistent connection","text":"<pre><code>proxy_set_header\n</code></pre> <pre><code>      upstream swaglive {\n        server                        swaglive.web;\n        keepalive                     16;\n        keepalive_requests            100000;\n      }\n\n      proxy_http_version              1.1;\n      proxy_set_header                Connection \"\";\n</code></pre>"},{"location":"Today-I-Learned/2020/#html-expires-and-cache-control","title":"HTML - Expires and Cache-Control","text":"<p>Cache-Control &gt; Expires</p> <ul> <li>Expires: HTTP 1.0</li> <li>Cache-Control: HTTP 1.1</li> </ul> <p>ref: https://blog.techbridge.cc/2017/06/17/cache-introduction/</p>"},{"location":"Today-I-Learned/2020/#2020-05-22","title":"2020-05-22","text":""},{"location":"Today-I-Learned/2020/#nginx-use-http-header-as-variable","title":"Nginx - use http header as variable","text":"<p><pre><code>$http_name\n</code></pre> ex: <pre><code>$http_referer\n$http_user_agent\n$http_x_forwarded_for\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#nginx-ssl_do_handshake-failed-ssl-error1408f10bssl-routinesssl3_get_recordwrong-version-number-while-ssl-handshaking-to-upstream","title":"Nginx - SSL_do_handshake() failed (SSL: error:1408F10B:SSL routines:SSL3_GET_RECORD:wrong version number) while SSL handshaking to upstream","text":"<pre><code>       proxy_ssl_session_reuse off;\n</code></pre>"},{"location":"Today-I-Learned/2020/#nginx-server-listen-80-default-deferred","title":"Nginx - server listen 80 default deferred","text":"<pre><code>server {\n  listen 80 default deferred;\n  ...\n}\n</code></pre> <p>ref: https://stackoverflow.com/questions/8449058/what-does-the-deferred-option-mean-in-nginxs-listen-directive</p> <p>TCP_DEFER_ACCEPT can help boost performance by reducing the amount of preliminary formalities that happen between the server and client.</p> <p>\"deferred\" is Linux-only. For example on FreeBSD it won't work</p>"},{"location":"Today-I-Learned/2020/#nginx-print-cache-status-log","title":"Nginx - Print cache status log","text":"<pre><code>    log_format  main  '$remote_addr - $remote_user - $upstream_cache_status [$time_local] \"$request\" '\n                     '$status $body_bytes_sent \"$http_referer\" '\n                     '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n\n    access_log  logs/access.log  main;\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-05-20","title":"2020-05-20","text":""},{"location":"Today-I-Learned/2020/#nginx-proxy_pass-cache-prority","title":"Nginx - proxy_pass cache prority","text":"<ol> <li>proxy_cache_path inactive=10m</li> <li>Cache-Control: s-maxage</li> <li>Cache-Control: max-age</li> <li>proxy_cache_valid 200 2s;</li> </ol> <p>https://github.com/RammusXu/toolkit/tree/master/docker/two-layer-nginx</p>"},{"location":"Today-I-Learned/2020/#2020-05-13","title":"2020-05-13","text":""},{"location":"Today-I-Learned/2020/#probot-update-file-and-create-pull-request","title":"Probot - update file and create pull request","text":"<p>https://github.com/octokit/rest.js/issues/845#issuecomment-386108187</p>"},{"location":"Today-I-Learned/2020/#2020-05-05","title":"2020-05-05","text":""},{"location":"Today-I-Learned/2020/#got-permission-denied-while-trying-to-connect-to-the-docker-daemon-socket-at-unixvarrundockersock-get-http2fvar2frun2fdockersockv140containersjson-dial-unix-varrundockersock-connect-permission-denied","title":"Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.40/containers/json: dial unix /var/run/docker.sock: connect: permission denied","text":"<p>Solution</p> <pre><code>sudo chmod 777 /var/run/docker.sock\n</code></pre>"},{"location":"Today-I-Learned/2020/#install-docker-on-debian-linux","title":"Install docker on Debian Linux","text":"<pre><code>apt-get install     apt-transport-https     ca-certificates     curl     gnupg-agent     software-properties-common\nsudo apt-key fingerprint 0EBFCD88\nsudo add-apt-repository    \"deb [arch=amd64] https://download.docker.com/linux/debian \\\n  $(lsb_release -cs) \\\n  stable\"\nsudo apt-get update\nsudo apt-get install docker-ce docker-ce-cli containerd.io\ndocker run hello-world\n</code></pre>"},{"location":"Today-I-Learned/2020/#ab-benchmark-is-using-1-core","title":"ab benchmark is using 1 core","text":"<pre><code>docker run --rm russmckendrick/ab ab -k -n 20000 -c 2000 https://rammus.cf/\n</code></pre> <p>Better to use multi-thread benchmark tool <pre><code>docker run --rm williamyeh/wrk -t10 -c500 -d30 --latency https://rammus.cf\n</code></pre></p> <pre><code>apk add wrk\nwrk -t10 -c500 -d30 --latency http://localhost:3000\n</code></pre> <p>Can monitor this behavior with: <pre><code>docker stats\n</code></pre></p> <p>ab will never over 100%, also need to care about how much resource you give it to docker machine.</p>"},{"location":"Today-I-Learned/2020/#2020-05-04","title":"2020-05-04","text":""},{"location":"Today-I-Learned/2020/#pemission-denied-when-volumemounts-configmap-as-file","title":"Pemission denied when volumeMounts configmap as file","text":"<p>https://github.com/kubernetes/kubernetes/issues/71356</p> <pre><code>     subprocess.call(['./demo.sh'])\n   File \"/usr/local/lib/python3.8/subprocess.py\", line 340, in call\n     with Popen(*popenargs, **kwargs) as p:\n   File \"/usr/local/lib/python3.8/subprocess.py\", line 854, in __init__\n     self._execute_child(args, executable, preexec_fn, close_fds,\n   File \"/usr/local/lib/python3.8/subprocess.py\", line 1702, in _execute_child\n     raise child_exception_type(errno_num, err_msg, err_filename)\n PermissionError: [Errno 13] Permission denied: './demo.sh'\n</code></pre> <pre><code>kind: ConfigMap\nmetadata:\n  name: tls-watch-config\ndata:\n  app.py: |\n    import subprocess\n        subprocess.call(['./update-cert.sh', filename, target_proxy])\n\n  update-cert.sh: |\n    echo 'update'\n</code></pre> <pre><code>      volumes:\n      - name: workspace\n        configMap:\n          name: tls-watcher-config\n          defaultMode: 0555\n\n      containers:\n      - name: tls-watcher\n        image: python:3.8-alpine3.11\n        volumeMounts:\n        - name: workspace\n          mountPath: /workspace\n        workingDir: /workspace\n        command: [\"sh\", \"-c\"]\n        args:\n        - |\n          python -u app.py\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-04-30","title":"2020-04-30","text":""},{"location":"Today-I-Learned/2020/#generate-an-unique-sha-from-multiple-file-in-mac","title":"Generate an unique sha from multiple file in Mac","text":"<pre><code>shasum *.json| shasum | cut -d' ' -f1\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-04-24","title":"2020-04-24","text":""},{"location":"Today-I-Learned/2020/#nginx-could-not-find-named-location","title":"Nginx: could not find named location","text":"<p>2020/04/24 09:34:31 [error] 7#7: *58 could not find named location \"@gcsfiles\" while sending to client, client: 10.4.4.2, server:</p> <pre><code>location ~* '^/(js|img|locale)/' {\n  proxy_pass                      http://backend/$uri;\n  proxy_cache_key                 rammus.cf$uri;\n  add_header                      \"Cache-Control\" \"public, max-age=3600\";\n  add_header                      Strict-Transport-Security \"max-age=86400; includeSubDomains\" always;\n\n  proxy_intercept_errors on;\n  error_page                      404 = @gcsfiles;\n}\n\nlocation = @gcsfiles {\n  proxy_pass                      http://gcs/rammus.cf$uri;\n  proxy_cache_key                 $http_host$uri;\n\n  # Enabled HSTS\n  add_header                      Strict-Transport-Security \"max-age=86400; includeSubDomains\" always;\n  add_header                      \"Cache-Control\" \"public, max-age=2592300\";\n}\n</code></pre> <p>It should be <pre><code>location = @gcsfiles {\nlocation @gcsfiles {\n</code></pre> without <code>=</code></p>"},{"location":"Today-I-Learned/2020/#2020-04-17","title":"2020-04-17","text":""},{"location":"Today-I-Learned/2020/#gke-ingress-with-managed-certificates","title":"GKE ingress with managed-certificates","text":"<p><pre><code>apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  name: web\n  namespace: default\n  annotations:\n    # gcloud compute addresses create gclb-web --global\n    # gcloud compute addresses list\n    networking.gke.io/static-ip: 1.1.1.1\n\n    # kubectl apply -f certificate.yaml\n    # gcloud compute ssl-certificates list\n    networking.gke.io/managed-certificates: rammus-cf\n\nspec:\n  rules:\n  - host: rammus.cf\n    http:\n      paths:\n      - backend:\n          serviceName: my-svc\n          servicePort: http\n  - http:\n      paths:\n      - backend:\n          serviceName: my-svc\n          servicePort: http\n</code></pre> <pre><code>apiVersion: networking.gke.io/v1beta1\nkind: ManagedCertificate\nmetadata:\n  name: rammus-cf\nspec:\n  domains:\n    - \"rammus.cf\"\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-04-07","title":"2020-04-07","text":""},{"location":"Today-I-Learned/2020/#test-a-website-speed","title":"Test a website speed","text":"<pre><code>docker run --rm -v \"$(pwd)\":/sitespeed.io sitespeedio/sitespeed.io:12.3.1 https://app.swag.live\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-03-14","title":"2020-03-14","text":""},{"location":"Today-I-Learned/2020/#find-other-lan-users-ip","title":"Find other LAN user's IP","text":"<pre><code>arp -a\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-03-13","title":"2020-03-13","text":""},{"location":"Today-I-Learned/2020/#httpswww17cecom","title":"\u4e2d\u570b\u7684\u6e2c\u901f\u7db2\u7ad9 https://www.17ce.com/","text":"<p>\u53ef\u4ee5\u6e2c\u8a66 CDN \u6548\u679c</p> <ul> <li>benchmark</li> <li>warm up</li> </ul>"},{"location":"Today-I-Learned/2020/#2020-03-12","title":"2020-03-12","text":""},{"location":"Today-I-Learned/2020/#dnsmasq-unsupported-option-check-that-dnsmasq-was-compiled-with-dhcptftpdnssecdbus-support","title":"dnsmasq: unsupported option (check that dnsmasq was compiled with DHCP/TFTP/DNSSEC/DBus support)","text":"<p>Solution</p> <pre><code>apk --no-cache add dnsmasq-dnssec\n</code></pre> <p>\u9019\u500b\u932f\u8aa4\u767c\u751f\u5728:</p> <ul> <li>\u4f7f\u7528 alpine linux <code>apk add dnsmasq</code></li> <li>Enable dnssec</li> </ul> <pre><code># /etc/dnsmasq.conf\ndnssec\nconf-file=/usr/share/dnsmasq/trust-anchors.conf\ndnssec-check-unsigned\n</code></pre> <p>or <pre><code># /etc/dnsmasq.conf\ndnssec\ntrust-anchor=.,19036,8,2,49AAC11D7B6F6446702E54A1607371607A1A41855200FD2CE1CDDE32F24E8FB5\ntrust-anchor=.,20326,8,2,E06D44B80B8F1D39A95C0B0D7C65D08458E880409BBC683457104237C7F8EC8D\ndnssec-check-unsigned\n</code></pre></p> <p>Success</p> <pre><code>nsmasq_1  | dnsmasq: started, version 2.80 cachesize 150\ndnsmasq_1  | dnsmasq: compile time options: IPv6 GNU-getopt no-DBus no-i18n no-IDN DHCP DHCPv6 no-Lua TFTP no-conntrack ipset auth DNSSEC loop-detect inotify dumpfile\ndnsmasq_1  | dnsmasq: DNSSEC validation enabled\ndnsmasq_1  | dnsmasq: configured with trust anchor for &lt;root&gt; keytag 20326\ndnsmasq_1  | dnsmasq: configured with trust anchor for &lt;root&gt; keytag 19036\n</code></pre>"},{"location":"Today-I-Learned/2020/#parsing-dnssec-anchors-in-shell-scriptbash","title":"Parsing dnssec anchors in shell script(bash)","text":"<p>ref:</p> <ul> <li>https://stackoverflow.com/questions/19908777/curl-and-xmllint-pipe</li> <li>https://data.iana.org/root-anchors/root-anchors.xml <pre><code>curl -s https://data.iana.org/root-anchors/root-anchors.xml | \\\n  xmllint --format --xpath 'concat(\"trust-anchor=.,\", /TrustAnchor/KeyDigest[1]/KeyTag, \",\", /TrustAnchor/KeyDigest[1]/Algorithm, \",\",/TrustAnchor/KeyDigest[1]//DigestType, \",\", /TrustAnchor/KeyDigest[1]/Digest)' -\n\ncurl -s https://data.iana.org/root-anchors/root-anchors.xml | \\\n  xmllint --format --xpath 'concat(\"trust-anchor=.,\", /TrustAnchor/KeyDigest[2]/KeyTag, \",\", /TrustAnchor/KeyDigest[2]/Algorithm, \",\",/TrustAnchor/KeyDigest[2]//DigestType, \",\", /TrustAnchor/KeyDigest[2]/Digest)' -\n</code></pre></li> </ul>"},{"location":"Today-I-Learned/2020/#commands-of-testing-domain","title":"Commands of testing domain","text":"<pre><code>apk add bind-tools\n</code></pre> <pre><code>nslookup swag.live localhost\nnslookup swag.live 127.0.0.1\n</code></pre> <pre><code>dig @localhost swag.live\ndig @127.0.0.1 swag.live\ndig @8.8.8.8 swag.live\n</code></pre> <pre><code>dig +trace swag.live\ndig +short swag.live ns\n</code></pre> <pre><code>dig @dnsmasq +dnssec swag.live\ndig @dnsmasq +dnssec google.com\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-03-11","title":"2020-03-11","text":""},{"location":"Today-I-Learned/2020/#check-multiple-variables-are-not-none-in-python","title":"Check multiple variables are not None in Python","text":"<p>ref: https://stackoverflow.com/questions/42360956/what-is-the-most-pythonic-way-to-check-if-multiple-variables-are-not-none <pre><code>params = os.getenv('PARAMS')\nsid = os.getenv('SID')\nskey = os.getenv('SKEY')\nif None in (params, sid, skey):\n    print(\"Must have SID, SKEY, PARAMS\")\n    exit(1)\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-03-10","title":"2020-03-10","text":""},{"location":"Today-I-Learned/2020/#gcs-roles","title":"GCS roles","text":"<p>Storage Object Admin <pre><code>resourcemanager.projects.get\nresourcemanager.projects.list\nstorage.objects.create\nstorage.objects.delete\nstorage.objects.get\nstorage.objects.getIamPolicy\nstorage.objects.list\nstorage.objects.setIamPolicy\nstorage.objects.update\n</code></pre></p> <p>Storage Object Creator <pre><code>resourcemanager.projects.get\nresourcemanager.projects.list\nstorage.objects.create\n</code></pre></p> <p>Storage Object Viewer <pre><code>resourcemanager.projects.get\nresourcemanager.projects.list\nstorage.objects.get\nstorage.objects.list\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-03-09","title":"2020-03-09","text":""},{"location":"Today-I-Learned/2020/#get-nth-line-of-stdout-on-linux","title":"Get nth line of stdout on linux","text":"<p>ref: https://stackoverflow.com/questions/1429556/command-to-get-nth-line-of-stdout <pre><code>ls -l | sed -n 2p\nls -l | head -2 | tail -1\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#sort-gcs-google-cloud-storage-objects-by-date","title":"Sort GCS (google cloud storage) objects by date","text":"<p>ref: https://stackoverflow.com/a/51709554/3854890 <pre><code>gsutil ls -l gs://[bucket-name]/ | sort -r -k 2\n</code></pre> Example: <pre><code>~ gsutil ls -l gs://rammus.cf/download | sort -r -k 2\n  62786148  2020-03-06T05:52:53Z  gs://rammus.cf/download/3.0.2.8087.086886.apk\n  62732280  2020-03-04T03:07:33Z  gs://rammus.cf/download/3.0.1-8070.apk\n  62729059  2020-03-02T16:25:22Z  gs://rammus.cf/download/3_0_1_8ca354.apk\n  11  2020-03-02T16:25:03Z  gs://rammus.cf/download/\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#measuring-kubernetes-dns","title":"Measuring kubernetes dns","text":"<pre><code>bash-5.0# time (for i in {1..100}; do host -U echoserver.ops &gt; /dev/null ; done)\n\nreal    0m1.150s\nuser    0m0.445s\nsys 0m0.278s\nbash-5.0# time (for i in {1..100}; do host -U echoserver.ops.svc.cluster.local &gt; /dev/null ; done)\n\nreal    0m1.762s\nuser    0m0.463s\nsys 0m0.362s\n</code></pre> <pre><code>bash-5.0# host -v echoserver.ops\nTrying \"echoserver.ops.ops.svc.cluster.local\"\nTrying \"echoserver.ops.svc.cluster.local\"\nbash-5.0# host -v echoserver.ops.svc.cluster.local\nTrying \"echoserver.ops.svc.cluster.local.ops.svc.cluster.local\"\nTrying \"echoserver.ops.svc.cluster.local.svc.cluster.local\"\nTrying \"echoserver.ops.svc.cluster.local.cluster.local\"\nTrying \"echoserver.ops.svc.cluster.local.google.internal\"\nTrying \"echoserver.ops.svc.cluster.local\"\n\nbash-5.0# cat /etc/resolv.conf\nnameserver 10.24.0.10\nsearch ops.svc.cluster.local svc.cluster.local cluster.local google.internal\noptions ndots:5\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-03-06","title":"2020-03-06","text":""},{"location":"Today-I-Learned/2020/#how-does-udp-request-receiving-responses","title":"How does UDP request receiving responses.","text":"<ul> <li>SOCK_STREAM: TCP</li> <li>SOCK_DGRAM: UDP</li> </ul> <p>https://stackoverflow.com/questions/1815030/receiving-a-response-through-udp</p> <ol> <li>Client emits UDP packet.</li> <li>Router passes UDP packet to the Internet.</li> <li>Router remembers that client sent a UDP packet to server, and establishes a mapping in its memory.</li> <li>Server sends a UDP packet, probably on the same port.</li> <li>Router receives packet, and checks mapping to find client talked to server recently.</li> <li>Router passes packet to client.</li> </ol> <p>https://ns1.com/resources/dns-protocol</p> <p>DNS communication occurs via two types of messages: queries and replies. Both DNS query format and reply format consist of the following sections:</p> <ul> <li>The header section contains Identification; Flags; Number of questions; Number of answers; Number of authority resource records (RRs); and Number of additional resource records.</li> <li>The flag field contains sections of one or four bits, indicating type of message, whether the name server is authoritative; whether the query is recursive or not, whether request was truncated, and status.</li> <li>The question section contains the domain name and type of record (A, AAAA, MX, TXT, etc.) being resolved. Each label in the domain name is prefixed by its length.</li> <li>The answer section has the resource records of the queried name.</li> </ul> <p>http://www-inf.int-evry.fr/~hennequi/CoursDNS/NOTES-COURS_eng/msg.html</p>"},{"location":"Today-I-Learned/2020/#weave-scope-kubernetes","title":"Weave Scope - \u76e3\u63a7 kubernetes \u7684\u5de5\u5177","text":"<p>ref: https://www.weave.works/docs/scope/latest/installing/#kubernetes</p> <p>\u5b89\u88dd Weave Scope <pre><code>kubectl apply -f \"https://cloud.weave.works/k8s/scope.yaml?k8s-version=$(kubectl version | base64 | tr -d '\\n')\"\n</code></pre> Expose \u670d\u52d9\u5230 localhost <pre><code>kubectl port-forward -n weave service/weave-scope-app 4040:80\nopen -a \"Google Chrome\" \"http://localhost:4040\"\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-03-05","title":"2020-03-05","text":""},{"location":"Today-I-Learned/2020/#try-to-resolve-a-domain-in-kubernetes","title":"Try to resolve a domain in kubernetes","text":"<p>Default <code>/etc/resolv.conf</code> is like: <pre><code>nameserver 10.24.0.10\nsearch default.svc.cluster.local svc.cluster.local cluster.local google.internal\noptions ndots:5\n</code></pre></p> <p>\u5c11\u65bc 5 \u500b dot (.) \u5c07\u6703\u5148\u641c\u5c0b search <code>default.svc.cluster.local svc.cluster.local cluster.local google.internal</code> <pre><code>&gt; host -v a.a.a.www.google.com\nTrying \"a.a.a.www.google.com\"\n\n&gt; host -v a.a.www.google.com\nTrying \"a.a.www.google.com.ops.svc.cluster.local\"\nTrying \"a.a.www.google.com.svc.cluster.local\"\nTrying \"a.a.www.google.com.cluster.local\"\nTrying \"a.a.www.google.com.google.internal\"\nTrying \"a.a.www.google.com\"\n\n&gt; host -v www.google.com\nTrying \"www.google.com.ops.svc.cluster.local\"\nTrying \"www.google.com.svc.cluster.local\"\nTrying \"www.google.com.cluster.local\"\nTrying \"www.google.com.google.internal\"\nTrying \"www.google.com\"\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-03-04","title":"2020-03-04","text":""},{"location":"Today-I-Learned/2020/#how-to-perform-ddos-test-as-a-pentester","title":"how-to-perform-ddos-test-as-a-pentester","text":"<p>https://pentest.blog/how-to-perform-ddos-test-as-a-pentester/</p>"},{"location":"Today-I-Learned/2020/#install-netstress-on-kali-linux","title":"Install netstress on kali linux","text":"<pre><code>apt-get update\napt-get install netstress\n</code></pre>"},{"location":"Today-I-Learned/2020/#run-kali-linux-on-kubernetes","title":"Run kali linux on Kubernetes","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: kali\n  labels:\n    app: kali\nspec:\n  ## Select node pool in GKE\n  # affinity:\n  #   nodeAffinity:\n  #     requiredDuringSchedulingIgnoredDuringExecution:\n  #       nodeSelectorTerms:\n  #       - matchExpressions:\n  #         - key: cloud.google.com/gke-nodepool\n  #           operator: In\n  #           values:\n  #           - \"pool-1\"\n  containers:\n  - image: kalilinux/kali\n    command: [\"/bin/sh\",\"-c\"]\n    args:\n    - |\n      tail -f /dev/null\n    imagePullPolicy: IfNotPresent\n    name: kali\n  restartPolicy: Never\n</code></pre>"},{"location":"Today-I-Learned/2020/#gke-nodelocal-dnscache","title":"GKE NodeLocal DNSCache","text":"<p>https://cloud.google.com/kubernetes-engine/docs/how-to/nodelocal-dns-cache</p> <ul> <li>Base on CoreDNS</li> </ul>"},{"location":"Today-I-Learned/2020/#install-dnsperf-on-alpine","title":"Install dnsperf on alpine","text":"<p>ref: - https://github.com/ssro/dnsperf/blob/master/Dockerfile - https://github.com/guessi/docker-dnsperf/blob/master/bench/k8s-dnsperf-bench.yaml <pre><code>DNSPERF=dnsperf-2.3.2\napk add --update --no-cache --virtual deps wget g++ make bind-dev openssl-dev libxml2-dev libcap-dev json-c-dev krb5-dev protobuf-c-dev fstrm-dev \\\n  &amp;&amp; apk add --update --no-cache bind libcrypto1.1 \\\n  &amp;&amp; wget https://www.dns-oarc.net/files/dnsperf/$DNSPERF.tar.gz \\\n  &amp;&amp; tar zxvf $DNSPERF.tar.gz \\\n  &amp;&amp; cd $DNSPERF \\\n  &amp;&amp; sh configure \\\n  &amp;&amp; make \\\n  &amp;&amp; strip ./src/dnsperf ./src/resperf \\\n  &amp;&amp; make install\n</code></pre></p> <pre><code>echo \"kube-dns.kube-system.svc.cluster.local A\" &gt; records.txt\necho \"echoserver.ops.svc.cluster.local A\" &gt; records.txt\n</code></pre> <pre><code>dnsperf -l 10 \\\n        -s 10.140.0.53 \\\n        -T 20 \\\n        -c 20 \\\n        -q 10000 \\\n        -Q 10000 \\\n        -S 5 \\\n        -d records.txt\n\ndnsperf -l 10 \\\n        -T 20 \\\n        -c 20 \\\n        -q 10000 \\\n        -Q 10000 \\\n        -S 5 \\\n        -d records.txt\n</code></pre> <pre><code>  -l run for at most this many seconds\n  -s the server\n  -T the number of threads to run\n  -c the number of clients to act as to query (default: 127.0.0.1)\n  -q the maximum number of queries outstanding (default: 100)\n  -Q limit the number of queries per second\n  -S print qps statistics every N seconds\n  -d the input data file (default: stdin)\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-03-03","title":"2020-03-03","text":""},{"location":"Today-I-Learned/2020/#open-google-chrome-browser-in-mac-terminal","title":"Open Google Chrome browser in Mac terminal","text":"<pre><code>open -a \"Google Chrome\" \"http://localhost:5601\"\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-03-02","title":"2020-03-02","text":""},{"location":"Today-I-Learned/2020/#create-a-temporary-pod-to-debug-and-kill-itself-after-an-hour","title":"Create a temporary pod to debug and kill itself after an hour","text":"<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: busybox1\n  labels:\n    app: busybox1\nspec:\n  containers:\n  # - image: busybox\n  - image: alpine:3.11\n    command:\n      - sleep\n      - \"3600\"\n    imagePullPolicy: IfNotPresent\n    name: busybox\n  restartPolicy: Never\n</code></pre>"},{"location":"Today-I-Learned/2020/#dns-load-testing-in-alpine","title":"DNS load testing in Alpine","text":"<pre><code>apk add gcc g++ make libffi-dev openssl-dev git\ngit clone https://github.com/jedisct1/dnsblast.git\ncd dnsblast &amp;&amp; make\n#./dnsblast [host] [times] [request per second]\n./dnsblast kube-dns.kube-system 10000 1000\n./dnsblast 127.0.0.1 10000 1000\n</code></pre> <ul> <li>The command above will break kube-dns.</li> <li>There are 5 kube-dns pods, but only one is receiving request.<ul> <li>Caused by iptable and UDP.</li> </ul> </li> </ul> <pre><code>dnsmasq I0302 08:47:01.002440       1 nanny.go:146[] dnsmasq[23]: Maximum number of concurrent DNS queries reached (max: 1500)\nsidecar W0302 08:47:01.248582       1 server.go:64[] Error getting metrics from dnsmasq: read udp 127.0.0.1:37986-&gt;127.0.0.1:53: i/o timeout\n</code></pre>"},{"location":"Today-I-Learned/2020/#gke-v113x-uses-kube-dns-rather-than-core-dns","title":"GKE v1.13.x uses kube-dns rather than core-dns.","text":"<p>ref: https://cloud.google.com/kubernetes-engine/docs/release-notes#new_features_6</p> <p>GKE is using kube- rather than core-dns. No idea why they are doing this.</p>"},{"location":"Today-I-Learned/2020/#install-gcc-compiler-in-alpine","title":"Install gcc compiler in Alpine","text":"<p>ref: https://github.com/nange/blog/issues/3 <pre><code>apk add gcc g++ make libffi-dev openssl-dev\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#echo-n","title":"echo -n","text":"<p>https://linux.die.net/man/1/echo <pre><code>-n\ndo not output the trailing newline\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-02-27","title":"2020-02-27","text":""},{"location":"Today-I-Learned/2020/#get-github-user-info","title":"Get GitHub user info","text":"<p>https://developer.github.com/v3/#authentication <pre><code>curl -u \"username\" https://api.github.com/user\ncurl -H \"Authorization: token $PAT\" https://api.github.com/user\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-02-26","title":"2020-02-26","text":""},{"location":"Today-I-Learned/2020/#use-cloudflare-warp-as-vpn-on-macpc","title":"Use CloudFlare WARP as VPN on Mac/PC","text":"<p>https://community.cloudflare.com/t/tutorial-how-to-use-cloudflare-warp-on-your-mac/129919?fbclid=IwAR3OlvJrv2EW3KoH3GlDA-gURM5BgPKiaP5RDjjlgBHyYpKWbryZzbrPDGw</p> <p>WARP (CloudFlare VPN) is made from Wireguard. Therefore we can generate a Wirrguard config from CloudFlare and use it on PC.</p>"},{"location":"Today-I-Learned/2020/#refreshclean-cdn-cache-on-tencent-cloud","title":"Refresh/Clean CDN cache on Tencent Cloud","text":"<p>https://console.cloud.tencent.com/cdn/refresh</p> <p>Just type what url you want to refresh.</p>"},{"location":"Today-I-Learned/2020/#you-might-have-to-verify-by-doing-a-request-from-a-location-with-a-cloudflare-edge","title":"You might have to verify by doing a request from a location with a Cloudflare edge","text":"<p>I tested it on https://tools.pingdom.com/</p> <ul> <li>test in Tokyo</li> <li>CloudFlare/Google CDN both have edges</li> <li>GCS hosting need more DNS time: 40 ms</li> </ul>"},{"location":"Today-I-Learned/2020/#2020-02-24","title":"2020-02-24","text":""},{"location":"Today-I-Learned/2020/#cloudflare-worker-cant-resovlefind-domain","title":"CloudFlare worker - Can't resovle/find domain","text":"<p>Need to manully add this record to route worker. ref: https://community.cloudflare.com/t/a-record-name-for-worker/98841</p> <p>Solution</p> <p>Add an A record to 192.0.2.1</p>"},{"location":"Today-I-Learned/2020/#cloudflare-worker-how-to-handle-spa","title":"CloudFlare worker - how to handle SPA","text":"<p>I found there's 404 when I tried to refresh in other page like /faq.</p> <p>ref: https://stackoverflow.com/questions/58432345/cloudflare-workers-spa-with-vuejs <pre><code>options.mapRequestToAsset = req =&gt; {\n    // First let's apply the default handler, which we imported from\n    // '@cloudflare/kv-asset-handler' at the top of the file. We do\n    // this because the default handler already has logic to detect\n    // paths that should map to HTML files, for which it appends\n    // `/index.html` to the path.\n    req = mapRequestToAsset(req)\n\n    // Now we can detect if the default handler decided to map to\n    // index.html in some specific directory.\n    if (req.url.endsWith('/index.html')) {\n      // Indeed. Let's change it to instead map to the root `/index.html`.\n      // This avoids the need to do a redundant lookup that we know will\n      // fail.\n      return new Request(`${new URL(req.url).origin}/index.html`, req)\n    } else {\n      // The default handler decided this is not an HTML page. It's probably\n      // an image, CSS, or JS file. Leave it as-is.\n      return req\n    }\n  }\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-02-21","title":"2020-02-21","text":""},{"location":"Today-I-Learned/2020/#multiple-static-ip-in-a-load-balancer","title":"Multiple static IP in a load balancer","text":"<p>Steps:</p> <ol> <li>Manual create ip addresses.</li> <li>Assign ip addresses to load balancer frontend</li> <li>Use <code>externalIPs</code> instead of <code>loadBalancerIP</code> <pre><code>kind: Service\napiVersion: v1\nmetadata:\n  name: dnsmasq\nspec:\n  selector:\n    name: dnsmasq\n  type: LoadBalancer\n  externalIPs:\n  - a.a.a.a\n  - a.a.a.b\n  ports:\n  - name: dnsmasq-udp\n    port: 53\n    protocol: UDP\n    targetPort: dnsmasq-udp\n  # loadBalancerIP: a.a.a.a\n</code></pre></li> </ol>"},{"location":"Today-I-Learned/2020/#testing-hpa-high-memory","title":"Testing HPA high memory","text":"<p>ref: https://github.com/feiskyer/kubernetes-handbook/blob/master/examples/hpa-memory.yaml</p> <pre><code>apiVersion: autoscaling/v2beta1\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: nginx-hpa\nspec:\n  scaleTargetRef:\n    apiVersion: extensions/v1beta1\n    kind: Deployment\n    name: dnsmasq\n  minReplicas: 1\n  maxReplicas: 5\n  metrics:\n  - type: Resource\n    resource:\n      name: memory\n      targetAverageUtilization: 60\n</code></pre> <p>and get in a container <pre><code>$ kubectl exec -it dnsmasq-5964d6fdc-2ktt8 sh\n</code></pre></p> <p>generate high memory usage <pre><code>$ yes | tr \\\\n x | head -c 100m | grep n\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#about-kubernetes-hpahorizontal-pod-autoscaler","title":"About Kubernetes HPA(Horizontal Pod Autoscaler)","text":"<p>ref: https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale</p> <ul> <li>desiredReplicas = ceil[currentReplicas * ( currentMetricValue / desiredMetricValue )]</li> <li>\u6bcf 15 \u79d2\u6aa2\u67e5\u4e00\u6b21</li> <li>\u9810\u8a2d downscale: 5m</li> </ul>"},{"location":"Today-I-Learned/2020/#2020-02-19","title":"2020-02-19","text":""},{"location":"Today-I-Learned/2020/#use-environment-from-parent-process-in-nginxopenresty","title":"Use environment from parent process in Nginx(OpenResty)","text":"<p>\u5728 nginx \u8b80\u53d6\u74b0\u5883\u8b8a\u6578\u7684\u6b63\u78ba\u65b9\u6cd5:</p> <ul> <li>\u5148\u5728 root block export \u8b8a\u6578</li> <li>\u4f7f\u7528 lua <code>os.getenv(\"MY_ENV\"))</code> <pre><code>env MY_ENV;\nenv PATH;\nhttp {\n    server {\n        location / {\n            content_by_lua_block {\n                ngx.say(os.getenv(\"MY_ENV\"));\n                ngx.say(os.getenv(\"PATH\"));\n            }\n        }\n    }\n}\n</code></pre></li> </ul>"},{"location":"Today-I-Learned/2020/#cannot-create-an-external-load-balancer-with-mix-protocols","title":"cannot create an external load balancer with mix protocols","text":"<pre><code>The Service \"dnsmasq\" is invalid: spec.ports: Invalid value: []core.ServicePort{core.ServicePort{Name:\"dnsmasq\", Protocol:\"TCP\", Port:53, TargetPort:intstr.IntOrString{Type:1, IntVal:0, StrVal:\"dnsmasq\"}, NodePort:0}, core.ServicePort{Name:\"dnsmasq-udp\", Protocol:\"UDP\", Port:53, TargetPort:intstr.IntOrString{Type:1, IntVal:0, StrVal:\"dnsmasq-udp\"}, NodePort:0}}: cannot create an external load balancer with mix protocols\n</code></pre>"},{"location":"Today-I-Learned/2020/#2020-02-18","title":"2020-02-18","text":""},{"location":"Today-I-Learned/2020/#try-docker-compose-health-check","title":"Try docker-compose health check","text":"<p>https://github.com/peter-evans/docker-compose-healthcheck <pre><code>healthcheck:\n  test: [\"CMD-SHELL\", \"pg_isready -U postgres\"]\n  interval: 10s\n  timeout: 5s\n  retries: 5\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#docker-docker-credential-osxkeychain-ci-db","title":"Docker \u66f4\u65b0\u5f8c\u8df3\u51fa docker-credential-osxkeychain \u60f3\u4f7f\u7528\u9470\u5319\u5708 ci-db","text":"<p>https://github.com/docker/for-mac/issues/3805#issuecomment-518619953</p> <p>Solution</p> <p>Open <code>~/.docker/config.json</code></p> <p>Set <code>\"credsStore\":\"\"</code></p>"},{"location":"Today-I-Learned/2020/#how-to-use-cc-by-sa-license","title":"How to use cc-by-sa license","text":"<ul> <li> <p>Plain text: https://creativecommons.org/licenses/by-sa/4.0/legalcode.txt</p> </li> <li> <p>Image:  <pre><code>&lt;a rel=\"license\" href=\"http://creativecommons.org/licenses/by-sa/4.0/\"&gt;&lt;img alt=\"Creative Commons License\" style=\"border-width:0\" src=\"https://i.creativecommons.org/l/by-sa/4.0/88x31.png\" /&gt;&lt;/a&gt;\n</code></pre> <pre><code>[![](https://i.creativecommons.org/l/by-sa/4.0/88x31.png)](http://creativecommons.org/licenses/by-sa/4.0/)\n</code></pre></p> </li> </ul>"},{"location":"Today-I-Learned/2020/#print-a-colorful-text-in-terminal","title":"Print a colorful text in terminal","text":"<p>ANSI - \u8f38\u51fa\u6587\u5b57\u8b8a\u8272 <pre><code>echo -e \"\\e[1;31mHello\\e[0m World\"\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#render-a-chart-inside-markdown-with-canvasjs","title":"Render a chart inside markdown with canvasjs","text":""},{"location":"Today-I-Learned/2020/#2020-02-15","title":"2020-02-15","text":""},{"location":"Today-I-Learned/2020/#restart-a-kubernetes-resource-without-down-time-and-using-same-configyaml","title":"Restart a kubernetes resource without down time and using same config(yaml)","text":"<p>Kubernetes &gt;= 1.15</p> <p>ref: https://github.com/kubernetes/kubernetes/issues/33664#issuecomment-497242094</p> <p>Gracefully rolling restart deployment. <pre><code>kubectl rollout restart deployment/my-sites --namespace=default\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#run-commnad-withoutignoring-output","title":"\bRun commnad without(ignoring) output","text":"<p>https://askubuntu.com/questions/474556/hiding-output-of-a-command</p> <pre><code>command &gt; /dev/null 2&gt;&amp;1\ncommand &gt;&amp; /dev/null\n</code></pre> <p>Example: Still show errors when command failed. <pre><code>$ edho hi &gt; /dev/null\nzsh: command not found: edho\n</code></pre> Don't show error even when command failed. <pre><code>$ edho hi &gt;&amp; /dev/null\n</code></pre></p>"},{"location":"Today-I-Learned/2020/#2020-02-13","title":"2020-02-13","text":""},{"location":"Today-I-Learned/2020/#docker-compose","title":"\u5728 docker-compose \u4e2d\u7684\u5bb9\u5668\u4e92\u76f8\u6e9d\u901a","text":"<p>service name \u6703\u88ab\u7d81\u5230 DNS\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 service name \u7576\u4f5c host</p> <pre><code>version: '3'\nservices:\n  redis:\n    image: \"redis:alpine\"\n    ports:\n      - \"6379:6379\"\n  celery:\n    image: \"celery:4.0.2\"\n    environment:\n      - CELERY_BROKER_URL=redis://redis\n  celery-2:\n    image: \"celery:4.0.2\"\n    environment:\n      - CELERY_BROKER_URL=redis://redis\n</code></pre> <pre><code>$ docker network ls\nNETWORK ID          NAME                        DRIVER              SCOPE\n01681ec52fea        celery_default              bridge              local\n</code></pre> <pre><code>$ docker exec -it celery_celery_1 bash\nuser@dcd8cf4a9d04:~$ ping celery-2\nPING celery-2 (192.168.0.4): 56 data bytes\n64 bytes from 192.168.0.4: icmp_seq=0 ttl=64 time=0.162 ms\n64 bytes from 192.168.0.4: icmp_seq=1 ttl=64 time=0.223 ms\n^C--- celery-2 ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max/stddev = 0.162/0.193/0.223/0.031 ms\nuser@dcd8cf4a9d04:~$ ping celery-3\nping: unknown host\n</code></pre>"},{"location":"Today-I-Learned/2020/#mkdocs-minify-html-got-error","title":"mkdocs minify html got error","text":"<p>mkdocs.yaml <pre><code>plugins:\n  - minify:\n      minify_html: true\n</code></pre></p> <p>Bug</p> <pre><code>    print \"htmlmin option \" + key + \" not recognized\"\n                        ^\nSyntaxError: Missing parentheses in call to 'print'. Did you mean print(\"htmlmin option \" + key + \" not recognized\")?\n</code></pre> <p>Solution</p> <p>ref: https://github.com/byrnereese/mkdocs-minify-plugin/issues/8</p> <p>Upgrade mkdocs-minify-plugin&gt;= 0.2.3</p>"},{"location":"Today-I-Learned/2021/","title":"2021","text":"<p>What I learned in 2021.</p>"},{"location":"Today-I-Learned/2021/#2021-12-24","title":"2021-12-24","text":""},{"location":"Today-I-Learned/2021/#helm-escape","title":"Helm - escape {{ }}","text":"<p>ref: https://github.com/helm/helm/issues/2798#issuecomment-890478869</p> <pre><code>      labels:\n        sink_name: loki_syslog\n        #Below key useed printf() to escape Helm interprets {{ }}\n        message: &gt;-\n          {{ printf \"{{ message }}\" }}\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-12-15","title":"2021-12-15","text":""},{"location":"Today-I-Learned/2021/#git-clean-merged-local-branches","title":"Git - Clean merged local branches","text":"<pre><code>git branch --merged | egrep -v \"(^\\*|master)\" | xargs git branch -d\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-08-19","title":"2021-08-19","text":""},{"location":"Today-I-Learned/2021/#redis-benchmark","title":"Redis - benchmark","text":"<pre><code>&lt; 1 KB , 200k rps, 2ms\n&gt; 65 KB, &lt; 100k rps, 4ms\nreclaim: Is TTL setted.\naws redis node: 65k connections limited\n</code></pre>"},{"location":"Today-I-Learned/2021/#redis-gui-tools-with-analysis","title":"Redis - GUI tools with analysis","text":"<p>https://redis.com/redis-enterprise/redis-insight/</p>"},{"location":"Today-I-Learned/2021/#2021-06-15","title":"2021-06-15","text":""},{"location":"Today-I-Learned/2021/#git-dont-show-morecontinue","title":"Git - don't show more/continue","text":"<pre><code>git config --global pager.log false\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-05-06","title":"2021-05-06","text":""},{"location":"Today-I-Learned/2021/#kubernetes-upgrade-cert-manager-to-v131","title":"Kubernetes - Upgrade cert-manager to v1.3.1","text":"<p>Check exited CRD resources.</p> <pre><code>kubectl get Issuers,ClusterIssuers,Certificates,CertificateRequests,Orders,Challenges --all-namespaces\n</code></pre> <p>Backup resources.</p> <pre><code>kubectl get -o yaml \\\n     --all-namespaces \\\n     issuer,clusterissuer,certificates &gt; cert-manager-backup.yaml\n</code></pre> <p>Use Helm to deploy <code>cert-manager:v1.3.1</code> <pre><code>helm install \\\n  cert-manager jetstack/cert-manager \\\n  --namespace cert-manager \\\n  --create-namespace \\\n  --version v1.3.1 \\\n  --set installCRDs=true\n</code></pre></p>"},{"location":"Today-I-Learned/2021/#2021-04-29","title":"2021-04-29","text":""},{"location":"Today-I-Learned/2021/#redis-cluster-failover","title":"Redis - Cluster failover","text":"<p>3 master down -&gt; cluster shutdown, can't failover to replicas   -&gt; when 2 master back, still not back   -&gt; need all 3 master back and re-sync</p> <p>1 master + 1 replica down -&gt; cluster shutdown   -&gt; 1 master back, still not back</p> <p>2 master down -&gt; cluster shutdown   -&gt; 1 master back, still not back</p> <p>conclusion:</p> <ul> <li>If cluster turns down, need all nodes re-sync to get it back.</li> <li>over 1/2 master down at same time will cause cluster down</li> <li>1 shard down will cause cluster down</li> </ul>"},{"location":"Today-I-Learned/2021/#2021-04-15","title":"2021-04-15","text":""},{"location":"Today-I-Learned/2021/#mongo-sharding-not-enabled-for-db","title":"Mongo - sharding not enabled for db","text":"<pre><code>sh.enableSharding(\"mydatabase\")\n</code></pre>"},{"location":"Today-I-Learned/2021/#mongo-update-on-a-sharded-collection-must-either-contain-an-exact-match-on-_id-or-must-target-a-single-shard","title":"Mongo - update on a sharded collection must either contain an exact match on _id or must target a single shard","text":"<p>A {multi:false} update on a sharded collection must either contain an exact match on _id or must target a single shard but this update targeted _id (and have the collection default collation) or must target a single shard (and have the simple collation), but this update targeted 2 shards. Update request: { q: { nb: 0 }, u: { $set: { date: new Date(1618511355253), c32: 13, c64: 10818 } }, multi: false, upsert: false }, shard key pattern: { c32: 1.0, c64: 1.0 }, full error: {'index': 0, 'code': 72, 'codeName': 'InvalidOptions', 'errmsg': 'A {multi:false} update on a sharded collection must either contain an exact match on _id or must target a single shard but this update targeted _id (and have the collection default collation) or must target a single shard (and have the simple collation), but this update targeted 2 shards. Update request: { q: { nb: 0 }, u: { $set: { date: new Date(1618511355253), c32: 13, c64: 10818 } }, multi: false, upsert: false }, shard key pattern: { c32: 1.0, c64: 1.0 }'}</p> <p>New document must contains shard key fields. In this case is <code>c32, c64</code>.</p>"},{"location":"Today-I-Learned/2021/#2021-04-14","title":"2021-04-14","text":""},{"location":"Today-I-Learned/2021/#mongo-transaction","title":"Mongo - transaction","text":""},{"location":"Today-I-Learned/2021/#gke-neg-get-502-when-rollingupate","title":"GKE - NEG get 502 when rollingUpate","text":"<p>credit:</p> <ul> <li>https://cloud.google.com/kubernetes-engine/docs/how-to/standalone-neg#traffic_does_not_reach_the_endpoints</li> <li>https://pracucci.com/graceful-shutdown-of-kubernetes-pods.html</li> </ul> <pre><code>        lifecycle:\n          preStop:\n            exec:\n              # SIGTERM triggers a quick exit; gracefully terminate instead\n              command: [\"nginx\", \"-s\", \"quit\"]\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-04-13","title":"2021-04-13","text":""},{"location":"Today-I-Learned/2021/#gsutil-download-large-file-with-crcmod-on-macos","title":"gsutil - Download large file with crcmod on macOS","text":"<p><code>pip3 install -U crcmod</code></p> <p>Before:</p> <pre><code># gsutil version -l\ngsutil version: 4.55\nchecksum: adebf7d276641651e3345d12aca978c0 (OK)\nboto version: 2.49.0\npython version: 3.9.4 (default, Apr  5 2021, 01:47:16) [Clang 11.0.0 (clang-1100.0.33.17)]\nOS: Darwin 18.7.0\nmultiprocessing available: True\nusing cloud sdk: True\npass cloud sdk credentials to gsutil: True\nconfig path(s): /Users/rammus/.boto, /Users/rammus/.config/gcloud/legacy_credentials/rammus.xu@swag.live/.boto\ngsutil path: /usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/bin/gsutil\ncompiled crcmod: False\ninstalled via package manager: False\neditable install: False\n</code></pre> <p>After:</p> <pre><code># gsutil version -l\ngsutil version: 4.55\nchecksum: adebf7d276641651e3345d12aca978c0 (OK)\nboto version: 2.49.0\npython version: 3.9.4 (default, Apr  5 2021, 01:47:16) [Clang 11.0.0 (clang-1100.0.33.17)]\nOS: Darwin 18.7.0\nmultiprocessing available: True\nusing cloud sdk: True\npass cloud sdk credentials to gsutil: True\nconfig path(s): /Users/rammus/.boto, /Users/rammus/.config/gcloud/legacy_credentials/rammus.xu@swag.live/.boto\ngsutil path: /usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/bin/gsutil\ncompiled crcmod: True\ninstalled via package manager: False\neditable install: False\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-03-29","title":"2021-03-29","text":""},{"location":"Today-I-Learned/2021/#kubernetes-install-cert-manager-v120","title":"Kubernetes - Install cert-manager v1.2.0","text":"<pre><code>helm repo add jetstack https://charts.jetstack.io\nhelm repo update\n\nhelm install \\\n  cert-manager jetstack/cert-manager \\\n  --namespace cert-manager \\\n  --version v1.2.0 \\\n  --create-namespace \\\n  --set installCRDs=true\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-03-25","title":"2021-03-25","text":""},{"location":"Today-I-Learned/2021/#docker-cant-resolve-host-on-build-time","title":"docker - Can't resolve host on build time","text":"<pre><code>Resolving github.com (github.com)... failed: Name does not resolve.\nwget: unable to resolve host address 'github.com'\n</code></pre> <p>Solution</p> <p>Upgrade docker desktop to &gt; 3.1.0</p> <p>This happens on my Macbook Pro (<code>docker desktop: 2.5.0.1</code>).</p> <p>It's fixed after I upgrade to <code>3.2.2</code>.</p>"},{"location":"Today-I-Learned/2021/#2021-03-24","title":"2021-03-24","text":""},{"location":"Today-I-Learned/2021/#linkerd-vs-istio-on-2019","title":"Linkerd vs Istio on 2019","text":"<p>https://medium.com/@michael_87395/benchmarking-istio-linkerd-cpu-c36287e32781</p> <p>Istio\u2019s Envoy proxy uses more than 50% more CPU than Linkerd\u2019s</p> <ul> <li>k8s: 1.12.7-gke.7</li> <li>node: n1-standard-4</li> <li>4-16 nodes</li> <li>linkerd: 2.3.0 (now: 2.10)</li> <li>istio: 1.0.6 (now: 1.9.0)</li> </ul>"},{"location":"Today-I-Learned/2021/#2021-03-18","title":"2021-03-18","text":""},{"location":"Today-I-Learned/2021/#tcp-3-way-handshake","title":"\u70ba\u4ec0\u9ebc TCP \u8981 3-way handshake","text":"<p>https://draveness.me/whys-the-design-tcp-three-way-handshake/</p> <ul> <li>TCP \u662f\u96d9\u5411\u5c0d\u8a71 (bi-directional communication protocol)</li> <li>\u96d9\u65b9\u90fd\u9700\u8981 SYN, ACK</li> </ul> <pre><code>Client ------SYN-----&gt; Server\nClient &lt;---ACK/SYN---- Server\nClient ------ACK-----&gt; Server\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-03-15","title":"2021-03-15","text":""},{"location":"Today-I-Learned/2021/#docker-run-different-platform-architecture-images-on-apple-m1-mini","title":"Docker - Run different platform architecture images on Apple M1 mini","text":"<pre><code>rammus.xu@mac-mini ~ % docker run -it --rm alpine uname -a\nLinux ffb2f47751c8 4.19.121-linuxkit #1 SMP PREEMPT Thu Jan 21 15:45:22 UTC 2021 aarch64 Linux\nrammus.xu@mac-mini ~ % docker run -it --rm --platform amd64 alpine uname -a\nUnable to find image 'alpine:latest' locally\nlatest: Pulling from library/alpine\nba3557a56b15: Pull complete\nDigest: sha256:a75afd8b57e7f34e4dad8d65e2c7ba2e1975c795ce1ee22fa34f8cf46f96a3be\nStatus: Downloaded newer image for alpine:latest\ndocker: Error response from daemon: image with reference alpine was found but does not match the specified platform: wanted darwin/amd64, actual: linux/amd64.\nSee 'docker run --help'.\nrammus.xu@mac-mini ~ % docker run -it --rm --platform linux/amd64 alpine uname -a\nLinux f313db1d82a1 4.19.121-linuxkit #1 SMP PREEMPT Thu Jan 21 15:45:22 UTC 2021 x86_64 Linux\nrammus.xu@mac-mini ~ % docker run -it --rm --platform linux/i386 alpine uname -a\nUnable to find image 'alpine:latest' locally\nlatest: Pulling from library/alpine\n86205afa28f6: Pull complete\nDigest: sha256:a75afd8b57e7f34e4dad8d65e2c7ba2e1975c795ce1ee22fa34f8cf46f96a3be\nStatus: Downloaded newer image for alpine:latest\nLinux 4aff8fb39ae9 4.19.121-linuxkit #1 SMP PREEMPT Thu Jan 21 15:45:22 UTC 2021 i686 Linux\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-03-09","title":"2021-03-09","text":""},{"location":"Today-I-Learned/2021/#kubernetes-increase-metrics-server-resources-cpumemory","title":"Kubernetes - Increase metrics-server resources (cpu/memory)","text":"<p>Metrics not available for pod</p> <p>Ref: https://github.com/kubernetes/autoscaler/tree/master/addon-resizer</p> <p>Environment:</p> <ul> <li>Kubernetes: v1.17.15-gke.800</li> </ul> <p>It's 3-5 minutes downtime.</p> <pre><code>&gt; kubectl apply -f metrics-server-config.yaml\n</code></pre> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  labels:\n    addonmanager.kubernetes.io/mode: EnsureExists\n    kubernetes.io/cluster-service: \"true\"\n  name: metrics-server-config\n  namespace: kube-system\ndata:\n  NannyConfiguration: |-\n    apiVersion: nannyconfig/v1alpha1\n    kind: NannyConfiguration\n    baseCPU: 200m\n    cpuPerNode: 2m\n    baseMemory: 150Mi\n    memoryPerNode: 4Mi\n</code></pre> <pre><code>&gt; kubectl delete deployment -n kube-system metrics-server-v0.3.6\ndeployment.apps \"metrics-server-v0.3.6\" deleted\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-02-23","title":"2021-02-23","text":""},{"location":"Today-I-Learned/2021/#2021-client-side-real-user-monitoring-rum","title":"2021 Client Side Real User Monitoring (RUM)","text":"<p>Cloud Hosted:</p> <ul> <li>Aliyun ARMS - https://www.alibabacloud.com/help/doc-detail/58652.htm</li> <li>pricing: https://www.alibabacloud.com/tc/product/arms/pricing</li> <li>Datadog - https://www.datadoghq.com/product/real-user-monitoring/</li> <li>Micro Focus - https://www.microfocus.com/en-us/products/end-user-monitoring/overview</li> </ul> <p>Self Hosted:</p> <ul> <li>Elastic - https://www.elastic.co/guide/en/apm/agent/rum-js/current/intro.html</li> <li>boomerang - https://github.com/akamai/boomerang</li> <li>server:<ul> <li>2018 https://github.com/springernature/boomcatch</li> <li>2016 https://github.com/andreas-marschke/boomerang-express</li> </ul> </li> <li>https://matomo.org/</li> <li>demo: https://demo.matomo.cloud/index.php</li> <li>https://github.com/basicrum/backoffice</li> </ul>"},{"location":"Today-I-Learned/2021/#2021-02-05","title":"2021-02-05","text":""},{"location":"Today-I-Learned/2021/#kubernetes-use-annotation-and-initcontainer-to-donwload-gcs-files","title":"Kubernetes - Use annotation and initContainer to donwload GCS files","text":"<pre><code>apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: test\nspec:\n  selector:\n    matchLabels:\n      app: demo\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: demo\n      annotations:\n        update: \"true\"\n    spec:\n      volumes:\n      - name: assets\n        emptyDir: {}\n      initContainers:\n      - name: download-assets\n        image: gcr.io/google.com/cloudsdktool/cloud-sdk:315.0.0-alpine\n        command: [\"/bin/bash\",\"-c\"]\n        env:\n        - name: IF_UPDATE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.annotations['update']\n        args:\n        - |\n          [ \"$IF_UPDATE\" = \"false\" ] &amp;&amp; exit 0\n          gsutil -m cp -r gs://rammus.tw/assets /assets\n\n        volumeMounts:\n        - name: assets\n          mountPath: /assets\n      containers:\n      - name: nginx\n        image: nginx\n        ports:\n        - containerPort: 80\n        volumeMounts:\n        - name: assets\n          mountPath: /assets\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-01-26","title":"2021-01-26","text":""},{"location":"Today-I-Learned/2021/#docker-build-a-userspace-wireguard-image","title":"Docker - Build a userspace Wireguard image","text":"<p><code>ghcr.io/linuxserver/wireguard</code> default to use Linux kernal library. If you want to use userspace library or your machine doesn't support Linux kernal library.</p> <pre><code>FROM rust:1.40-slim-buster AS builder\n\nARG BORINGTUN_VERSION=0.3.0\n\nRUN cargo install boringtun --version ${BORINGTUN_VERSION}\n\n###\n\nFROM ghcr.io/linuxserver/wireguard:version-v1.0.20200827\n\nCOPY --from=builder /usr/local/cargo/bin/boringtun /usr/local/bin\n\nENV WG_QUICK_USERSPACE_IMPLEMENTATION=boringtun \\\n    WG_SUDO=1\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-01-25","title":"2021-01-25","text":""},{"location":"Today-I-Learned/2021/#mongodb-get-wiredtiger-stats","title":"MongoDB - Get wiredTiger stats","text":"<p>ref: https://docs.mongodb.com/manual/reference/command/serverStatus/#wiredtiger</p> <pre><code>db.runCommand( { serverStatus: 1 } ).wiredTiger\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-01-21","title":"2021-01-21","text":""},{"location":"Today-I-Learned/2021/#mkdocs-material-lexers-code-block-supported-programming-languages","title":"mkdocs-material lexers - code block supported programming languages","text":"<p>mkdocs-material \u4f7f\u7528 pygments \u7576\u4f5c\u8a9e\u6cd5\u5206\u6790\u5668\uff0c\u4ee5\u4e0b\u662f\u80fd\u652f\u63f4\u7684\u7a0b\u5f0f\u8a9e\u8a00</p> <pre><code>as3, actionscript3\nas, actionscript\nmxml\nbc\ngap\nmathematica, mma, nb\nmupad\nat, ambienttalk, ambienttalk/2\nampl\napl\nadl\ncadl\nodin\narrow\nc-objdump\nca65\ncpp-objdump, c++-objdumb, cxx-objdump\nd-objdump\ndasm16\ngas, asm\nhsail, hsa\nllvm\nllvm-mir-body\nllvm-mir\nnasm\nobjdump-nasm\nobjdump\ntasm\nautoit\nahk, autohotkey\nbare\nbbcbasic\nblitzbasic, b3d, bplus\nblitzmax, bmax\ncbmbas\nmonkey\nqbasic, basic\nvbscript\nbst, bst-pybtex\nbib, bibtex\nboa\nabap\ncobolfree\ncobol\ngooddata-cl\nmaql\nopenedge, abl, progress\nc\ncpp, c++\narduino\ncharmci\nclay\ncuda, cu\nec\nmql, mq4, mq5, mql4, mql5\nnesc\npike\nswig\nvala, vapi\ncapnp\nchapel, chpl\nclean\napacheconf, aconf, apache\naugeas\ncfengine3, cf3\ndocker, dockerfile\nini, cfg, dosini\nkconfig, menuconfig, linux-config, kernel-config\nlighty, lighttpd\nnginx\npacmanconf\npkgconfig\nproperties, jproperties\nregistry\nsingularity\nsquidconf, squid.conf, squid\ntoml\ntermcap\nterminfo\nterraform, tf\npypylog, pypy\nvctreestatus\ncr, crystal\ncsound-document, csound-csd\ncsound, csound-orc\ncsound-score, csound-sco\ncss\nless\nsass\nscss\ncroc\nd\nminid\nsmali\nNone\njsonld, json-ld\njson, json-object\nyaml\ndevicetree, dts\ndpatch\ndiff, udiff\nwdiff\nboo\naspx-cs\ncsharp, c#\nfsharp, f#\nnemerle\naspx-vb\nvb.net, vbnet\nalloy\ncrmsh, pcmk\nflatline\nmscgen, msc\npan\nprotobuf, proto\npuppet\nrsl\nsnowball\nthrift\nvgl\nzeek, bro\ndylan-console, dylan-repl\ndylan\ndylan-lid, lid\necl\neiffel\nelm\nemail, eml\niex\nelixir, ex, exs\nerlang\nerl\naheui\nbefunge\nbrainfuck, bf\ncamkes, idl4\ncapdl\nredcode\nezhil\nfactor\nfan\nfelix, flx\nfloscript, flo\nforth\nfortranfixed\nfortran\nfoxpro, vfp, clipper, xbase\nfreefem\ngdscript, gd\ngo\nabnf\nbnf\njsgf\npeg\ncypher\nasy, asymptote\nglsl\ngnuplot\nhlsl\npostscript, postscr\npov\nagda\ncryptol, cry\nhaskell, hs\nhspec\nidris, idr\nkoka\nlagda, literate-agda\nlcry, literate-cryptol, lcryptol\nlhs, literate-haskell, lhaskell\nlidr, literate-idris, lidris\nhx, haxe, hxsl\nhaxeml, hxml\nsystemverilog, sv\nverilog, v\nvhdl\nhexdump\ndtd\nhaml\nhtml\npug, jade\nscaml\nxml\nxslt\nidl\nigor, igorpro\nlimbo\ncontrol, debcontrol\nnsis, nsi, nsh\nspec\nsourceslist, sources.list, debsources\ninform6, i6\ni6t\ninform7, i7\ntads3\nio\nj\ncoffee-script, coffeescript, coffee\ndart\nearl-grey, earlgrey, eg\njs, javascript\njuttle\nkal\nlasso, lassoscript\nlive-script, livescript\nmask\nobjective-j, objectivej, obj-j, objj\nts, typescript\njlcon\njulia, jl\naspectj\nceylon\nclojure, clj\nclojurescript, cljs\ngolo\ngosu\ngst\ngroovy\nioke, ik\njasmin, jasminxt\njava\nkotlin\npig\nsarl\nscala\nxtend\ncpsa\ncommon-lisp, cl, lisp\nemacs, elisp, emacs-lisp\nfennel, fnl\nhylang\nnewlisp\nracket, rkt\nscheme, scm\nshen\nextempore\nbasemake\ncmake\nmake, makefile, mf, bsdmake\nbbcode\ngroff, nroff, man\nmd, markdown\ntrac-wiki, moin\ncss+mozpreproc\nmozhashpreproc\njavascript+mozpreproc\nmozpercentpreproc\nxul+mozpreproc\nrst, rest, restructuredtext\ntex, latex\ntid\nmatlab\nmatlabsession\noctave\nscilab\nmime\nfstar\nocaml\nopa\nreason, reasonml\nsml\nbugs, winbugs, openbugs\njags\nmodelica\nstan\nmodula2, m2\nmonte\nmosel\nncl\nnim, nimrod\nnit\nnixos, nix\ncomponentpascal, cp\nlogos\nobjective-c, objectivec, obj-c, objc\nobjective-c++, objectivec++, obj-c++, objc++\nswift\nooc\nparasail\nantlr-as, antlr-actionscript\nantlr-csharp, antlr-c#\nantlr-cpp\nantlr-java\nantlr\nantlr-objc\nantlr-perl\nantlr-python\nantlr-ruby, antlr-rb\nebnf\nragel-c\nragel-cpp\nragel-d\nragel-em\nragel-java\nragel\nragel-objc\nragel-ruby, ragel-rb\ntreetop\nada, ada95, ada2005\ndelphi, pas, pascal, objectpascal\npawn\nsp\nperl6, pl6, raku\nperl, pl\nphp, php3, php4, php5\npsysh\nzephir\npointless\npony\npraat\nlogtalk\nprolog\npromql\ncython, pyx, pyrex\ndg\nnumpy\npython2, py2\npy2tb\npycon\npython, py, sage, python3, py3\npytb, py3tb\nqvto, qvt\nrconsole, rout\nrd\nsplus, s, r\nshexc, shex\nsparql\nturtle\nrebol\nred, red/system\nresource, resourcebundle\nride\nrnc, rng-compact\nroboconf-graph\nroboconf-instances\nrobotframework\nfancy, fy\nrbcon, irb\nrb, ruby, duby\nrust, rs\nsas\nscdoc, scd\napplescript\nchai, chaiscript\neasytrieve\nhybris, hy\njcl\nlsl\nlua\nmoocode, moo\nms, miniscript\nmoon, moonscript\nrexx, arexx\nsgf\nbash, sh, ksh, zsh, shell\nconsole, shell-session\nbat, batch, dosbatch, winbatch\nexecline\nfish, fishshell\ndoscon\npowershell, posh, ps1, psm1\nps1con\nslurm, sbatch\ntcsh, csh\ntcshcon\nsieve\nslash\nnewspeak\nsmalltalk, squeak, st\nnusmv\nsnobol\nsolidity\nraw\ntext\nmysql\nplpgsql\npsql, postgresql-console, postgres-console\npostgresql, postgres\nrql\nsql\nsqlite3\ntsql, t-sql\nstata, do\nsc, supercollider\ntcl\nhtml+ng2\nng2\nhtml+cheetah, html+spitfire, htmlcheetah\njs+cheetah, javascript+cheetah, js+spitfire, javascript+spitfire\ncheetah, spitfire\nxml+cheetah, xml+spitfire\ncfc\ncfm\ncfs\ncss+django, css+jinja\ncss+erb, css+ruby\ncss+genshitext, css+genshi\ncss+php\ncss+smarty\ndjango, jinja\nerb\nhtml+evoque\nevoque\nxml+evoque\ngenshi, kid, xml+genshi, xml+kid\ngenshitext\nhtml+handlebars\nhandlebars\nhtml+django, html+jinja, htmldjango\nhtml+genshi, html+kid\nhtml+php\nhtml+smarty\njs+django, javascript+django, js+jinja, javascript+jinja\njs+erb, javascript+erb, js+ruby, javascript+ruby\njs+genshitext, js+genshi, javascript+genshitext, javascript+genshi\njs+php, javascript+php\njs+smarty, javascript+smarty\njsp\ncss+lasso\nhtml+lasso\njs+lasso, javascript+lasso\nxml+lasso\nliquid\ncss+mako\nhtml+mako\njs+mako, javascript+mako\nmako\nxml+mako\nmason\ncss+myghty\nhtml+myghty\njs+myghty, javascript+myghty\nmyghty\nxml+myghty\nrhtml, html+erb, html+ruby\nsmarty\nssp\ntea\nhtml+twig\ntwig\nhtml+velocity\nvelocity\nxml+velocity\nxml+django, xml+jinja\nxml+erb, xml+ruby\nxml+php\nxml+smarty\nyaml+jinja, salt, sls\nttl, teraterm, teratermmacro\ncucumber, gherkin\ntap\nawk, gawk, mawk, nawk\nvim\npot, po\nhttp\nirc\nkmsg, dmesg\nnotmuch\ntodotxt\ncoq\nisabelle\nlean\ntnt\nrts, trafficscript\ntyposcriptcssdata\ntyposcripthtmldata\ntyposcript\nicon\nucode\nunicon\nurbiscript\nusd, usda\nvcl\nvclsnippets, vclsnippet\nboogie\nsilver\nwebidl\ncirru\nduel, jbst, jsonml+bst\nqml, qbs\nslim\nxquery, xqy, xq, xql, xqm\nwhiley\nx10, xten\nxorg.conf\nyang\nzig\n</code></pre>"},{"location":"Today-I-Learned/2021/#2021-01-19","title":"2021-01-19","text":""},{"location":"Today-I-Learned/2021/#ack-failed-to-provision-volume-with-storageclass-alicloud-disk-ssd-rpc-error-code-internal-desc-sdkservererror","title":"ACK - failed to provision volume with StorageClass \"alicloud-disk-ssd\": rpc error: code = Internal desc = SDK.ServerError","text":"<p>ErrorCode: InvalidDiskSize.NotSupported</p> <p>\u56e0\u70ba\u7533\u8acb\u592a\u5c0f\u7684\u5bb9\u91cf\uff0c\u6240\u4ee5\u51fa\u73fe\u9019\u500b\u932f\u8aa4\u3002</p> <p>ref: https://help.aliyun.com/document_detail/127601.html</p> <ul> <li>\u9ad8\u6548\u4e91\u76d8\uff1a\u6700\u5c0f20 GiB\u3002</li> <li>SSD\u4e91\u76d8\uff1a\u6700\u5c0f20 GiB\u3002</li> <li>ESSD\u4e91\u76d8\uff1a\u6700\u5c0f20 GiB\u3002</li> </ul>"},{"location":"Today-I-Learned/2021/#nginx-use-nfs-to-share-proxy_cache","title":"Nginx - Use NFS to share proxy_cache","text":"<pre><code>proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=storage:128m inactive=1y max_size=64G use_temp_path=off;\n</code></pre> <p>Must to add <code>use_temp_path=off</code> which default to <code>on</code>.</p>"},{"location":"Today-I-Learned/2021/#2021-01-08","title":"2021-01-08","text":""},{"location":"Today-I-Learned/2021/#gsutil-upload-file-to-aws-s3","title":"gsutil - Upload file to AWS S3","text":"<p>Least AWS user permission. <pre><code>{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"VisualEditor0\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"s3:PutObject\",\n                \"s3:PutObjectAcl\",\n                \"s3:GetObject\",\n                \"s3:GetObjectAcl\",\n                \"s3:DeleteObject\"\n            ],\n            \"Resource\": \"arn:aws:s3:::backup.rammus.tw/*\"\n        },\n        {\n            \"Sid\": \"VisualEditor1\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"s3:ListBucket\",\n                \"s3:GetBucketLocation\"\n            ],\n            \"Resource\": \"arn:aws:s3:::backup.rammus.tw\"\n        }\n    ]\n}\n</code></pre></p> <p>Generate configuration <pre><code>export AWS_ACCESS_KEY_ID=\nexport AWS_SECRET_ACCESS_KEY=\n\ncat &lt;&lt; EOF &gt; ~/.boto\n[Credentials]\naws_access_key_id = $AWS_ACCESS_KEY_ID\naws_secret_access_key = $AWS_SECRET_ACCESS_KEY\n\n[s3]\ncalling_format = boto.s3.connection.OrdinaryCallingFormat\nuse-sigv4=True\nhost=s3.ap-northeast-1.amazonaws.com\nEOF\n</code></pre></p> <p>Start to uplaod <pre><code>gsutil cp a s3://backup.rammus.tw\n</code></pre></p>"},{"location":"Today-I-Learned/2022/","title":"2022","text":"<p>What I learned in 2022.</p>"},{"location":"Today-I-Learned/2022/#2022-12-27","title":"2022-12-27","text":""},{"location":"Today-I-Learned/2022/#kafka-optimize","title":"Kafka optimize","text":"<p>https://developers.redhat.com/articles/2022/05/03/fine-tune-kafka-performance-kafka-optimization-theorem#kafka_priorities_and_the_cap_theorem </p>"},{"location":"Today-I-Learned/2022/#2022-11-11","title":"2022-11-11","text":""},{"location":"Today-I-Learned/2022/#github-action-publish-markmap-to-github-page","title":"Github Action - Publish markmap to Github Page","text":"<ol> <li>need markmap/ folders</li> </ol> <pre><code>jobs:\n  update-markmap:\n    name: Update Markmap\n    runs-on: [self-hosted]\n    steps:\n      - uses: actions/checkout@v3\n      - name: Install markmap-cli\n        run: |\n          yarn global add markmap-cli markmap-common\n          echo \"`yarn global bin`\" &gt;&gt; $GITHUB_PATH\n      - name: Git init\n        run: |\n          git config --global user.name \"${GITHUB_ACTOR}\"\n          git config --global user.email \"${GITHUB_ACTOR}@users.noreply.github.com\"\n      - name: Build html\n        run: |\n          touch .nojekyll\n          ls markmap | cut -d '.' -f1 | xargs -I@ markmap markmap/@.md --output @.html --no-open\n      - name: Deploy\n        run: |\n          git checkout --orphan gh-pages\n          git reset\n          git add *.html .nojekyll\n          git commit -m \"Generate markmap by Github Action\"\n          git push -u origin HEAD:gh-pages -f\n</code></pre>"},{"location":"Today-I-Learned/2022/#2022-11-07","title":"2022-11-07","text":""},{"location":"Today-I-Learned/2022/#mermaid-example-with-better-theme-color","title":"Mermaid example with better theme color","text":"<pre><code>flowchart TD\n    A[Start] --&gt; B{Is it?}\n    B --&gt;|Yes| C[OK]\n    C --&gt; D[Rethink]\n    D --&gt; B\n    B ----&gt;|No| E[End]</code></pre>"},{"location":"Today-I-Learned/2022/#2022-10-04","title":"2022-10-04","text":""},{"location":"Today-I-Learned/2022/#kibana-generate-csv-max-size-reached","title":"Kibana - Generate csv Max size reached","text":"<p>Max size reached</p> <p>Increase <code>maxSizeBytes</code>, it defaults to 10MB.</p> <pre><code>[root@ip-10-16-41-158 kibana]# vi kibana.yml\n\n# xpack.reporting.csv.maxSizeBytes: 104857600\n\n[root@ip-10-16-41-158 kibana]# systemctl restart kibana\n</code></pre>"},{"location":"Today-I-Learned/2022/#2022-07-14","title":"2022-07-14","text":""},{"location":"Today-I-Learned/2022/#elasticseach-snapshot-to-s3-throughtput","title":"ElasticSeach - Snapshot to S3 throughtput","text":"<p>770MB/s</p> <p>env:</p> <ul> <li>AWS: c5.9xlarge</li> <li>50 GB/shard, 20 shard, 1TB data</li> <li>Total run time: 1300s</li> <li>thread pool: <code>snapshot:5</code></li> </ul>"},{"location":"Today-I-Learned/2022/#2022-06-02","title":"2022-06-02","text":""},{"location":"Today-I-Learned/2022/#elasticsearch-searchable-snapshot-wont-delete-index-from-hot-nodes","title":"Elasticsearch - Searchable snapshot won't delete index from hot nodes","text":"<p>Use explain can see <pre><code>GET _cluster/allocation/explain\n</code></pre></p> <pre><code>\"node_decision\" : \"no\",\n\"deciders\" : [\n  {\n    \"decider\" : \"has_frozen_cache\",\n    \"decision\" : \"NO\",\n    \"explanation\" : \"node setting [xpack.searchable.snapshot.shared_cache.size] is set to zero, so frozen searchable snapshot shards cannot be allocated to this node\"\n  }\n]\n</code></pre> <p>So, just add new node with</p> <pre><code>node.roles: [\"data_frozen\"]\n</code></pre>"},{"location":"Today-I-Learned/2022/#2022-05-27","title":"2022-05-27","text":""},{"location":"Today-I-Learned/2022/#elasticsearch-failed-step-attempt-rollover","title":"Elasticsearch - Failed step attempt-rollover","text":"<pre><code>Index lifecycle error\nexception: Concurrent modification of alias [rammus-log] during rollover\n</code></pre> <pre><code>GET .ds-rammus-log-002774/_ilm/explain\nPOST .ds-rammus-log-002773/_ilm/retry\n</code></pre>"},{"location":"Today-I-Learned/2022/#2022-05-03","title":"2022-05-03","text":""},{"location":"Today-I-Learned/2022/#openssl-p12-expired-date","title":"openssl - p12 expired date","text":"<pre><code>openssl pkcs12 -in elastic-certificates.p12 -nodes | openssl x509 -noout -enddate\n</code></pre> <p>Demo <pre><code>\u276f openssl pkcs12 -in elastic-certificates.p12 -clcerts -nodes | openssl x509 -noout -enddate\n\nEnter Import Password:\nMAC verified OK\nnotAfter=Jan 12 08:40:45 2021 GMT\n</code></pre></p>"},{"location":"Today-I-Learned/2022/#2022-05-02","title":"2022-05-02","text":""},{"location":"Today-I-Learned/2022/#free-image","title":"Free image \u514d\u8cbb\u9ad8\u6e05\u5716\u5eab","text":"<ul> <li>https://unsplash.com/</li> </ul>"},{"location":"Today-I-Learned/2022/#2022-04-28","title":"2022-04-28","text":""},{"location":"Today-I-Learned/2022/#eks-cant-create-nlb","title":"EKS - Can't create NLB","text":"<pre><code>{\"level\":\"error\",\"ts\":1651135177.483026,\"logger\":\"controller-runtime.manager.controller.targetGroupBinding\",\"msg\":\"Reconciler error\",\"reconciler group\":\"elbv2.k8s.aws\",\"reconciler kind\":\"TargetGroupBinding\",\"name\":\"k8s-eckpoc-quicksta-6b38f0416c\",\"namespace\":\"eckpoc\",\"error\":\"expect exactly one securityGroup tagged with kubernetes.io/cluster/poc-cluster for eni eni-0e226022e7dd6aa80, got: [sg-011da083ca19a29ef sg-0446f7a0f894dd9a3]\"}\neni eni-0e226022e7dd6aa80, got: [sg-011da083ca19a29ef sg-0446f7a0f894dd9a3]\"}\n</code></pre> <p>Solution</p> <p>Remove the sg with description: <code>EKS created security group applied to ENI that is attached to EKS Control Plane master nodes, as well as any managed workloads.</code></p> <p>I guess it doesn't matters to remove which sg. Both can work.</p> <p>Ref:</p> <ul> <li>https://stackoverflow.com/questions/70688221/registered-targets-disappear</li> <li>https://github.com/kubernetes-sigs/aws-load-balancer-controller/issues/1897</li> </ul>"},{"location":"Today-I-Learned/2022/#2022-04-26","title":"2022-04-26","text":""},{"location":"Today-I-Learned/2022/#google-sheet-insert-image-from-google-drive","title":"Google Sheet - Insert image from Google Drive","text":"<ol> <li>share image to <code>Everyone</code></li> <li>Get link: https://drive.google.com/file/d/1uw0e0ifHq2ibLIAFw8HH7RPKGe-u7i5x/view?usp=sharing</li> <li>Use url in these ways:    a. https://lh6.googleusercontent.com/d/1uw0e0ifHq2ibLIAFw8HH7RPKGe-u7i5x    b. https://drive.google.com/thumbnail?id=1uw0e0ifHq2ibLIAFw8HH7RPKGe-u7i5x</li> </ol>"},{"location":"Today-I-Learned/2022/#2022-03-29","title":"2022-03-29","text":""},{"location":"Today-I-Learned/2022/#elasticsearch-kibana-cant-compatible-with-downstair-versions","title":"ElasticSearch - Kibana can't compatible with downstair versions.","text":"<pre><code>wget https://artifacts.elastic.co/downloads/kibana/kibana-7.16.3-x86_64.rpm\nyum localinstall -y kibana-7.16.3-x86_64.rpm\n\n{\"type\":\"log\",\"@timestamp\":\"2022-03-29T07:53:52+00:00\",\"tags\":[\"error\",\"elasticsearch-service\"],\"pid\":10677,\"message\":\"This version of Kibana (v7.16.3) is incompatible with the following Elasticsearch nodes inyour cluster:v7.9.3 @ 10.16.41.65:9200 (10.16.41.65), v7.9.3 @ 10.16.41.126:9200 (10.16.41.126) ...}\n</code></pre>"},{"location":"Today-I-Learned/2022/#kibana-install-in-yum","title":"Kibana - Install in yum","text":"<pre><code>wget https://artifacts.elastic.co/downloads/kibana/kibana-7.16.3-x86_64.rpm\nyum localinstall -y kibana-7.16.3-x86_64.rpm\n</code></pre>"},{"location":"Today-I-Learned/2022/#2022-03-15","title":"2022-03-15","text":""},{"location":"Today-I-Learned/2022/#elasticsearch-cluster-full-restart-needs-security-7-index-shard","title":"ElasticSearch - cluster full restart needs .security-7 index shard","text":"<ul> <li>master might store auth data in memory</li> <li>when masters shutdown, they will need data node contains .security-7 index shard</li> </ul> <pre><code>xpack.security.enabled: true\nxpack.security.transport.ssl.enabled: true\nxpack.security.transport.ssl.verification_mode: certificate\nxpack.security.transport.ssl.keystore.path: elastic-certificates.p12\nxpack.security.transport.ssl.truststore.path: elastic-certificates.p12\n</code></pre>"},{"location":"Today-I-Learned/2022/#2022-03-11","title":"2022-03-11","text":""},{"location":"Today-I-Learned/2022/#elasticsearch-change-mapping-fail-cannot-be-changed-from-type-text-to-keyword","title":"ElasticSearch - Change mapping fail, cannot be changed from type [text] to [keyword]","text":"<pre><code>\"mapper [message] cannot be changed from type [text] to [keyword]\"\n</code></pre> <p>solution:</p> <ol> <li> <p>Create new index with new mapping <pre><code>POST _reindex\n{\n  \"source\": {\n    \"index\": \"rammus-poc\"\n  },\n  \"dest\": {\n    \"index\": \"rammus-poc-20220311\"\n  }\n}\n</code></pre></p> </li> <li> <p>Use _reindex to migrate data <pre><code>PUT rammus-poc-20220311\n{\n    \"settings\": {\n        \"index\": {\n            \"routing\": {\n                \"allocation\": {\n                    \"total_shards_per_node\": \"1\"\n                }\n            },\n            \"number_of_shards\": \"1\",\n            \"priority\": \"500\",\n            \"number_of_replicas\": \"1\"\n        }\n    },\n    \"mappings\": {\n        \"properties\": {\n          ...\n        }\n    }\n}\n</code></pre></p> </li> </ol>"},{"location":"Today-I-Learned/2022/#2022-03-09","title":"2022-03-09","text":""},{"location":"Today-I-Learned/2022/#awscli-disable-ec2-termination-protection","title":"awscli - disable ec2 termination protection","text":"<pre><code>aws ec2 modify-instance-attribute --no-disable-api-termination --instance-id i-xxxxx --profile rammus-dev\n</code></pre>"},{"location":"Today-I-Learned/2022/#2022-03-07","title":"2022-03-07","text":""},{"location":"Today-I-Learned/2022/#elasticsearch-update-keystore-password","title":"ElasticSearch - update keystore password","text":"<pre><code>echo \"\" | /usr/share/elasticsearch/bin/elasticsearch-keystore add -x -f \"xpack.security.transport.ssl.keystore.secure_password\"\necho \"\" | /usr/share/elasticsearch/bin/elasticsearch-keystore add -x -f \"xpack.security.transport.ssl.truststore.secure_password\"\necho \"\" | /usr/share/elasticsearch/bin/elasticsearch-keystore add -x -f \"xpack.security.http.ssl.keystore.secure_password\"\necho \"\" | /usr/share/elasticsearch/bin/elasticsearch-keystore add -x -f \"xpack.security.http.ssl.truststore.secure_password\"\n</code></pre>"},{"location":"Today-I-Learned/2022/#teleport-for-loop-run-command-in-multiple-machines","title":"Teleport - for loop run command in multiple machines","text":"<pre><code>for ip in 172.21.1.1 172.21.1.2 172.21.1.3\ndo\n  tsh ssh ec2-user@${ip} sudo systemctl restart elasticsearch\ndone\n</code></pre>"},{"location":"Today-I-Learned/2022/#amazon-linux-install-and-start-docker","title":"amazon linux - install and start docker","text":"<pre><code>yum install docker\n\n## Run docker daemon\nsystemctl start docker\n\n## Add permission\nnewgrp docker\nsudo usermod -aG docker ec2-user\n</code></pre>"},{"location":"Today-I-Learned/2023/","title":"2023","text":"<p>What I learned in 2023.</p>"},{"location":"Today-I-Learned/2023/#2023-06-07","title":"2023-06-07","text":""},{"location":"Today-I-Learned/2023/#install-nvm-nodejs-elasticdump-on-amazon-linux","title":"Install nvm, nodejs, elasticdump on Amazon Linux","text":"<pre><code>curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash\n. ~/.nvm/nvm.sh\nnvm install 16\nnpm install elasticdump -g\n</code></pre> <p>Error when <code>nvm install -lts</code>, it not fits to nodejs v18 <pre><code>node: /lib64/libm.so.6: version `GLIBC_2.27' not found (required by node)\nnode: /lib64/libc.so.6: version `GLIBC_2.28' not found (required by node)\n</code></pre></p>"},{"location":"Today-I-Learned/2023/#2023-06-05","title":"2023-06-05","text":""},{"location":"Today-I-Learned/2023/#aws-serverless-showdown-redshift-spectrum-or-athena-which-should-you-choose","title":"AWS Serverless Showdown: Redshift Spectrum or Athena \u2013 Which Should You Choose?","text":"<p>https://www.upsolver.com/blog/aws-serverless-redshift-spectrum-athena</p> <ul> <li>Cost: Redshift &gt; Athena</li> <li>Both $5 per TB, but Redshift have cluster cost</li> <li>Performance: Redshift &gt; Athena</li> <li>Diffcult: Athena &gt; Redshift</li> </ul>"},{"location":"Today-I-Learned/2023/#2023-01-19","title":"2023-01-19","text":""},{"location":"Today-I-Learned/2023/#kubernetes-terminationgraceperiodseconds-must-bigger-than-prestop","title":"Kubernetes - terminationGracePeriodSeconds must bigger than preStop","text":"<p>ref: https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-termination</p> <p>terminationGracePeriodSeconds = sigkill = hard kill</p> <p>preStop = sigterm = soft kill</p> <p>When preStop runtime is over terminationGracePeriodSeconds, pod is killed forcefully.</p> <p>And Kubernetes Event is like:</p> <pre><code>Exec lifecycle hook ([/bin/sh -c sleep 180]) for Container \"...\" in Pod \"...\" failed - error: command '/bin/sh -c sleep 180' exited with 137: , message: \"\"\n</code></pre>"},{"location":"Today-I-Learned/2024/","title":"2024","text":"<p>What I learned in 2024.</p>"},{"location":"Today-I-Learned/2024/#2024-07-05","title":"2024-07-05","text":""},{"location":"Today-I-Learned/2024/#gke-gateway-vs-ingress","title":"GKE Gateway vs Ingress","text":"<p>Requirement</p> <ol> <li>*.rammus.comhttp://dev.eslite.com/\u00a0+ GKE<ol> <li>free cert + auto renew + IaC</li> </ol> </li> <li>GCP LB -&gt; GKE service<ol> <li>enable CDN, WAF</li> </ol> </li> <li>img.rammus.comhttp://dev.eslite.com/\u00a0-&gt; GKE service \u2192 GCS<ol> <li>enable CDN</li> </ol> </li> </ol> <p>Study:</p> <ol> <li>GKE gateway \u4e0d\u80fd\u7528 CDN, \u53ef\u4ee5\u7528 armor<ol> <li>https://cloud.google.com/kubernetes-engine/docs/how-to/gatewayclass-capabilities</li> <li>how:\u00a0https://mile.cloud/zh/resources/blog/GCP-Certificate-Manager-WildCard-Cert-with-GKE-Gateway_705</li> </ol> </li> <li>GKE ingress \u624d\u80fd\u7528 armor + CDN<ol> <li>https://cloud.google.com/load-balancing/docs/https#backend-service</li> </ol> </li> <li>GKE ingress + wildcard certificate<ol> <li>\u4e0d\u80fd\u7528 CRD: ManagedCertificate\u00a0https://cloud.google.com/kubernetes-engine/docs/how-to/managed-certs#limitations\u00a0\uff0c\u9019\u6703\u505a\u6210\u820a\u7248\u7684 SSL certificate</li> <li>\u8981\u7528 dns-auth\u00a0https://cloud.google.com/certificate-manager/docs/deploy-google-managed-dns-auth#create-cert-dns-auth</li> </ol> </li> <li>(optional) GKE ingress + cert-manager(Let's Encrypt)\uff0c\u8981\u7528\u4ee5\u4e0b\u5169\u7bc7\u6559\u5b78<ol> <li>https://cert-manager.io/docs/tutorials/getting-started-with-cert-manager-on-google-kubernetes-engine-using-lets-encrypt-for-ingress-ssl/</li> <li>https://cert-manager.io/docs/tutorials/acme/dns-validation/</li> </ol> </li> </ol>"},{"location":"snippets/alpine-linux/","title":"Alpine linux","text":"<p>Alpine Linux examples, template, snippet</p>"},{"location":"snippets/alpine-linux/#useful-packages","title":"Useful packages","text":"<pre><code>apk add busybox-extra\napk add bind-tools\napk add curl httpie\n</code></pre>"},{"location":"snippets/alpine-linux/#build-gcc","title":"Build gcc","text":"<p><pre><code>apk add build-base linux-headers\n</code></pre> <pre><code>$ docker run -it --rm alpine:3.12 apk add build-base linux-headers\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.12/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.12/community/x86_64/APKINDEX.tar.gz\n(1/22) Upgrading musl (1.1.24-r8 -&gt; 1.1.24-r9)\n(2/22) Installing libgcc (9.3.0-r2)\n(3/22) Installing libstdc++ (9.3.0-r2)\n(4/22) Installing binutils (2.34-r1)\n(5/22) Installing libmagic (5.38-r0)\n(6/22) Installing file (5.38-r0)\n(7/22) Installing gmp (6.2.0-r0)\n(8/22) Installing isl (0.18-r0)\n(9/22) Installing libgomp (9.3.0-r2)\n(10/22) Installing libatomic (9.3.0-r2)\n(11/22) Installing libgphobos (9.3.0-r2)\n(12/22) Installing mpfr4 (4.0.2-r4)\n(13/22) Installing mpc1 (1.1.0-r1)\n(14/22) Installing gcc (9.3.0-r2)\n(15/22) Installing musl-dev (1.1.24-r9)\n(16/22) Installing libc-dev (0.7.2-r3)\n(17/22) Installing g++ (9.3.0-r2)\n(18/22) Installing make (4.3-r0)\n(19/22) Installing fortify-headers (1.1-r0)\n(20/22) Installing patch (2.7.6-r6)\n(21/22) Installing build-base (0.5-r2)\n(22/22) Installing linux-headers (5.4.5-r1)\nExecuting busybox-1.31.1-r16.trigger\nOK: 213 MiB in 35 packages\n</code></pre></p>"},{"location":"snippets/aws/","title":"AWS","text":"<p>useful awscli, concept</p>"},{"location":"snippets/aws/#awscli","title":"awscli","text":"<pre><code>export AWS_PROFILE=dev\n</code></pre>"},{"location":"snippets/aws/#ec2","title":"ec2","text":""},{"location":"snippets/aws/#tags","title":"tags","text":"<p>create/update tags <pre><code>aws ec2 create-tags \\\n    --resources i-xxxxxxxxx \\\n    --tags 'Key=app,Value=kafka'\n</code></pre></p> <p>search by tags <pre><code>aws ec2 describe-instances \\\n    --filters Name=tag:app,Values=kafka\n\naws ec2 describe-instances \\\n    --filters Name=tag:app,Values=kafka \\\n    --query 'Reservations[*].Instances[*].{Instance:InstanceId,Tags:Tags}'\n\naws ec2 describe-instances \\\n    --filters 'Name=tag:Name,Values=*kafka*'\n\naws ec2 describe-instances \\\n    --filters 'Name=tag:Name,Values=*kafka_logs*' \\\n    --query 'Reservations[*].Instances[*].{Instance:InstanceId,Name:Tags[?Key==`Name`]|[0].Value}' \\\n    --output text\n</code></pre> more example: https://docs.aws.amazon.com/cli/latest/reference/ec2/describe-instances.html</p>"},{"location":"snippets/aws/#disable-termination-protection","title":"disable termination protection","text":"<pre><code>aws ec2 modify-instance-attribute --no-disable-api-termination --instance-id i-xxxxx --profile rammus-dev\n</code></pre>"},{"location":"snippets/bash/","title":"Bash","text":""},{"location":"snippets/bash/#date","title":"Date","text":"<pre><code>DATE=$(date +%Y%m%d_%H%M%S)\nFILE=\"/backup/backup-$DATE\"\n</code></pre>"},{"location":"snippets/bash/#loop","title":"Loop","text":"<pre><code>for OUTPUT in $(Linux-Or-Unix-Command-Here)\ndo\n    command1 on $OUTPUT\n    command2 on $OUTPUT\n    commandN\ndone\n</code></pre> <p>ref: https://www.cyberciti.biz/faq/bash-for-loop/</p>"},{"location":"snippets/bash/#varaible","title":"Varaible","text":""},{"location":"snippets/bash/#_1","title":"\b\b\u8a2d\u5b9a/\u522a\u9664","text":"<pre><code>export A_VARIBALE\nunset A_VARIBALE\n</code></pre>"},{"location":"snippets/bash/#_2","title":"\u4f7f\u7528\u9810\u8a2d\u503c","text":"<pre><code>ACTOR=${ACTOR:-$GITHUB_ACTOR}\n</code></pre> <pre><code>qq=ops:default\necho ${qq#*:}\n# default\necho ${qq%:*}\n# ops\n</code></pre>"},{"location":"snippets/bash/#return-error-code-when-a-variable-is-not-found","title":"Return error code when a variable is not found","text":"<p>ref: https://stackoverflow.com/a/307735/3854890 <pre><code>sh-3.2$ STATE=abc\nsh-3.2$ : ${STATE:?\"Need to set STATE\"}\nsh-3.2$ echo $?\n0\nsh-3.2$ unset STATE\nsh-3.2$ : ${STATE:?\"Need to set STATE\"}\nsh: STATE: Need to set STATE\nsh-3.2$ echo $?\n1\n</code></pre></p>"},{"location":"snippets/bash/#echo-bash-list-with-comma","title":"Echo Bash List with comma(,)","text":"<pre><code>ROLE_PERMISSIONS=(\n    compute.disks.get\n    compute.disks.create\n    compute.disks.createSnapshot\n    compute.snapshots.get\n    compute.snapshots.create\n    compute.snapshots.useReadOnly\n    compute.snapshots.delete\n    compute.zones.get\n)\n\necho \"$(IFS=\",\"; echo \"${ROLE_PERMISSIONS[*]}\")\"\n</code></pre>"},{"location":"snippets/bash/#folder-path","title":"\u66ab\u6642\u9032\u5230\u67d0\u500b folder \u57f7\u884c\u6307\u4ee4\uff0c\u4e0d\u6539\u8b8a\u76ee\u524d path","text":"<pre><code>(cd src/ &amp;&amp; git checkout $NEW_VERSION_SHA)\n</code></pre>"},{"location":"snippets/bash/#ansi-","title":"ANSI - \u8f38\u51fa\u6587\u5b57\u8b8a\u8272","text":"<p>https://misc.flogisoft.com/bash/tip_colors_and_formatting <pre><code>echo -e \"Default \\e[31mRed\"\necho -e \"\\e[31mHello\\e[0m World\"\necho -e \"\\e[1;31mHello\\e[0m World\"\n</code></pre> <code>-e</code>: to use <code>\\e[31m</code></p>"},{"location":"snippets/bash/#reference","title":"Reference","text":"<ul> <li>https://devhints.io/bash</li> <li>Bash FAQ: http://mywiki.wooledge.org/BashFAQ/031</li> </ul>"},{"location":"snippets/docker-compose/","title":"Docker Compose","text":"<pre><code>version: '3'\nservices:\n  web:\n    build: .\n    ports:\n      - \"5000:5000\"\n  redis:\n    image: \"redis:alpine\"\n</code></pre> <pre><code>    networks:\n      - frontend\n\nnetworks:\n  frontend:\n    name: custom_frontend\n</code></pre>"},{"location":"snippets/docker-compose/#connect-to-redis","title":"Connect to redis","text":"<pre><code>version: '3'\nservices:\n  redis:\n    image: \"redis:alpine\"\n    ports:\n      - \"6379:6379\"\n  celery:\n    image: \"celery:4.0.2\"\n    environment:\n      - CELERY_BROKER_URL=redis://redis\n  celery-2:\n    image: \"celery:4.0.2\"\n    environment:\n      - CELERY_BROKER_URL=redis://redis\n</code></pre> <pre><code>docker exec -it celery_celery_1 ping redis\ndocker exec -it celery_celery_1 ping redis-not-found\n</code></pre>"},{"location":"snippets/docker-compose/#reference","title":"Reference","text":"<ul> <li>https://docs.docker.com/compose/compose-file/</li> </ul>"},{"location":"snippets/docker/","title":"Docker","text":""},{"location":"snippets/docker/#install-docker","title":"Install docker","text":"<p>ref: https://docs.docker.com/engine/install/ubuntu/#install-using-the-convenience-script</p> <pre><code>curl -fsSL https://get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\nsudo usermod -aG docker rammus\n</code></pre> <p>docker-compose: https://docs.docker.com/compose/install/ <pre><code>sudo curl -L \"https://github.com/docker/compose/releases/download/1.27.4/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\n</code></pre></p>"},{"location":"snippets/docker/#minimize-docker-image","title":"Minimize docker image","text":""},{"location":"snippets/docker/#delete-libraries-only-used-in-build-time","title":"Delete libraries only used in build time","text":"<pre><code>apk update \\\n    &amp;&amp; apk add --no-cache --virtual .build-deps curl \\\n    &amp;&amp; curl -sL $TOOL_URL | gzip -d - &gt; /usr/local/bin/new_tool \\\n    &amp;&amp; chmod +x /usr/local/bin/new_tool \\\n    &amp;&amp; apk del .build-deps\n</code></pre>"},{"location":"snippets/docker/#clena-docker-legacy-data","title":"Clena docker legacy data","text":"<pre><code>docker image prune -af\ndocker rmi $(docker images -f \"dangling=true\" -q) -f\ndocker volume rm $(docker volume ls -qf dangling=true)\n</code></pre>"},{"location":"snippets/docker/#buildkit","title":"Buildkit","text":""},{"location":"snippets/docker/#troubleshooting","title":"Troubleshooting","text":""},{"location":"snippets/docker/#registry-mirrors-httpsmirrorgcrio-cause-error","title":"{\"registry-mirrors\": [\"https://mirror.gcr.io\"]} cause error","text":"<p>\u4e0d\u80fd\u548c registry-mirrors \u4e00\u8d77\u7528 (issue: https://github.com/moby/moby/issues/39120)</p>"},{"location":"snippets/docker/#resolve-image-config-for-dockeriodockerdockerfileexperimental","title":"resolve image config for docker.io/docker/dockerfile:experimental:","text":"<pre><code>DOCKER_BUILDKIT=1 docker build -t demo .\n\n[+] Building 0.5s (3/3) FINISHED\n =&gt; [internal] load build definition from Dockerfile                                                                         0.0s\n =&gt; =&gt; transferring dockerfile: 259B                                                                                         0.0s\n =&gt; [internal] load .dockerignore                                                                                            0.0s\n =&gt; =&gt; transferring context: 2B                                                                                              0.0s\n =&gt; ERROR resolve image config for docker.io/docker/dockerfile:experimental                                                  0.5s\n------\n &gt; resolve image config for docker.io/docker/dockerfile:experimental:\n------\nfailed to solve with frontend dockerfile.v0: failed to solve with frontend gateway.v0: docker.io/docker/dockerfile:experimental not found\n</code></pre> <p>Solution</p> <p>\u5728 <code>~/.docker/daemon.json</code> \u52a0\u5165 <pre><code>\"features\": {\n    \"buildkit\": true\n}\n</code></pre> \u6216\u662f <pre><code>DOCKER_BUILDKIT=1\n</code></pre></p> <p>\u8981\u5728 Dockerfile \u958b\u982d\u52a0\u5165 <code># syntax = docker/dockerfile:experimental</code> <pre><code># syntax = docker/dockerfile:experimental\nFROM alpine:3.10\n</code></pre> <pre><code>failed to solve with frontend dockerfile.v0: failed to create LLB definition: Dockerfile parse error line 3: Unknown flag: mount\n</code></pre></p>"},{"location":"snippets/docker/#error-failed-to-get-status-rpc-error-code-unavailable-desc-connection-error-desc-transport-error-while-dialing-dial-unix-runbuildkitbuildkitdsock-connect-no-such-file-or-directory","title":"error: failed to get status: rpc error: code = Unavailable desc = connection error: desc = \"transport: error while dialing: dial unix /run/buildkit/buildkitd.sock: connect: no such file or directory\"","text":"<pre><code>error: failed to get status: rpc error: code = Unavailable desc = connection error: desc = \"transport: error while dialing: dial unix /run/buildkit/buildkitd.sock: connect: no such file or directory\"\n</code></pre> <pre><code>buildctl build \\\n  --frontend=dockerfile.v0 \\\n  --local context=echo-box/2.0 --local dockerfile=echo-box/2.0 \\\n  --output type=image,name=ghcr.io/swaglive/action-demo:2.0,push=true \\\n  --export-cache type=inline \\\n  --import-cache type=registry,ref=ghcr.io/swaglive/action-demo:2.0\n</code></pre>"},{"location":"snippets/dockerfiles/","title":"Dockerfiles","text":"<p>Dockerfile examples, template, snippet</p>"},{"location":"snippets/dockerfiles/#javascript","title":"Javascript","text":"<pre><code>FROM        node:12.14.0-alpine3.11 as builder\n\nENV         NODE_ENV=production\nWORKDIR     /app\nCOPY        ./app/package.json ./\nRUN         npm install\nCOPY        ./app ./\n\n###\nFROM        node:12.14.0-alpine3.11\n\nENTRYPOINT npm start\n\nENV         NODE_ENV=production\nWORKDIR     /app\nCOPY        --from=builder /app /app\n</code></pre>"},{"location":"snippets/elasticsearch/","title":"Elasticsearch","text":""},{"location":"snippets/elasticsearch/#status","title":"Status","text":"<pre><code>curl elasticsearch-client.elasticsearch:9200\n\nURL=\"localhost:9200\"\nURL=\"elasticsearch-client:9200\"\ncurl -X GET $URL/\ncurl -X GET \"$URL/_cat/health?v\"\ncurl -X GET \"$URL/_cat/nodes?v\"\ncurl -X GET \"$URL/_cat/indices?v\"\ncurl -X GET \"$URL/_cat/allocation?v\"\ncurl -X GET \"$URL/_cat/shards?v\"\n\ncurl -X GET \"$URL/_all/_settings?pretty\"\n\ncurl -X GET http://$URL/_nodes/jvm?pretty\ncurl -X GET http://$URL/_nodes/process?pretty\n\n\ncurl -X GET \"$URL/_nodes/stats?pretty\"\ncurl -X GET \"$URL/_nodes/nodeId1,nodeId2/stats\"\ncurl -X GET \"$URL/_nodes/elasticsearch-data-2/stats\"\n\n\ncurl -X GET $URL/_cluster/health?pretty\ncurl -X GET $URL/_cluster/settings?pretty\n\n# Check jvm\ncurl -X GET \"$URL/_nodes/stats/jvm?pretty\"\ncurl -X GET \"$URL/_nodes/stats/jvm?pretty\" |grep heap_used_in_bytes\n\n## Auth\nGET /_security/_authenticate\n</code></pre>"},{"location":"snippets/elasticsearch/#runbook","title":"Runbook","text":"<p>1.</p>"},{"location":"snippets/elasticsearch/#index-aliases","title":"Index, Aliases","text":"<pre><code># PUT /&lt;my-index-{now/d}-000001&gt;\nPUT /%3Cmy-index-%7Bnow%2Fd%7D-000001%3E\n{\n  \"aliases\": {\n    \"my-index\": {}\n  }\n}\n\n\nGET _cat/aliases?v=true\n</code></pre>"},{"location":"snippets/elasticsearch/#crud","title":"CRUD","text":"<pre><code>URL=\"elasticsearch-client:9200\"\ncurl -X PUT \"$URL/customer?pretty\"\ncurl -X PUT \"$URL/customer/_doc/1?pretty\" -H 'Content-Type: application/json' -d'\n{\n  \"name\": \"John Doe\"\n}\n'\ncurl -X GET \"$URL/customer/_doc/1?pretty\"\n\n\ncurl -X GET \"$URL/_cat/indices?v\"\ncurl -X DELETE $URL/\n\n\ncurl -X PUT \"$URL/_cluster/settings\" -u \"elastic:xxx\" \\\n  -H 'Content-Type: application/json; charset=utf-8' \\\n  --data-binary @- &lt;&lt; EOF\n{\n  \"persistent\": {\n    \"cluster.routing.allocation.enable\": \"primaries\"\n  }\n}\nEOF\n</code></pre>"},{"location":"snippets/elasticsearch/#best-practice","title":"Best Practice","text":""},{"location":"snippets/elasticsearch/#index-template-for-log-index","title":"Index template for log index","text":"<pre><code>{\n  \"index_patterns\": [\n    \"rammus-log-*\"\n  ],\n  \"template\": {\n    \"settings\": {\n      \"index\": {\n        \"lifecycle\": {\n          \"name\": \"rammus-log\",\n          \"rollover_alias\": \"rammus-log\"\n        },\n        \"routing\": {\n          \"allocation\": {\n            \"total_shards_per_node\": \"1\"\n          }\n        },\n        \"codec\": \"best_compression\",\n        \"refresh_interval\": \"3m\",\n        \"number_of_shards\": \"6\",\n        \"translog\": {\n          \"sync_interval\": \"15s\",\n          \"durability\": \"async\"\n        },\n        \"number_of_replicas\": \"0\",\n        \"write\": {\n          \"wait_for_active_shards\": \"0\"\n        }\n      }\n    },\n    \"mappings\": {\n      \"dynamic_templates\": [\n        {\n          \"strings\": {\n            \"mapping\": {\n              \"type\": \"keyword\"\n            },\n            \"match_mapping_type\": \"string\"\n          }\n        }\n      ],\n      \"properties\": {\n        \"timestamp\": {\n          \"format\": \"yyyy.MM.dd HH:mm:ss.SSS||yyyy.MM.dd HH:mm:ss||yyyy-MM-dd HH:mm:ss.SSS||yyyy-MM-dd HH:mm:ss||yyyy.MM.dd||yyyy-MM-dd||yyyy-MM||yyyy.MM||epoch_millis||strict_date_optional_time\",\n          \"type\": \"date\"\n        }\n      }\n    }\n  },\n  \"priority\": 500\n}\n</code></pre>"},{"location":"snippets/elasticsearch/#dynamic-mapping","title":"Dynamic Mapping","text":"<p>https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic-templates.html <pre><code>  \"http_status\": {\n    \"type\": \"text\",\n    \"fields\": {\n      \"keyword\": {\n        \"type\": \"keyword\",\n        \"ignore_above\": 256\n      }\n    }\n  },\n</code></pre></p> <pre><code>{\n  \"mappings\": {\n    \"dynamic_templates\": [\n      {\n        \"strings_as_keywords\": {\n          \"match_mapping_type\": \"string\",\n          \"mapping\": {\n            \"type\": \"keyword\"\n            \"ignore_above\": 256\n          }\n        }\n      }\n    ]\n  }\n}\n\n{\n  \"mappings\": {\n    \"dynamic_templates\": [\n      {\n        \"longs_as_strings\": {\n          \"match_mapping_type\": \"string\",\n          \"match\":   \"long_*\",\n          \"unmatch\": \"*_text\",\n          \"mapping\": {\n            \"type\": \"long\"\n          }\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"snippets/elasticsearch/#backgroud-tasks","title":"Backgroud tasks","text":"<pre><code>GET _tasks?detailed=true&amp;actions=*reindex\nGET _cat/thread_pool/snapshot?v\nGET _cluster/allocation/explain\nGET _cluster/pending_tasks\nPOST /_cluster/reroute?retry_failed\n</code></pre>"},{"location":"snippets/elasticsearch/#plugin","title":"Plugin","text":"<pre><code>/bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.0.0/elasticsearch-analysis-ik-7.0.0.zip\n\n\ncurl -X GET \"$URL/_cat/plugins?v&amp;s=component&amp;h=name,component,version,description\"\ncurl -X GET \"$URL/_cat/plugins\"\n</code></pre>"},{"location":"snippets/elasticsearch/#benchmark-esrally","title":"Benchmark - esrally","text":"<p>https://esrally.readthedocs.io/en/stable/quickstart.html</p> <pre><code>docker run -d --name esrally --entrypoint tail -v $PWD/ral:/ral elastic/rally -f /dev/null\ndocker exec -it esrally bash\n\nesrally list tracks\nesrally info --track=http_logs\n\n# List and compare\nesrally list races\nesrally compare \\\n    --baseline=04714e80-9578-4cda-9a79-6d5ffff2c557 \\\n    --contender=daa58545-7e0f-4ae1-b47f-c5b7511c69ce\n</code></pre> <p>tl;dr <pre><code>esrally race --pipeline=benchmark-only \\\n    --track=http_logs --challenge=append-no-conflicts-index-only \\\n    --report-file=~/benchmark/eck-$(date -Iminutes) \\\n    --target-hosts=\"http://localhost:9200\" \\\n    --client-options=\"basic_auth_user:'elastic',basic_auth_password:'0MVVQ9B1Fq0'\"\n</code></pre></p> <pre><code># --test-mode: run it as fast as possible for testing a track\n# --pipeline=benchmark-only: docker needs this\n\nesrally race --track=http_logs --test-mode \\\n    --pipeline=benchmark-only \\\n    --target-hosts=192.168.0.1:9200 \\\n    --track-params=\"ingest_percentage:1\" \\\n    --client-options=\"basic_auth_user:'elastic',basic_auth_password:'xxxxxxxxxxxx'\"\n\nesrally race --track=http_logs \\\n    --pipeline=benchmark-only \\\n    --target-hosts=192.168.0.1:9200 \\\n    --track-params=\"ingest_percentage:1\" \\\n    --client-options=\"basic_auth_user:'elastic',basic_auth_password:'xxxxxxxxxxxx'\"\n\n\n    --include-tasks=\"index,delete-index,create-index,index-append\" \\\n    --include-tasks=\"index,term\" \\\n</code></pre>"},{"location":"snippets/elasticsearch/#troubles","title":"Troubles","text":""},{"location":"snippets/elasticsearch/#wildcard-expressions-or-all-indices-are-not-allowed","title":"Wildcard expressions or all indices are not allowed","text":"<pre><code>DELETE partial-*-2022.06*\n</code></pre> <p>Need to disable this config <pre><code>PUT _cluster/settings\n{\n  \"transient\": {\n    \"action.destructive_requires_name\": false\n  }\n}\n</code></pre></p> <p>enable config after deletey <pre><code>PUT _cluster/settings\n{\n  \"transient\": {\n    \"action.destructive_requires_name\": null\n  }\n}\n</code></pre></p>"},{"location":"snippets/elasticsearch/#ec2-debug","title":"EC2 debug","text":"<pre><code>systemctl restart elasticsearch\nsystemctl cat elasticsearch\njournalctl -u elasticsearch\n\n# Enable start-on-boot\nsystemctl enable elasticsearch\nsystemctl status elasticsearch\n</code></pre>"},{"location":"snippets/fun-markdown/","title":"Fun markdown","text":""},{"location":"snippets/fun-markdown/#2020-08-20","title":"2020-08-20","text":""},{"location":"snippets/fun-markdown/#chartjs-example-inject-chart-in-markdown-document","title":"Chart.js example - Inject chart in markdown document","text":"<p>https://www.chartjs.org/docs/latest/</p>"},{"location":"snippets/gcp/","title":"GCP","text":""},{"location":"snippets/gcp/#gkegoogle-kubernetes-engine","title":"GKE(Google Kubernetes Engine)","text":"<pre><code>gcloud components update\ngcloud container clusters list\ngcloud container clusters get-credentials staging --region=asia-east1\n\nkubectl config get-contexts\nkubectl config use-context production\nkubectl config set-context --current --namespace=dev\n\nkubectl create clusterrolebinding cluster-admin-binding \\\n  --clusterrole cluster-admin \\\n  --user user-account\n\ngcloud container operations list\n</code></pre> <p>Create a regional GKE <pre><code>CLUSTER_NAME=old\nREGION=asia-east2\n\n# Choose a static version or a release channel\nCLUSTER_VERSION=\"--cluster-version=1.14.10-gke.50\"\n# CLUSTER_VERSION=\"--release-channel regular\"\n\ngcloud beta container clusters create ${CLUSTER_NAME} --region ${REGION} \\\n    ${CLUSTER_VERSION} \\\n    --machine-type \"n2-highcpu-2\" --image-type \"COS\" --disk-size \"100\" --disk-type \"pd-ssd\" \\\n    --scopes \"https://www.googleapis.com/auth/compute\",\"https://www.googleapis.com/auth/devstorage.read_only\",\\\n\"https://www.googleapis.com/auth/logging.write\",\"https://www.googleapis.com/auth/monitoring\",\\\n\"https://www.googleapis.com/auth/servicecontrol\",\"https://www.googleapis.com/auth/service.management.readonly\",\\\n\"https://www.googleapis.com/auth/trace.append\",\"https://www.googleapis.com/auth/cloud-platform\" \\\n    --num-nodes \"1\" --preemptible --enable-autoscaling --min-nodes \"1\" --max-nodes \"3\" \\\n    --enable-stackdriver-kubernetes --enable-ip-alias --async\n</code></pre></p>"},{"location":"snippets/gcp/#create-static-ip-address","title":"Create static ip address","text":"<p>ref: https://cloud.google.com/kubernetes-engine/docs/tutorials/configuring-domain-name-static-ip <pre><code>gcloud compute addresses create dnsmasq-ip-2 --region asia-east1\ngcloud compute addresses describe dnsmasq-ip-2 --region asia-east1\n</code></pre></p>"},{"location":"snippets/gcp/#use-google-service-account-key-as-kubernetes-secret","title":"Use google service account key as Kubernetes secret","text":"<p>Import google service account key to Kubernetes secret <pre><code>kubectl create secret generic my-sa-key --from-file=key.json=my-sa-key.json\n</code></pre></p> <pre><code>    spec:\n      volumes:\n      - name: google-cloud-key\n        secret:\n          secretName: my-sa-key\n      containers:\n      - name: subscriber\n        image: gcr.io/google-samples/pubsub-sample:v1\n        volumeMounts:\n        - name: google-cloud-key\n          mountPath: /var/secrets/google\n        env:\n        - name: GOOGLE_APPLICATION_CREDENTIALS\n          value: /var/secrets/google/key.json\n</code></pre>"},{"location":"snippets/gcp/#gcsgoogle-cloud-stroge","title":"GCS(Google Cloud Stroge)","text":""},{"location":"snippets/gcp/#public-to-internet","title":"Public to internet","text":"<p>Edit bucket permissions -&gt; Add member -&gt; allUsers: Storage Object Viewer</p>"},{"location":"snippets/gcp/#test-service-accout-permission","title":"Test service accout permission","text":"<pre><code>SA=$(cat service-account.json | base64)\ndocker run -it --rm --entrypoint bash gcr.io/cloud-builders/gsutil -c \"\n        echo $SA | base64 -d &gt; sa.json\n        gcloud auth activate-service-account --key-file=sa.json\n        bash\n    \"\n</code></pre> <pre><code>gsutil ls gs://&lt;replace_this_with_your_bucket&gt;\n</code></pre>"},{"location":"snippets/gcp/#gsutil-verify-a-google-service-account-with-docker-and-a-environment-variable","title":"gsutil - Verify a google service account with docker and a environment variable","text":"<pre><code>docker run -it --rm --entrypoint bash gcr.io/cloud-builders/gsutil\nsa='{key.json,....}'\ngcloud auth activate-service-account --key-file=&lt;(echo $sa)\ngsutil ls gs://rammus.dev\n</code></pre>"},{"location":"snippets/gcp/#gcrcontainer-registry","title":"GCR(Container Registry)","text":""},{"location":"snippets/gcp/#use-service-account-json-to-login-gcr","title":"Use service account json to login GCR","text":"<pre><code>gcloud auth activate-service-account --key-file=gcloud.json\n\n# https://cloud.google.com/container-registry/docs/advanced-authentication\ncat gcloud.json | docker login -u _json_key --password-stdin https://asia.gcr.io\n</code></pre>"},{"location":"snippets/gcp/#projects","title":"Projects","text":""},{"location":"snippets/gcp/#switch-projects","title":"Switch projects","text":"<pre><code>gcloud projects list\ngcloud config set project my-project\n</code></pre>"},{"location":"snippets/gcp/#use-gcp-service-account","title":"Use GCP service account","text":"<pre><code>gcloud auth activate-service-account sa-devops@rammus-xu.iam.gserviceaccount.com --key-file=$GOOGLE_APPLICATION_CREDENTIALS\n</code></pre>"},{"location":"snippets/git/","title":"Git","text":"<p>Git examples, template, snippet</p>"},{"location":"snippets/git/#git","title":"Git","text":"<pre><code>git branch -D 20190320_for_ssl\ngit branch -avv\ngit remote -v\ngit pull --rebase\ngit checkout -t origin/20190320_for_ssl\ngit checkout master\ngit push -u origin feature_branch_name\ngit push -u origin HEAD:20190401_add_k8s_stage\n\ngit remote prune origin --dry-run\ngit remote prune origin\n\n# Get current commit sha\ngit rev-parse --short=7 HEAD\n</code></pre>"},{"location":"snippets/git/#submodule","title":"Submodule","text":"<pre><code>git submodule update --init\n</code></pre>"},{"location":"snippets/git/#clean-submodule","title":"Clean submodule","text":"<pre><code>rm -rf .gitmodules\n\n## .git/config\n[submodule \"themes/landscape\"]\n\nrm -rf .git/modules\n</code></pre>"},{"location":"snippets/github-action/","title":"Github Action","text":"<p>Github Actions(CI/CD) tricks that official documents didn't mention. This post including hints, tips, snippet, cheatsheet, troubleshooting, notes, how-to.</p>"},{"location":"snippets/github-action/#starter","title":"Starter","text":"<pre><code>on:\n  push:\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - name: Run tests\n        run: |\n          echo hi\n</code></pre>"},{"location":"snippets/github-action/#on-trigger-event","title":"On trigger event","text":"<pre><code>on:\n  push:\n    branches:\n      - \"master\"\n      - \"**\"\n    tags:\n      - \"**\"\n    paths:\n      - src/**\n      - Dockerfile\n  pull_request:\n    branches:\n      - master\n  pull_request:\n    types:\n      - opened\n      - synchronize\n    branches:\n      - \"*\"\n    paths:\n      - \"**.yml\"\n      - \"**.yaml\"\n  repository_dispatch:\n    types: [rammus_post]\n\n  # https://pubs.opengroup.org/onlinepubs/9699919799/utilities/crontab.html#tag_20_25_07\n  schedule:\n    - cron: '0 4 * * 4' # 12:00 UTC+8, Friday\n</code></pre> <p>Important</p> <p><code>pull_request.branches</code> is base on ref, not head_ref</p>"},{"location":"snippets/github-action/#environments-and-variables","title":"Environments and variables","text":""},{"location":"snippets/github-action/#pass-variables","title":"Pass variables","text":"<pre><code>echo ::set-output name=message::$output_message\necho \"action_state=yellow\" &gt;&gt; $GITHUB_ENV\n\n# Deprecated. ref: https://github.blog/changelog/2020-10-01-github-actions-deprecating-set-env-and-add-path-commands/\necho ::set-env name=action_state::yellow\n</code></pre>"},{"location":"snippets/github-action/#use-variables","title":"Use variables","text":"<pre><code>GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\nGITHUB_TOKEN: ${{ env.ACTION_STATE }}\nPR_COMMENT: ${{ steps.message.outputs.message }}\nPR_COMMENT_URL: ${{ github.event.pull_request.comments_url }}\nPAYLOAD_ACTOR: ${{ github.event.client_payload.actor }}\n</code></pre>"},{"location":"snippets/github-action/#use-github_actor-as-git-commit-author-and-using-github-avator","title":"Use GITHUB_ACTOR as git commit author and using github avator","text":"<p>https://help.github.com/en/github/setting-up-and-managing-your-github-user-account/setting-your-commit-email-address <pre><code>git config --global user.name \"${GITHUB_ACTOR}\"\ngit config --global user.email \"${GITHUB_ACTOR}@users.noreply.github.com\"\nremote_repo=\"https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${GITHUB_REPOSITORY}.git\"\ngit remote add origin \"${remote_repo}\"\n</code></pre></p>"},{"location":"snippets/github-action/#get-commit-author-information","title":"Get commit author information","text":"<p>This is only for push event <pre><code>AUTHOR_NAME: ${{ github.event.head_commit.author.name }}\nAUTHOR_EMAIL: ${{ github.event.head_commit.author.email }}\n</code></pre></p>"},{"location":"snippets/github-action/#customize-docker-action","title":"Customize docker action","text":"<pre><code>name: 'Update Status'\ndescription: 'Update status'\ninputs:\n  state:\n    description: 'Option: success, failure'\n    required: false\n    default: 'success'\n  auth_token:\n    description: 'Auth token used to API'\n    required: true\n    default: \"${{ github.token }}\"\n  pull_sha:\n    description: 'Commit SHA'\n    default: \"${{ github.event.pull_request.head.sha}}\"\n    required: false\n  push_sha:\n    description: 'Commit SHA'\n    required: false\n    default: \"${{ github.sha }}\"\n</code></pre> <pre><code>if [[ $GITHUB_EVENT_NAME == 'pull_request' ]]; then\n    COMMIT_SHA=$INPUT_PULL_SHA\nelse\n    COMMIT_SHA=$INPUT_PUSH_SHA\n</code></pre>"},{"location":"snippets/github-action/#if-condition","title":"if condition","text":"<pre><code>if: contains(github.ref, 'refs/tags')\nif: contains(github.event.issue.title, 'Update APK')\nif: contains(github.event.issue.labels.*.name, 'workflow/check-label')\nif: steps.git-diff.outputs.is-diff\nif: steps.set-env.outputs.message == 'hello'\nif: github.ref != 'refs/heads/master'\nif: github.event.action == 'dispatch_rammus_customize_action_type'\nif: github.event.issue.pull_request\nif: github.event_name == 'pull_request' &amp;&amp; contains(github.head_ref, 'update-app')\n</code></pre>"},{"location":"snippets/github-action/#pull_request","title":"pull_request","text":""},{"location":"snippets/github-action/#when-specific-event-type","title":"when specific event type","text":"<pre><code>if: github.event_name == 'pull_request' &amp;&amp; github.event.action == 'unassigned'\n</code></pre>"},{"location":"snippets/github-action/#when-branch-name-is","title":"when branch name is","text":"<pre><code>if: github.event_name == 'pull_request' &amp;&amp; contains(github.head_ref, 'my-feature-branch')\n</code></pre>"},{"location":"snippets/github-action/#when-merged","title":"when merged","text":"<pre><code>on:\n  pull_request:\n    types: [closed]\njobs:\n  merged:\n    if: github.event.pull_request.merged == true\n</code></pre>"},{"location":"snippets/github-action/#job-syntax","title":"Job syntax","text":""},{"location":"snippets/github-action/#wait-other-jobs-finish","title":"Wait other jobs finish","text":"<pre><code>jobs:\n  job1:\n  job2:\n    needs: job1\n  job3:\n    needs: [job1, job2]\n</code></pre>"},{"location":"snippets/github-action/#setting","title":"Setting","text":"<pre><code>ACTIONS_RUNNER_DEBUG: true\n</code></pre>"},{"location":"snippets/github-action/#build-an-action","title":"Build an action","text":""},{"location":"snippets/github-action/#docker-action-example","title":"Docker Action Example","text":"<pre><code># action.yml\nname: 'Hello World'\ndescription: 'Greet someone and record the time'\ninputs:\n  who-to-greet:  # id of input\n    description: 'Who to greet'\n    required: true\n    default: 'World'\noutputs:\n  time: # id of output\n    description: 'The time we greeted you'\nruns:\n  using: 'docker'\n  image: 'Dockerfile'\n  args:\n    - ${{ inputs.who-to-greet }}\n</code></pre>"},{"location":"snippets/github-action/#composite-multiple-steps-action-example","title":"Composite (Multiple steps) Action Example","text":"<pre><code>name: 'Hello World'\ndescription: 'Greet someone'\ninputs:\n  who-to-greet:  # id of input\n    description: 'Who to greet'\n    required: true\n    default: 'World'\noutputs:\n  random-number:\n    description: \"Random number\"\n    value: ${{ steps.random-number-generator.outputs.random-id }}\nruns:\n  using: \"composite\"\n  steps:\n    - run: echo Hello ${{ inputs.who-to-greet }}.\n      shell: bash\n    - id: random-number-generator\n      run: echo \"::set-output name=random-id::$(echo $RANDOM)\"\n      shell: bash\n    - run: ${{ github.action_path }}/goodbye.sh\n      shell: bash\n</code></pre>"},{"location":"snippets/github-action/#get-input-as-environemnt-in-docker","title":"Get input as environemnt in Docker","text":"<p><pre><code># action.yaml\ninputs:\n  who-to-greet:\n</code></pre> <pre><code># workflow.yaml\n      - uses: ./actions/my-action\n        with:\n          who-to-greet: rammus\n</code></pre></p> <pre><code># entrypoint.sh\necho INPUTS_WHO_TO_GREET\n</code></pre>"},{"location":"snippets/github-action/#entrypoint-need-to-be-abolute-path","title":"ENTRYPOINT need to be abolute path","text":"<p>Warning</p> <p>When <code>uses: ./actions/my-action</code> Workflow will mount workspace <code>--workdir /github/workspace</code></p> <pre><code>COPY ./app.py /\nENTRYPOINT python /app.py\n</code></pre>"},{"location":"snippets/github-action/#awesome-actions","title":"Awesome Actions","text":""},{"location":"snippets/github-action/#manuallycustomize-trigger-a-workflow","title":"Manually/Customize trigger a workflow","text":"<p>https://github.blog/changelog/2020-07-06-github-actions-manual-triggers-with-workflow_dispatch/ <pre><code>on:\n  workflow_dispatch:\n    inputs:\n      logLevel:\n        description: 'Log level'\n        required: true\n        default: 'warning'\n      tags:\n        description: 'Test scenario tags'\n\njobs:\n  printInputs:\n    runs-on: ubuntu-latest\n    steps:\n    - run: |\n        echo \"Log level: ${{ github.event.inputs.logLevel }}\"\n        echo \"Tags: ${{ github.event.inputs.tags }}\"\n</code></pre></p>"},{"location":"snippets/github-action/#customize-action-type-with-http-post-method","title":"Customize action type with http post method","text":"<pre><code>on:\n  repository_dispatch:\n    types: [rammus_post]\njobs:\n  rammus_job:\n    env:\n      ACTOR: ${{ github.event.client_payload.actor }}\n    if: github.event.action == 'rammus_post'\n</code></pre> <p>And you can send a post request like:</p> <pre><code>INPUT_GITHUB_TOKEN=\nINPUT_COMMENT_URL=\"https://api.github.com/repos/&lt;owner&gt;/&lt;repo&gt;/dispatches\"\n\ncurl -H \"Authorization: token $INPUT_GITHUB_TOKEN\" \\\n    -H \"Accept: application/vnd.github.everest-preview+json\" \\\n    -d '{\"event_type\":\"rammus_post\",\"client_payload\":{\"new_version_image\":\"echo-server:96b2166\", \"new_version_sha\":\"96b2166\",\"actor\":\"Rammus Xu\"}}' \\\n    -XPOST $INPUT_COMMENT_URL\n</code></pre>"},{"location":"snippets/github-action/#docekr-build-and-push-to-ghcrio-when-pushing-a-git-tag","title":"Docekr build and push to ghcr.io when pushing a git tag","text":"<pre><code>name: Tag\n\non:\n  push:\n    tags:\n      - \"**\"\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      - name: Set Env\n        run: |\n          echo \"BUILD_TAG=${GITHUB_REF/refs\\/tags\\//}\" &gt;&gt; $GITHUB_ENV\n          echo \"BUILD_SHA=${GITHUB_SHA:0:7}\" &gt;&gt; $GITHUB_ENV\n\n      - name: Set up Docker Buildx\n        uses: docker/setup-buildx-action@v1\n\n      - name: Docker Login\n        # uses: docker/login-action@f3364599c6aa293cdc2b8391b1b56d0c30e45c8a\n        uses: docker/login-action@v1.8.0\n        with:\n          registry: ghcr.io\n          username: ${{ secrets.GHCR_USERNAME }}\n          password: ${{ secrets.GHCR_PASSWORD }}\n\n      - name: Build and push Docker images\n        # uses: docker/build-push-action@4a531fa5a603bab87dfa56578bd82b28508c9547\n        uses: docker/build-push-action@v2.2.2\n        with:\n          context: \".\"\n          tags: |\n            ghcr.io/${{ github.repository }}:${{ env.BUILD_TAG }}\n            ghcr.io/${{ github.repository }}:${{ env.BUILD_SHA }}\n          push: true\n</code></pre>"},{"location":"snippets/github-action/#docker-login","title":"Docker login","text":"<pre><code>    - name: Docker Login - docker.pkg.github.com\n      uses: swaglive/actions/docker/login@944b742\n      with:\n        password: ${{ secrets.GHR_PASSWORD }}\n        username: ${{ secrets.GHR_USERNAME }}\n        url: docker.pkg.github.com\n\n    - name: Docker Login - docker.pkg.github.com\n      if: contains(github.ref, 'tags')\n      env:\n        DOCKER_PASSWORD: ${{ secrets.GITHUB_TOKEN }}\n      run: echo $DOCKER_PASSWORD | docker login -u $GITHUB_ACTOR --password-stdin docker.pkg.github.com\n</code></pre>"},{"location":"snippets/github-action/#docker-login-and-copy-config-to-default-containers-workspace","title":"Docker login and copy config to default container's workspace","text":"<p>Note</p> <p>github runner will mount <code>/home/runner/work/_temp/_github_home\":\"/github/home</code> when we use a docker action. That means we can't use the credential directly in next steps. Only if you use a docker contain step. Since <code>id: generate-mirror-list</code> need docker credentials and run on default container, credentials should be copied to default container's home.</p> <p>And a docker action must run as root. Therefore, it needs to be <code>sudo</code> in a default container.</p> <pre><code>    - name: Docker Login - docker.pkg.github.com\n      uses: swaglive/actions/docker/login@944b742\n      with:\n        password: ${{ secrets.GHR_PASSWORD }}\n        username: ${{ secrets.GHR_USERNAME }}\n        url: docker.pkg.github.com\n\n    - name: Do something in default container's workspace\n      run: |\n        sudo cp -R /home/runner/work/_temp/_github_home/.docker ~\n        sudo chown -R $(whoami) ~/.docker\n        docker pull docker.pkg.github.com/swaglive/dockerfiles/kubectl:1.17\n</code></pre>"},{"location":"snippets/github-action/#cache-node_modules","title":"Cache node_modules","text":"<pre><code>    - name: Get yarn cache directory path\n      id: yarn-cache-dir-path\n      run: echo \"::set-output name=dir::$(yarn cache dir)\"\n    - uses: actions/cache@v2\n      with:\n        path: ${{ steps.yarn-cache-dir-path.outputs.dir }}\n        key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}\n        restore-keys: |\n          ${{ runner.os }}-yarn-\n</code></pre>"},{"location":"snippets/github-action/#fetch-private-submodule","title":"Fetch private submodule","text":"<p>PAT = personal access token</p> <p><code>actions/checkout@v2</code> fixed <code>git@github.com</code> problem <pre><code>jobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n    - name: Checkout\n      uses: actions/checkout@v2\n      with:\n        fetch-depth: 0\n        submodules: true\n        token: ${{ secrets.PAT }}\n</code></pre></p> <pre><code>    - name: Fix submodules\n      run: echo -e '[url \"https://github.com/\"]\\n  insteadOf = \"git@github.com:\"' &gt;&gt; ~/.gitconfig\n    - name: Checkout\n      uses: actions/checkout@v1\n      with:\n        fetch-depth: 0\n        submodules: true\n        token: ${{ secrets.PAT }}\n</code></pre>"},{"location":"snippets/github-action/#create-pull-request","title":"Create pull request","text":"<pre><code>    - name: Create Pull Request\n      if: steps.create-branch.outputs.branch_name\n      uses: actions/github-script@v3\n      with:\n        github-token: ${{ secrets.GITHUB_TOKEN }}\n        script: |\n          github.pulls.create({\n            owner: 'swaglive',\n            repo: 'action-demo',\n            title: '[Action] ${{ steps.create-branch.outputs.branch_name }}',\n            head: '${{ steps.create-branch.outputs.branch_name }}',\n            base: 'master'\n          })\n    - name: Create Pull Request\n      if: steps.create-branch.outputs.branch_name\n      uses: actions/github-script@v3\n      with:\n        github-token: ${{ secrets.GITHUB_TOKEN }}\n        script: |\n          github.pulls.create({\n            ...context.repo,\n            title: '[Action] ${{ steps.create-branch.outputs.branch_name }}',\n            body: `Created by \\`${ process.env.GITHUB_ACTOR }\\``,\n            head: '${{ steps.create-branch.outputs.branch_name }}',\n            base: 'master'\n          })\n</code></pre>"},{"location":"snippets/github-action/#commit-and-push-and-create-pull-request","title":"Commit and push and create pull request","text":"<pre><code>    - name: Set environments\n      run: echo \"NEW_BRANCH=update-config-$(date +%Y-%m-%d_%H%M%S-utc)\" &gt;&gt; $GITHUB_ENV\n    - name: Configure git\n      run: |\n        git config --global user.name \"${GITHUB_ACTOR}\"\n        git config --global user.email \"${GITHUB_ACTOR}@users.noreply.github.com\"\n    - name: Commit\n      run: git commit -a -m \"Update config.json by ${GITHUB_ACTOR}\"\n    - name: Git push\n      run: git push origin HEAD:${NEW_BRANCH}\n    - name: Create Pull Request\n      uses: actions/github-script@v3\n      with:\n        github-token: ${{ secrets.GITHUB_TOKEN }}\n        script: |\n          github.pulls.create({\n            ...context.repo,\n            title: '${{ env.NEW_BRANCH }}',\n            body: `Created by \\`${ process.env.GITHUB_ACTOR }\\``,\n            head: '${{ env.NEW_BRANCH }}',\n            base: 'master'\n          })\n</code></pre>"},{"location":"snippets/github-action/#close-issue-when-title-contains-specific-string","title":"Close issue when title contains specific string","text":"<pre><code>name: issue-opened\n\non:\n  issues:\n    types: [opened]\n\njobs:\n  debug:\n    runs-on: ubuntu-latest\n    if: contains(github.event.issue.title, 'Update APK')\n    steps:\n      - name: Close issue\n        uses: actions/github-script@0.8.0\n        with:\n          github-token: ${{ secrets.GITHUB_TOKEN }}\n          script: |\n            github.issues.update({\n              ...context.repo,\n              issue_number: context.issue.number,\n              state: 'closed'\n            })\n\n            github.issues.createComment({\n              ...context.repo,\n              issue_number: context.issue.number,\n              body: 'Close this!'\n            });\n</code></pre>"},{"location":"snippets/github-action/#create-a-comment-in-pull-request","title":"Create a comment in pull request","text":"<pre><code>    - name: Notify Results in Pull Request\n      if: steps.generate-mirror-list.outputs.images\n      uses: actions/github-script@0.3.0\n      with:\n        github-token: ${{ secrets.GITHUB_TOKEN }}\n        images: ${{ steps.generate-mirror-list.outputs.images }}\n        script: |\n          var body = \"## I mirrored something for you\"\n          process.env.INPUT_IMAGES.split(' ').forEach(function(image){\n            let [source, target] = image.split('@')\n            body = `${body}\\r\\n- \\`${source}\\` -&gt; \\`${target}\\``\n          })\n\n          github.issues.createComment({\n            ...context.repo,\n            issue_number: context.payload.number,\n            body: body,\n          })\n</code></pre>"},{"location":"snippets/github-action/#deploy-mkdocs-to-gh-pages","title":"Deploy mkdocs to gh-pages","text":"<pre><code>name: Publish\non:\n  push:\n    branches:\n      - master\n\njobs:\n  deploy:\n    name: Deploy docs\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout master\n        uses: actions/checkout@v1\n\n      - name: Deploy docs\n        uses: mhausenblas/mkdocs-deploy-gh-pages@1.11\n        env:\n          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n</code></pre>"},{"location":"snippets/github-action/#get-other-step-output-as-enviroment-in-github-script","title":"Get other step output as enviroment in github-script","text":"<pre><code>jobs:\n  debug:\n    runs-on: ubuntu-latest\n    steps:\n      - id: update\n        run: echo ::set-output name=message::okok\n      - name: js\n        uses: actions/github-script@0.8.0\n        env:\n          MESSAGE: ${{ steps.update.outputs.message }}\n        with:\n          github-token: ${{ secrets.GITHUB_TOKEN }}\n          script: |\n            var message = process.env.MESSAGE\n            if (message !== undefined){\n              message == 'in'\n            } else {\n              message == 'else'\n            }\n            console.log(message)\n</code></pre>"},{"location":"snippets/github-action/#docker-build-and-push-action","title":"Docker build and push action","text":"<pre><code>name: docker-publish\n\non:\n  push:\n\njobs:\n  docker-publish:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v2\n      # Build base image\n      - uses: docker/build-push-action@v1\n        with:\n          username: _json_key\n          password: ${{ secrets.GOOGLE_SA_GCR_JSON }}\n          registry: asia.gcr.io\n          repository: rammusxu/${{ github.event.repository.name }}\n          tags: base\n          target: base\n          cache_froms: rammusxu/${{ github.event.repository.name }}:base\n\n      # Build app image\n      - uses: docker/build-push-action@v1\n        with:\n          username: _json_key\n          password: ${{ secrets.GOOGLE_SA_GCR_JSON }}\n          registry: asia.gcr.io\n          repository: rammusxu/${{ github.event.repository.name }}\n          tags: ${{ github.sha }}\n          cache_froms: rammusxu/${{ github.event.repository.name }}:${{ github.sha }}\n          tag_with_ref: true\n</code></pre>"},{"location":"snippets/github-action/#faq","title":"FAQ","text":""},{"location":"snippets/github-action/#whats-logic-used-in-pushbranches-and-pushpaths","title":"What's logic used in <code>push.branches</code> and <code>push.paths</code>","text":"<p>It's AND logic. It needs meet both conditions.</p> <ul> <li>Push to branch: <code>dev**</code></li> <li>Something under <code>echo-box</code> folder changed <pre><code>on:\n  push:\n    branches:\n    - \"dev**\"\n    paths:\n    - 'echo-box/**'\n</code></pre></li> </ul>"},{"location":"snippets/github-action/#how-to-activate-google-service-account-in-action","title":"How to activate google service account in action","text":"<p>Should be <code>echo '${{ secrets.GOOGLE_SA_JSON }}'</code></p> <p>\u2705 <pre><code>  debug2:\n    runs-on: ubuntu-latest\n    steps:\n    - run: echo '${{ secrets.GOOGLE_SA_JSON }}' &gt; sa.json\n    - run: gcloud auth activate-service-account --key-file=sa.json\n    - run: gsutil ls gs://rammus.dev\n</code></pre></p> <p>\u274c <pre><code>  debug:\n    runs-on: ubuntu-latest\n    steps:\n    - run: echo \"${{ secrets.GOOGLE_SA_JSON }}\" &gt; sa.json\n    - run: gcloud auth activate-service-account --key-file=sa.json\n    - run: gsutil ls gs://rammus.dev\n</code></pre></p>"},{"location":"snippets/github-action/#cant-load-secrets-in-actionyaml","title":"Can't load secrets in action.yaml","text":"<p>\u274c <pre><code># action.yaml\ninputs:\n  kube_config:\n    description: 'kubernetes config file'\n    default: ${{ secrets.KUBE_CONFIG }}\n    description: 'kubernetes config file. ex. ${{ secrets.KUBE_CONFIG }}'\n</code></pre></p>"},{"location":"snippets/github-action/#but-githubtoken-can-be-get-in-actionyaml","title":"But ${{ github.token }} can be get in action.yaml","text":"<p>\u2705 <pre><code># action.yaml\ninputs:\n  auth_token:\n    description: 'Auth token used to API'\n    required: true\n    default: \"${{ github.token }}\"\n</code></pre></p>"},{"location":"snippets/github-action/#misc","title":"Misc","text":""},{"location":"snippets/github-action/#ios-app-build","title":"iOS App Build","text":"<p>Bitrise</p> <ul> <li>Standard:<ul> <li>Available in Developer, Org Standard, Velocity plan</li> <li>2vCPU @ 2.7 GHz, 4 GB RAM</li> <li>pricing $90 / Month</li> </ul> </li> <li>Elite:<ul> <li>Available in Org Elite, Velocity plan</li> <li>4vCPU @ 3.5 GHz, 8 GB RAM</li> <li>pricing $270 / Month</li> </ul> </li> </ul> <p>Github Action</p> <ul> <li>2 vCPU @ 2.60GHz, 7 GB RAM</li> <li>princing $0.08 / minute</li> </ul>"},{"location":"snippets/github-action/#build-status","title":"Build status","text":"ClickableUnclickable <pre><code>[![Publish](https://github.com/RammusXu/toolkit/workflows/Publish/badge.svg)](https://github.com/RammusXu/toolkit)\n</code></pre> <pre><code>![Publish](https://github.com/RammusXu/toolkit/workflows/Publish/badge.svg)\n</code></pre> <ul> <li>Clickable: </li> <li>Unclickable: </li> </ul>"},{"location":"snippets/github-action/#env-sample","title":"Env Sample","text":""},{"location":"snippets/github-action/#get-environments-in-action","title":"Get environments in action","text":"<pre><code>jobs:\n  show-env:\n    runs-on: ubuntu-latest\n    steps:\n    - run: cat $GITHUB_EVENT_PATH\n    - run: echo ${{ github.event_name }}\n    - run: echo ${{ github.event.action }}\n    - run: env\n    - name: Dump GitHub context\n      env:\n        GITHUB_CONTEXT: ${{ toJson(github) }}\n      run: echo \"$GITHUB_CONTEXT\"\n</code></pre>"},{"location":"snippets/github-action/#2020-09-01-github-context-on-push-branch-event","title":"2020-09-01 github context on push branch event","text":"<p><code>${{ toJson(github) }}</code></p> <pre><code>{\n  \"token\": \"***\",\n  \"job\": \"show-env\",\n  \"ref\": \"refs/heads/github-pkg\",\n  \"sha\": \"044271eda133bb9944f4aa7119bc661a8c1e9900\",\n  \"repository\": \"rammusxu/action-demo\",\n  \"repository_owner\": \"rammusxu\",\n  \"repositoryUrl\": \"git://github.com/rammusxu/action-demo.git\",\n  \"run_id\": \"221813086\",\n  \"run_number\": \"166\",\n  \"actor\": \"RammusXu\",\n  \"workflow\": \"show-env\",\n  \"head_ref\": \"\",\n  \"base_ref\": \"\",\n  \"event_name\": \"push\",\n  \"event\": {\n    \"after\": \"044271eda133bb9944f4aa7119bc661a8c1e9900\",\n    \"base_ref\": null,\n    \"before\": \"1c8b86a50a7bfb2d04984d5a67b414836aa04f22\",\n    \"commits\": [\n      {\n        \"author\": {\n          \"email\": \"comte_ken@hotmail.com\",\n          \"name\": \"Rammus Xu\",\n          \"username\": \"RammusXu\"\n        },\n        \"committer\": {\n          \"email\": \"comte_ken@hotmail.com\",\n          \"name\": \"Rammus Xu\",\n          \"username\": \"RammusXu\"\n        },\n        \"distinct\": true,\n        \"id\": \"044271eda133bb9944f4aa7119bc661a8c1e9900\",\n        \"message\": \"Update docker login\",\n        \"timestamp\": \"2020-08-24T17:56:16+08:00\",\n        \"tree_id\": \"bf214120ff82ade624e0c2584c6e945c55ade8e3\",\n        \"url\": \"https://github.com/rammusxu/action-demo/commit/044271eda133bb9944f4aa7119bc661a8c1e9900\"\n      }\n    ],\n    \"compare\": \"https://github.com/rammusxu/action-demo/compare/1c8b86a50a7b...044271eda133\",\n    \"created\": false,\n    \"deleted\": false,\n    \"forced\": false,\n    \"head_commit\": {\n      \"author\": {\n        \"email\": \"comte_ken@hotmail.com\",\n        \"name\": \"Rammus Xu\",\n        \"username\": \"RammusXu\"\n      },\n      \"committer\": {\n        \"email\": \"comte_ken@hotmail.com\",\n        \"name\": \"Rammus Xu\",\n        \"username\": \"RammusXu\"\n      },\n      \"distinct\": true,\n      \"id\": \"044271eda133bb9944f4aa7119bc661a8c1e9900\",\n      \"message\": \"Update docker login\",\n      \"timestamp\": \"2020-08-24T17:56:16+08:00\",\n      \"tree_id\": \"bf214120ff82ade624e0c2584c6e945c55ade8e3\",\n      \"url\": \"https://github.com/rammusxu/action-demo/commit/044271eda133bb9944f4aa7119bc661a8c1e9900\"\n    },\n    \"organization\": {\n      \"avatar_url\": \"https://avatars3.githubusercontent.com/u/36289044?v=4\",\n      \"description\": \"The SWAG Life\",\n      \"events_url\": \"https://api.github.com/orgs/rammusxu/events\",\n      \"hooks_url\": \"https://api.github.com/orgs/rammusxu/hooks\",\n      \"id\": 36289044,\n      \"issues_url\": \"https://api.github.com/orgs/rammusxu/issues\",\n      \"login\": \"rammusxu\",\n      \"members_url\": \"https://api.github.com/orgs/rammusxu/members{/member}\",\n      \"node_id\": \"MDEyOk9yZ2FuaXphdGlvbjM2Mjg5MDQ0\",\n      \"public_members_url\": \"https://api.github.com/orgs/rammusxu/public_members{/member}\",\n      \"repos_url\": \"https://api.github.com/orgs/rammusxu/repos\",\n      \"url\": \"https://api.github.com/orgs/rammusxu\"\n    },\n    \"pusher\": {\n      \"email\": \"comte_ken@hotmail.com\",\n      \"name\": \"RammusXu\"\n    },\n    \"ref\": \"refs/heads/github-pkg\",\n    \"repository\": {\n      \"archive_url\": \"https://api.github.com/repos/rammusxu/action-demo/{archive_format}{/ref}\",\n      \"archived\": false,\n      \"assignees_url\": \"https://api.github.com/repos/rammusxu/action-demo/assignees{/user}\",\n      \"blobs_url\": \"https://api.github.com/repos/rammusxu/action-demo/git/blobs{/sha}\",\n      \"branches_url\": \"https://api.github.com/repos/rammusxu/action-demo/branches{/branch}\",\n      \"clone_url\": \"https://github.com/rammusxu/action-demo.git\",\n      \"collaborators_url\": \"https://api.github.com/repos/rammusxu/action-demo/collaborators{/collaborator}\",\n      \"comments_url\": \"https://api.github.com/repos/rammusxu/action-demo/comments{/number}\",\n      \"commits_url\": \"https://api.github.com/repos/rammusxu/action-demo/commits{/sha}\",\n      \"compare_url\": \"https://api.github.com/repos/rammusxu/action-demo/compare/{base}...{head}\",\n      \"contents_url\": \"https://api.github.com/repos/rammusxu/action-demo/contents/{+path}\",\n      \"contributors_url\": \"https://api.github.com/repos/rammusxu/action-demo/contributors\",\n      \"created_at\": 1564547431,\n      \"default_branch\": \"master\",\n      \"deployments_url\": \"https://api.github.com/repos/rammusxu/action-demo/deployments\",\n      \"description\": null,\n      \"disabled\": false,\n      \"downloads_url\": \"https://api.github.com/repos/rammusxu/action-demo/downloads\",\n      \"events_url\": \"https://api.github.com/repos/rammusxu/action-demo/events\",\n      \"fork\": false,\n      \"forks\": 0,\n      \"forks_count\": 0,\n      \"forks_url\": \"https://api.github.com/repos/rammusxu/action-demo/forks\",\n      \"full_name\": \"rammusxu/action-demo\",\n      \"git_commits_url\": \"https://api.github.com/repos/rammusxu/action-demo/git/commits{/sha}\",\n      \"git_refs_url\": \"https://api.github.com/repos/rammusxu/action-demo/git/refs{/sha}\",\n      \"git_tags_url\": \"https://api.github.com/repos/rammusxu/action-demo/git/tags{/sha}\",\n      \"git_url\": \"git://github.com/rammusxu/action-demo.git\",\n      \"has_downloads\": true,\n      \"has_issues\": true,\n      \"has_pages\": true,\n      \"has_projects\": true,\n      \"has_wiki\": true,\n      \"homepage\": null,\n      \"hooks_url\": \"https://api.github.com/repos/rammusxu/action-demo/hooks\",\n      \"html_url\": \"https://github.com/rammusxu/action-demo\",\n      \"id\": 199778774,\n      \"issue_comment_url\": \"https://api.github.com/repos/rammusxu/action-demo/issues/comments{/number}\",\n      \"issue_events_url\": \"https://api.github.com/repos/rammusxu/action-demo/issues/events{/number}\",\n      \"issues_url\": \"https://api.github.com/repos/rammusxu/action-demo/issues{/number}\",\n      \"keys_url\": \"https://api.github.com/repos/rammusxu/action-demo/keys{/key_id}\",\n      \"labels_url\": \"https://api.github.com/repos/rammusxu/action-demo/labels{/name}\",\n      \"language\": \"Dockerfile\",\n      \"languages_url\": \"https://api.github.com/repos/rammusxu/action-demo/languages\",\n      \"license\": null,\n      \"master_branch\": \"master\",\n      \"merges_url\": \"https://api.github.com/repos/rammusxu/action-demo/merges\",\n      \"milestones_url\": \"https://api.github.com/repos/rammusxu/action-demo/milestones{/number}\",\n      \"mirror_url\": null,\n      \"name\": \"action-demo\",\n      \"node_id\": \"MDEwOlJlcG9zaXRvcnkxOTk3Nzg3NzQ=\",\n      \"notifications_url\": \"https://api.github.com/repos/rammusxu/action-demo/notifications{?since,all,participating}\",\n      \"open_issues\": 1,\n      \"open_issues_count\": 1,\n      \"organization\": \"rammusxu\",\n      \"owner\": {\n        \"avatar_url\": \"https://avatars3.githubusercontent.com/u/36289044?v=4\",\n        \"email\": \"engineering@swag.live\",\n        \"events_url\": \"https://api.github.com/users/rammusxu/events{/privacy}\",\n        \"followers_url\": \"https://api.github.com/users/rammusxu/followers\",\n        \"following_url\": \"https://api.github.com/users/rammusxu/following{/other_user}\",\n        \"gists_url\": \"https://api.github.com/users/rammusxu/gists{/gist_id}\",\n        \"gravatar_id\": \"\",\n        \"html_url\": \"https://github.com/rammusxu\",\n        \"id\": 36289044,\n        \"login\": \"rammusxu\",\n        \"name\": \"rammusxu\",\n        \"node_id\": \"MDEyOk9yZ2FuaXphdGlvbjM2Mjg5MDQ0\",\n        \"organizations_url\": \"https://api.github.com/users/rammusxu/orgs\",\n        \"received_events_url\": \"https://api.github.com/users/rammusxu/received_events\",\n        \"repos_url\": \"https://api.github.com/users/rammusxu/repos\",\n        \"site_admin\": false,\n        \"starred_url\": \"https://api.github.com/users/rammusxu/starred{/owner}{/repo}\",\n        \"subscriptions_url\": \"https://api.github.com/users/rammusxu/subscriptions\",\n        \"type\": \"Organization\",\n        \"url\": \"https://api.github.com/users/rammusxu\"\n      },\n      \"private\": true,\n      \"pulls_url\": \"https://api.github.com/repos/rammusxu/action-demo/pulls{/number}\",\n      \"pushed_at\": 1598262984,\n      \"releases_url\": \"https://api.github.com/repos/rammusxu/action-demo/releases{/id}\",\n      \"size\": 245,\n      \"ssh_url\": \"git@github.com:rammusxu/action-demo.git\",\n      \"stargazers\": 0,\n      \"stargazers_count\": 0,\n      \"stargazers_url\": \"https://api.github.com/repos/rammusxu/action-demo/stargazers\",\n      \"statuses_url\": \"https://api.github.com/repos/rammusxu/action-demo/statuses/{sha}\",\n      \"subscribers_url\": \"https://api.github.com/repos/rammusxu/action-demo/subscribers\",\n      \"subscription_url\": \"https://api.github.com/repos/rammusxu/action-demo/subscription\",\n      \"svn_url\": \"https://github.com/rammusxu/action-demo\",\n      \"tags_url\": \"https://api.github.com/repos/rammusxu/action-demo/tags\",\n      \"teams_url\": \"https://api.github.com/repos/rammusxu/action-demo/teams\",\n      \"trees_url\": \"https://api.github.com/repos/rammusxu/action-demo/git/trees{/sha}\",\n      \"updated_at\": \"2020-08-24T06:36:17Z\",\n      \"url\": \"https://github.com/rammusxu/action-demo\",\n      \"watchers\": 0,\n      \"watchers_count\": 0\n    },\n    \"sender\": {\n      \"avatar_url\": \"https://avatars1.githubusercontent.com/u/4367069?v=4\",\n      \"events_url\": \"https://api.github.com/users/RammusXu/events{/privacy}\",\n      \"followers_url\": \"https://api.github.com/users/RammusXu/followers\",\n      \"following_url\": \"https://api.github.com/users/RammusXu/following{/other_user}\",\n      \"gists_url\": \"https://api.github.com/users/RammusXu/gists{/gist_id}\",\n      \"gravatar_id\": \"\",\n      \"html_url\": \"https://github.com/RammusXu\",\n      \"id\": 4367069,\n      \"login\": \"RammusXu\",\n      \"node_id\": \"MDQ6VXNlcjQzNjcwNjk=\",\n      \"organizations_url\": \"https://api.github.com/users/RammusXu/orgs\",\n      \"received_events_url\": \"https://api.github.com/users/RammusXu/received_events\",\n      \"repos_url\": \"https://api.github.com/users/RammusXu/repos\",\n      \"site_admin\": false,\n      \"starred_url\": \"https://api.github.com/users/RammusXu/starred{/owner}{/repo}\",\n      \"subscriptions_url\": \"https://api.github.com/users/RammusXu/subscriptions\",\n      \"type\": \"User\",\n      \"url\": \"https://api.github.com/users/RammusXu\"\n    }\n  },\n  \"server_url\": \"https://github.com\",\n  \"api_url\": \"https://api.github.com\",\n  \"graphql_url\": \"https://api.github.com/graphql\",\n  \"workspace\": \"/home/runner/work/action-demo/action-demo\",\n  \"action\": \"run3\",\n  \"event_path\": \"/home/runner/work/_temp/_github_workflow/event.json\"\n}\n</code></pre> <p><code>cat $GITHUB_EVENT_PATH</code></p> <pre><code>{\n  \"after\": \"044271eda133bb9944f4aa7119bc661a8c1e9900\",\n  \"base_ref\": null,\n  \"before\": \"1c8b86a50a7bfb2d04984d5a67b414836aa04f22\",\n  \"commits\": [\n    {\n      \"author\": {\n        \"email\": \"comte_ken@hotmail.com\",\n        \"name\": \"Rammus Xu\",\n        \"username\": \"RammusXu\"\n      },\n      \"committer\": {\n        \"email\": \"comte_ken@hotmail.com\",\n        \"name\": \"Rammus Xu\",\n        \"username\": \"RammusXu\"\n      },\n      \"distinct\": true,\n      \"id\": \"044271eda133bb9944f4aa7119bc661a8c1e9900\",\n      \"message\": \"Update docker login\",\n      \"timestamp\": \"2020-08-24T17:56:16+08:00\",\n      \"tree_id\": \"bf214120ff82ade624e0c2584c6e945c55ade8e3\",\n      \"url\": \"https://github.com/rammusxu/action-demo/commit/044271eda133bb9944f4aa7119bc661a8c1e9900\"\n    }\n  ],\n  \"compare\": \"https://github.com/rammusxu/action-demo/compare/1c8b86a50a7b...044271eda133\",\n  \"created\": false,\n  \"deleted\": false,\n  \"forced\": false,\n  \"head_commit\": {\n    \"author\": {\n      \"email\": \"comte_ken@hotmail.com\",\n      \"name\": \"Rammus Xu\",\n      \"username\": \"RammusXu\"\n    },\n    \"committer\": {\n      \"email\": \"comte_ken@hotmail.com\",\n      \"name\": \"Rammus Xu\",\n      \"username\": \"RammusXu\"\n    },\n    \"distinct\": true,\n    \"id\": \"044271eda133bb9944f4aa7119bc661a8c1e9900\",\n    \"message\": \"Update docker login\",\n    \"timestamp\": \"2020-08-24T17:56:16+08:00\",\n    \"tree_id\": \"bf214120ff82ade624e0c2584c6e945c55ade8e3\",\n    \"url\": \"https://github.com/rammusxu/action-demo/commit/044271eda133bb9944f4aa7119bc661a8c1e9900\"\n  },\n  \"organization\": {\n    \"avatar_url\": \"https://avatars3.githubusercontent.com/u/36289044?v=4\",\n    \"description\": \"The SWAG Life\",\n    \"events_url\": \"https://api.github.com/orgs/rammusxu/events\",\n    \"hooks_url\": \"https://api.github.com/orgs/rammusxu/hooks\",\n    \"id\": 36289044,\n    \"issues_url\": \"https://api.github.com/orgs/rammusxu/issues\",\n    \"login\": \"rammusxu\",\n    \"members_url\": \"https://api.github.com/orgs/rammusxu/members{/member}\",\n    \"node_id\": \"MDEyOk9yZ2FuaXphdGlvbjM2Mjg5MDQ0\",\n    \"public_members_url\": \"https://api.github.com/orgs/rammusxu/public_members{/member}\",\n    \"repos_url\": \"https://api.github.com/orgs/rammusxu/repos\",\n    \"url\": \"https://api.github.com/orgs/rammusxu\"\n  },\n  \"pusher\": {\n    \"email\": \"comte_ken@hotmail.com\",\n    \"name\": \"RammusXu\"\n  },\n  \"ref\": \"refs/heads/github-pkg\",\n  \"repository\": {\n    \"archive_url\": \"https://api.github.com/repos/rammusxu/action-demo/{archive_format}{/ref}\",\n    \"archived\": false,\n    \"assignees_url\": \"https://api.github.com/repos/rammusxu/action-demo/assignees{/user}\",\n    \"blobs_url\": \"https://api.github.com/repos/rammusxu/action-demo/git/blobs{/sha}\",\n    \"branches_url\": \"https://api.github.com/repos/rammusxu/action-demo/branches{/branch}\",\n    \"clone_url\": \"https://github.com/rammusxu/action-demo.git\",\n    \"collaborators_url\": \"https://api.github.com/repos/rammusxu/action-demo/collaborators{/collaborator}\",\n    \"comments_url\": \"https://api.github.com/repos/rammusxu/action-demo/comments{/number}\",\n    \"commits_url\": \"https://api.github.com/repos/rammusxu/action-demo/commits{/sha}\",\n    \"compare_url\": \"https://api.github.com/repos/rammusxu/action-demo/compare/{base}...{head}\",\n    \"contents_url\": \"https://api.github.com/repos/rammusxu/action-demo/contents/{+path}\",\n    \"contributors_url\": \"https://api.github.com/repos/rammusxu/action-demo/contributors\",\n    \"created_at\": 1564547431,\n    \"default_branch\": \"master\",\n    \"deployments_url\": \"https://api.github.com/repos/rammusxu/action-demo/deployments\",\n    \"description\": null,\n    \"disabled\": false,\n    \"downloads_url\": \"https://api.github.com/repos/rammusxu/action-demo/downloads\",\n    \"events_url\": \"https://api.github.com/repos/rammusxu/action-demo/events\",\n    \"fork\": false,\n    \"forks\": 0,\n    \"forks_count\": 0,\n    \"forks_url\": \"https://api.github.com/repos/rammusxu/action-demo/forks\",\n    \"full_name\": \"rammusxu/action-demo\",\n    \"git_commits_url\": \"https://api.github.com/repos/rammusxu/action-demo/git/commits{/sha}\",\n    \"git_refs_url\": \"https://api.github.com/repos/rammusxu/action-demo/git/refs{/sha}\",\n    \"git_tags_url\": \"https://api.github.com/repos/rammusxu/action-demo/git/tags{/sha}\",\n    \"git_url\": \"git://github.com/rammusxu/action-demo.git\",\n    \"has_downloads\": true,\n    \"has_issues\": true,\n    \"has_pages\": true,\n    \"has_projects\": true,\n    \"has_wiki\": true,\n    \"homepage\": null,\n    \"hooks_url\": \"https://api.github.com/repos/rammusxu/action-demo/hooks\",\n    \"html_url\": \"https://github.com/rammusxu/action-demo\",\n    \"id\": 199778774,\n    \"issue_comment_url\": \"https://api.github.com/repos/rammusxu/action-demo/issues/comments{/number}\",\n    \"issue_events_url\": \"https://api.github.com/repos/rammusxu/action-demo/issues/events{/number}\",\n    \"issues_url\": \"https://api.github.com/repos/rammusxu/action-demo/issues{/number}\",\n    \"keys_url\": \"https://api.github.com/repos/rammusxu/action-demo/keys{/key_id}\",\n    \"labels_url\": \"https://api.github.com/repos/rammusxu/action-demo/labels{/name}\",\n    \"language\": \"Dockerfile\",\n    \"languages_url\": \"https://api.github.com/repos/rammusxu/action-demo/languages\",\n    \"license\": null,\n    \"master_branch\": \"master\",\n    \"merges_url\": \"https://api.github.com/repos/rammusxu/action-demo/merges\",\n    \"milestones_url\": \"https://api.github.com/repos/rammusxu/action-demo/milestones{/number}\",\n    \"mirror_url\": null,\n    \"name\": \"action-demo\",\n    \"node_id\": \"MDEwOlJlcG9zaXRvcnkxOTk3Nzg3NzQ=\",\n    \"notifications_url\": \"https://api.github.com/repos/rammusxu/action-demo/notifications{?since,all,participating}\",\n    \"open_issues\": 1,\n    \"open_issues_count\": 1,\n    \"organization\": \"rammusxu\",\n    \"owner\": {\n      \"avatar_url\": \"https://avatars3.githubusercontent.com/u/36289044?v=4\",\n      \"email\": \"engineering@swag.live\",\n      \"events_url\": \"https://api.github.com/users/rammusxu/events{/privacy}\",\n      \"followers_url\": \"https://api.github.com/users/rammusxu/followers\",\n      \"following_url\": \"https://api.github.com/users/rammusxu/following{/other_user}\",\n      \"gists_url\": \"https://api.github.com/users/rammusxu/gists{/gist_id}\",\n      \"gravatar_id\": \"\",\n      \"html_url\": \"https://github.com/rammusxu\",\n      \"id\": 36289044,\n      \"login\": \"rammusxu\",\n      \"name\": \"rammusxu\",\n      \"node_id\": \"MDEyOk9yZ2FuaXphdGlvbjM2Mjg5MDQ0\",\n      \"organizations_url\": \"https://api.github.com/users/rammusxu/orgs\",\n      \"received_events_url\": \"https://api.github.com/users/rammusxu/received_events\",\n      \"repos_url\": \"https://api.github.com/users/rammusxu/repos\",\n      \"site_admin\": false,\n      \"starred_url\": \"https://api.github.com/users/rammusxu/starred{/owner}{/repo}\",\n      \"subscriptions_url\": \"https://api.github.com/users/rammusxu/subscriptions\",\n      \"type\": \"Organization\",\n      \"url\": \"https://api.github.com/users/rammusxu\"\n    },\n    \"private\": true,\n    \"pulls_url\": \"https://api.github.com/repos/rammusxu/action-demo/pulls{/number}\",\n    \"pushed_at\": 1598262984,\n    \"releases_url\": \"https://api.github.com/repos/rammusxu/action-demo/releases{/id}\",\n    \"size\": 245,\n    \"ssh_url\": \"git@github.com:rammusxu/action-demo.git\",\n    \"stargazers\": 0,\n    \"stargazers_count\": 0,\n    \"stargazers_url\": \"https://api.github.com/repos/rammusxu/action-demo/stargazers\",\n    \"statuses_url\": \"https://api.github.com/repos/rammusxu/action-demo/statuses/{sha}\",\n    \"subscribers_url\": \"https://api.github.com/repos/rammusxu/action-demo/subscribers\",\n    \"subscription_url\": \"https://api.github.com/repos/rammusxu/action-demo/subscription\",\n    \"svn_url\": \"https://github.com/rammusxu/action-demo\",\n    \"tags_url\": \"https://api.github.com/repos/rammusxu/action-demo/tags\",\n    \"teams_url\": \"https://api.github.com/repos/rammusxu/action-demo/teams\",\n    \"trees_url\": \"https://api.github.com/repos/rammusxu/action-demo/git/trees{/sha}\",\n    \"updated_at\": \"2020-08-24T06:36:17Z\",\n    \"url\": \"https://github.com/rammusxu/action-demo\",\n    \"watchers\": 0,\n    \"watchers_count\": 0\n  },\n  \"sender\": {\n    \"avatar_url\": \"https://avatars1.githubusercontent.com/u/4367069?v=4\",\n    \"events_url\": \"https://api.github.com/users/RammusXu/events{/privacy}\",\n    \"followers_url\": \"https://api.github.com/users/RammusXu/followers\",\n    \"following_url\": \"https://api.github.com/users/RammusXu/following{/other_user}\",\n    \"gists_url\": \"https://api.github.com/users/RammusXu/gists{/gist_id}\",\n    \"gravatar_id\": \"\",\n    \"html_url\": \"https://github.com/RammusXu\",\n    \"id\": 4367069,\n    \"login\": \"RammusXu\",\n    \"node_id\": \"MDQ6VXNlcjQzNjcwNjk=\",\n    \"organizations_url\": \"https://api.github.com/users/RammusXu/orgs\",\n    \"received_events_url\": \"https://api.github.com/users/RammusXu/received_events\",\n    \"repos_url\": \"https://api.github.com/users/RammusXu/repos\",\n    \"site_admin\": false,\n    \"starred_url\": \"https://api.github.com/users/RammusXu/starred{/owner}{/repo}\",\n    \"subscriptions_url\": \"https://api.github.com/users/RammusXu/subscriptions\",\n    \"type\": \"User\",\n    \"url\": \"https://api.github.com/users/RammusXu\"\n  }\n}\n</code></pre> <p><code>env</code></p> <pre><code>LEIN_HOME=/usr/local/lib/lein\nM2_HOME=/usr/share/apache-maven-3.6.3\nGOROOT_1_11_X64=/opt/hostedtoolcache/go/1.11.13/x64\nANDROID_HOME=/usr/local/lib/android/sdk\nJAVA_HOME_11_X64=/usr/lib/jvm/adoptopenjdk-11-hotspot-amd64\nImageVersion=20200817.1\nAGENT_TOOLSDIRECTORY=/opt/hostedtoolcache\nLANG=C.UTF-8\nAZURE_EXTENSION_DIR=/opt/az/azcliextensions\nPOWERSHELL_DISTRIBUTION_CHANNEL=GitHub-Actions-ubuntu18\nGITHUB_API_URL=https://api.github.com\nINVOCATION_ID=dcb35bf82e314cdb9caa479c88a6c37e\nBOOST_ROOT_1_72_0=/opt/hostedtoolcache/boost/1.72.0/x64\nJAVA_HOME_12_X64=/usr/lib/jvm/adoptopenjdk-12-hotspot-amd64\nANDROID_SDK_ROOT=/usr/local/lib/android/sdk\nRUNNER_TOOL_CACHE=/opt/hostedtoolcache\nSWIFT_PATH=/usr/share/swift/usr/bin\nJAVA_HOME=/usr/lib/jvm/adoptopenjdk-8-hotspot-amd64\nJAVA_TOOL_OPTIONS=-Dfile.encoding=UTF8\nRUNNER_TRACKING_ID=github_0e3e53f2-73ff-4e23-8e4f-52cb37f62b82\nDOTNET_MULTILEVEL_LOOKUP=\"0\"\nGITHUB_REPOSITORY_OWNER=rammusxu\nGITHUB_ACTIONS=true\nDOTNET_SKIP_FIRST_TIME_EXPERIENCE=\"1\"\nCI=true\nDOTNET_NOLOGO=\"1\"\nUSER=runner\nGITHUB_HEAD_REF=\nGITHUB_ACTOR=RammusXu\nGITHUB_ACTION=run2\nGRADLE_HOME=/usr/share/gradle\nPWD=/home/runner/work/action-demo/action-demo\nImageOS=ubuntu18\nHOME=/home/runner\nGOROOT=/opt/hostedtoolcache/go/1.14.7/x64\nJOURNAL_STREAM=9:31545\nGOROOT_1_14_X64=/opt/hostedtoolcache/go/1.14.7/x64\nJAVA_HOME_8_X64=/usr/lib/jvm/adoptopenjdk-8-hotspot-amd64\nRUNNER_TEMP=/home/runner/work/_temp\nGOROOT_1_15_X64=/opt/hostedtoolcache/go/1.15.0/x64\nCONDA=/usr/share/miniconda\nGOROOT_1_13_X64=/opt/hostedtoolcache/go/1.13.15/x64\nBOOST_ROOT_1_69_0=/opt/hostedtoolcache/boost/1.69.0/x64\nDEBIAN_FRONTEND=noninteractive\nRUNNER_WORKSPACE=/home/runner/work/action-demo\nGITHUB_REF=refs/heads/github-pkg\nGITHUB_SHA=044271eda133bb9944f4aa7119bc661a8c1e9900\nGITHUB_RUN_ID=221813086\nGITHUB_SERVER_URL=https://github.com\nGOROOT_1_12_X64=/opt/hostedtoolcache/go/1.12.17/x64\nGECKOWEBDRIVER=/usr/local/share/gecko_driver\nDEPLOYMENT_BASEPATH=/opt/runner\nGITHUB_EVENT_PATH=/home/runner/work/_temp/_github_workflow/event.json\nCHROMEWEBDRIVER=/usr/local/share/chrome_driver\nHOMEBREW_REPOSITORY=\"/home/linuxbrew/.linuxbrew/Homebrew\"\nGITHUB_GRAPHQL_URL=https://api.github.com/graphql\nRUNNER_OS=Linux\nGITHUB_BASE_REF=\nVCPKG_INSTALLATION_ROOT=/usr/local/share/vcpkg\nGITHUB_JOB=show-env\nPERFLOG_LOCATION_SETTING=RUNNER_PERFLOG\nJAVA_HOME_7_X64=/usr/lib/jvm/zulu-7-azure-amd64\nRUNNER_USER=runner\nSHLVL=1\nHOMEBREW_PREFIX=\"/home/linuxbrew/.linuxbrew\"\nGITHUB_REPOSITORY=rammusxu/action-demo\nGITHUB_EVENT_NAME=push\nLEIN_JAR=/usr/local/lib/lein/self-installs/leiningen-2.9.4-standalone.jar\nGITHUB_RUN_NUMBER=166\nRUNNER_PERFLOG=/home/runner/perflog\nGITHUB_WORKFLOW=show-env\nANT_HOME=/usr/share/ant\nPATH=/home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/sbin:/usr/share/rust/.cargo/bin:/home/runner/.config/composer/vendor/bin:/home/runner/.dotnet/tools:/snap/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games\nSELENIUM_JAR_PATH=/usr/share/java/selenium-server-standalone.jar\nGITHUB_WORKSPACE=/home/runner/work/action-demo/action-demo\nCHROME_BIN=/usr/bin/google-chrome\nHOMEBREW_CELLAR=\"/home/linuxbrew/.linuxbrew/Cellar\"\n_=/usr/bin/env\n</code></pre>"},{"location":"snippets/github-action/#2020-05-18-github-workflow-env-on-pull-request","title":"2020-05-18 Github workflow env on pull request","text":"<pre><code>LEIN_HOME=/usr/local/lib/lein\nM2_HOME=/usr/share/apache-maven-3.6.3\nGOROOT_1_11_X64=/usr/local/go1.11\nANDROID_HOME=/usr/local/lib/android/sdk\nJAVA_HOME_11_X64=/usr/lib/jvm/zulu-11-azure-amd64\nImageVersion=20200430.1\nAGENT_TOOLSDIRECTORY=/opt/hostedtoolcache\nLANG=C.UTF-8\nAZURE_EXTENSION_DIR=/opt/az/azcliextensions\nPOWERSHELL_DISTRIBUTION_CHANNEL=GitHub-Actions-ubuntu18\nINVOCATION_ID=68f93b53277249cc8519235cea6396c9\nBOOST_ROOT_1_72_0=/usr/local/share/boost/1.72.0\nJAVA_HOME_12_X64=/usr/lib/jvm/zulu-12-azure-amd64\nANDROID_SDK_ROOT=/usr/local/lib/android/sdk\nRUNNER_TOOL_CACHE=/opt/hostedtoolcache\nSWIFT_PATH=/usr/share/swift/usr/bin\nJAVA_HOME=/usr/lib/jvm/zulu-8-azure-amd64\nRUNNER_TRACKING_ID=github_884bb8e2-7879-4810-9c99-0192e58487e7\nGITHUB_REPOSITORY_OWNER=rammusxu\nGITHUB_ACTIONS=true\nDOTNET_SKIP_FIRST_TIME_EXPERIENCE=\"1\"\nCI=true\nUSER=runner\nGITHUB_HEAD_REF=try-deploy\nGITHUB_ACTOR=RammusXu\nGITHUB_ACTION=run\nGRADLE_HOME=/usr/share/gradle\nPWD=/home/runner/work/action-demo/action-demo\nImageOS=ubuntu18\nHOME=/home/runner\nGOROOT=/usr/local/go1.14\nJOURNAL_STREAM=9:31391\nGOROOT_1_14_X64=/usr/local/go1.14\nJAVA_HOME_8_X64=/usr/lib/jvm/zulu-8-azure-amd64\nRUNNER_TEMP=/home/runner/work/_temp\nCONDA=/usr/share/miniconda\nGOROOT_1_13_X64=/usr/local/go1.13\nBOOST_ROOT_1_69_0=/usr/local/share/boost/1.69.0\nDEBIAN_FRONTEND=noninteractive\nRUNNER_WORKSPACE=/home/runner/work/action-demo\nGITHUB_REF=refs/pull/37/merge\nGITHUB_SHA=aadf39660fb8c0f87565bc08db9403f5197a8de6\nGITHUB_RUN_ID=107752396\nGOROOT_1_12_X64=/usr/local/go1.12\nGECKOWEBDRIVER=/usr/local/share/gecko_driver\nDEPLOYMENT_BASEPATH=/opt/runner\nGITHUB_EVENT_PATH=/home/runner/work/_temp/_github_workflow/event.json\nCHROMEWEBDRIVER=/usr/local/share/chrome_driver\nHOMEBREW_REPOSITORY=\"/home/linuxbrew/.linuxbrew/Homebrew\"\nRUNNER_OS=Linux\nGITHUB_BASE_REF=master\nVCPKG_INSTALLATION_ROOT=/usr/local/share/vcpkg\nGITHUB_JOB=test\nPERFLOG_LOCATION_SETTING=RUNNER_PERFLOG\nJAVA_HOME_7_X64=/usr/lib/jvm/zulu-7-azure-amd64\nRUNNER_USER=runner\nSHLVL=1\nHOMEBREW_PREFIX=\"/home/linuxbrew/.linuxbrew\"\nGITHUB_REPOSITORY=rammusxu/action-demo\nGITHUB_EVENT_NAME=pull_request\nLEIN_JAR=/usr/local/lib/lein/self-installs/leiningen-2.9.3-standalone.jar\nGITHUB_RUN_NUMBER=5\nRUNNER_PERFLOG=/home/runner/perflog\nGITHUB_WORKFLOW=.github/workflows/update-status.yaml\nANT_HOME=/usr/share/ant\nPATH=/usr/share/rust/.cargo/bin:/home/runner/.config/composer/vendor/bin:/home/runner/.dotnet/tools:/snap/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/home/linuxbrew/.linuxbrew/bin:/home/linuxbrew/.linuxbrew/sbin\nSELENIUM_JAR_PATH=/usr/share/java/selenium-server-standalone.jar\nGITHUB_WORKSPACE=/home/runner/work/action-demo/action-demo\nCHROME_BIN=/usr/bin/google-chrome\nHOMEBREW_CELLAR=\"/home/linuxbrew/.linuxbrew/Cellar\"\n2Z _=/usr/bin/env\n</code></pre>"},{"location":"snippets/github-action/#2020-03-11-use-a-self-build-action","title":"2020-03-11 Use a self build action","text":"<pre><code>/usr/bin/docker run --name e87b528978e939d04c5cabae17f516da08bb2a_79b912 --label e87b52 --workdir /github/workspace --rm -e INPUT_ARGS -e INPUT_MY_VAR -e INPUT_LOWER_VAR -e INPUT_WHO-TO-GREET -e INPUT_NAME -e HOME -e GITHUB_REF -e GITHUB_SHA -e GITHUB_REPOSITORY -e GITHUB_RUN_ID -e GITHUB_RUN_NUMBER -e GITHUB_ACTOR -e GITHUB_WORKFLOW -e GITHUB_HEAD_REF -e GITHUB_BASE_REF -e GITHUB_EVENT_NAME -e GITHUB_WORKSPACE -e GITHUB_ACTION -e GITHUB_EVENT_PATH -e RUNNER_OS -e RUNNER_TOOL_CACHE -e RUNNER_TEMP -e RUNNER_WORKSPACE -e ACTIONS_RUNTIME_URL -e ACTIONS_RUNTIME_TOKEN -e ACTIONS_CACHE_URL -e GITHUB_ACTIONS=true -v \"/var/run/docker.sock\":\"/var/run/docker.sock\" -v \"/home/runner/work/_temp/_github_home\":\"/github/home\" -v \"/home/runner/work/_temp/_github_workflow\":\"/github/workflow\" -v \"/home/runner/work/action-demo/action-demo\":\"/github/workspace\" e87b52:8978e939d04c5cabae17f516da08bb2a env\n</code></pre>"},{"location":"snippets/github-action/#reference","title":"Reference","text":"<ul> <li>https://docs.github.com/en/actions</li> <li>runner included sofeware/library https://github.com/actions/virtual-environments</li> <li>https://github.com/actions/toolkit/tree/master/packages/github</li> <li>https://github.com/actions/github-script</li> </ul>"},{"location":"snippets/gitlabci/","title":"Gitlab CI","text":""},{"location":"snippets/gitlabci/#debugging-containers","title":"Debugging Containers","text":"<p>For Gitlab CI <pre><code>docker run -it --rm -v $PWD:/app docker:18.09-git sh\n</code></pre></p> <pre><code>rammusxu/docker-box:python\nrammusxu/docker-box:\n</code></pre>"},{"location":"snippets/gitlabci/#build-docker-image-and-push-to-gitlab-registry","title":"Build docker image and push to gitlab registry","text":"<p>ref: https://gitlab.com/gableroux/gitlab-ci-example-docker</p> <pre><code>image: docker:latest\n\nservices:\n  - docker:dind\n\nbefore_script:\n  - docker login -u \"$CI_REGISTRY_USER\" -p \"$CI_REGISTRY_PASSWORD\" $CI_REGISTRY\n\nbuild-master:\n  stage: build\n  script:\n    - docker build --pull -t \"$CI_REGISTRY_IMAGE\" .\n    - docker push \"$CI_REGISTRY_IMAGE\"\n  only:\n    - master\n\nbuild:\n  stage: build\n  script:\n    - docker build --pull -t \"$CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG\" .\n    - docker push \"$CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG\"\n  except:\n    - master\n</code></pre>"},{"location":"snippets/gitlabci/#references","title":"References","text":"<ul> <li>CI \u74b0\u5883\u8b8a\u6578 https://docs.gitlab.com/ee/ci/variables/predefined_variables.html</li> </ul>"},{"location":"snippets/http/","title":"http","text":""},{"location":"snippets/http/#https","title":"HTTPS","text":""},{"location":"snippets/http/#http-strict-transport-security-hsts","title":"HTTP Strict Transport Security (HSTS)","text":"<p>\u78ba\u4fdd\u700f\u89bd\u5668\u4f7f\u7528 HTTPS \u958b\u555f\u7db2\u7ad9</p> <pre><code>Strict-Transport-Security: max-age=31536000; includeSubDomains\n</code></pre> <p>\u5982\u679c\u7b2c\u4e00\u6b21\u4f7f\u7528 http \u6216\u662f HSTS \u904e\u671f\uff0c\u5c31\u6c92\u6709\u4f5c\u7528\u4e86\u3002</p>"},{"location":"snippets/jenkins/","title":"Jenkins","text":""},{"location":"snippets/jenkins/#curl-trigger-build","title":"curl trigger build","text":"<pre><code>curl -i -d \"targetEnv=demo&amp;myArg=helloWorld\" \\\n    -u admin:a_md5_context \\\n    -XPOST https://my_domain/job/my_job/buildWithParameters\n</code></pre>"},{"location":"snippets/kubernetes/","title":"Kubernetes","text":"<p>Kubernetes cheatsheet, snippets, troubleshooting, tips, hints</p>"},{"location":"snippets/kubernetes/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Installation</li> <li>Volumes</li> <li>StatefulSet</li> <li>Container</li> <li>Resources</li> <li>PVC</li> <li>Affinity</li> <li>Helm</li> </ul>"},{"location":"snippets/kubernetes/#installation","title":"Installation","text":""},{"location":"snippets/kubernetes/#kubectl","title":"kubectl","text":"<p>ref: https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl-binary-with-curl-on-linux</p> <p>Get stable version <pre><code>curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt\n</code></pre></p> <p>Install kubectl <pre><code>VERSION=1.18.0\nwget -q https://storage.googleapis.com/kubernetes-release/release/v$VERSION/bin/linux/amd64/kubectl -O /usr/local/bin/kubectl\nchmod +x /usr/local/bin/kubectl\n</code></pre></p>"},{"location":"snippets/kubernetes/#volumes","title":"Volumes","text":"<pre><code>spec:\n  template:\n    spec:\n      volumes:\n      - name: mongo-socket\n        emptyDir: {}\n\n      containers:\n      - name: mongos\n        image: mongo:4.0.2\n        volumeMounts:\n        - name: mongo-socket\n          mountPath: /tmp\n        - name: myconfigmap\n          configMap:\n            name: myconfigmap\n        - name: mysecret\n          secret:\n            secretName: mysecret\n</code></pre> <pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: test-pod\nspec:\n  containers:\n    - name: test-container\n      image: k8s.gcr.io/busybox\n      command: [ \"/bin/sh\", \"-c\", \"ls /etc/config/\" ]\n      volumeMounts:\n      - name: config-volume\n        mountPath: /etc/config\n  volumes:\n    - name: config-volume\n      configMap:\n        name: test-config\n  restartPolicy: Never\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: test-config\ndata:\n  domains.json: |\n    [\n      \"google.com\",\n      \"facebook.com\",\n      \"amazon.com\",\n      \"swag.live\"\n    ]\n</code></pre>"},{"location":"snippets/kubernetes/#statefulset","title":"StatefulSet","text":""},{"location":"snippets/kubernetes/#volumeclaimtemplates","title":"volumeClaimTemplates","text":"<pre><code>  volumeClaimTemplates:\n  - metadata:\n      name: data\n    spec:\n      accessModes: [\"ReadWriteOnce\"]\n      storageClassName: ssd\n      resources:\n        requests:\n          storage: 50Gi\n</code></pre>"},{"location":"snippets/kubernetes/#container","title":"Container","text":""},{"location":"snippets/kubernetes/#multiple-line-commands-readinessprobe","title":"Multiple line (commands) readinessProbe","text":"<pre><code>    readinessProbe:\n      exec:\n        command:\n          - sh\n          - -c\n          - |\n            echo hi &gt;&gt; /one\n            echo hi2 &gt;&gt; /one2\n      initialDelaySeconds: 0\n      periodSeconds: 2\n      timeoutSeconds: 5\n      successThreshold: 1\n      failureThreshold: 2\n</code></pre>"},{"location":"snippets/kubernetes/#resources","title":"Resources","text":"<pre><code>        resources:\n          limits:\n            cpu: 1\n            memory: 2G\n          requests:\n            cpu: 1\n            memory: 2G\n</code></pre>"},{"location":"snippets/kubernetes/#pvc","title":"PVC","text":"<pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: grafana\n  labels:\n    app: grafana\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 10Gi\n  storageClassName: standard\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: grafana\n  labels:\n    app: grafana\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: grafana\n  strategy:\n    type: RollingUpdate\n  template:\n    metadata:\n      labels:\n        app: grafana\n    spec:\n      volumes:\n        - name: storage\n          persistentVolumeClaim:\n            claimName: standard\n          # emptyDir: {}\n</code></pre>"},{"location":"snippets/kubernetes/#affinity","title":"Affinity","text":""},{"location":"snippets/kubernetes/#keywords","title":"Keywords","text":"<p>operators: <pre><code>In, NotIn, Exists, DoesNotExist, Gt, Lt\n</code></pre></p> <p>Scheduling:</p> <ul> <li>preferredDuringSchedulingIgnoredDuringExecution</li> <li>requiredDuringSchedulingIgnoredDuringExecution</li> </ul>"},{"location":"snippets/kubernetes/#pod-node","title":"Pod \u53ea\u80fd\u653e\u5728\u7b26\u5408\u4ee5\u4e0b\u689d\u4ef6\u7684 Node","text":"<pre><code>    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: cloud.google.com/gke-preemptible\n                operator: NotIn\n                values:\n                - \"true\"\n              - key: sysctl/vm.max_map_count\n                operator: In\n                values:\n                - \"262144\"\n</code></pre>"},{"location":"snippets/kubernetes/#node-pod","title":"\u540c\u4e00\u500b Node \u4e0d\u653e\u4e00\u6a23\u7684 Pod","text":"<pre><code>    spec:\n      affinity:\n        podAntiAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            - topologyKey: \"kubernetes.io/hostname\"\n              labelSelector:\n                matchExpressions:\n                  - key: \"app\"\n                    operator: In\n                    values:\n                    - mongo-sh0\n</code></pre> <p>new: <pre><code>    spec:\n      affinity:\n        podAntiAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            - topologyKey: \"kubernetes.io/hostname\"\n              labelSelector:\n                matchLabels:\n                  app: mongo-sh0\n</code></pre></p>"},{"location":"snippets/kubernetes/#env","title":"env","text":""},{"location":"snippets/kubernetes/#pod-env","title":"Pod env","text":"<pre><code>spec:\n  containers:\n  - name: envar-demo-container\n    image: gcr.io/google-samples/node-hello:1.0\n    env:\n    - name: DEMO_GREETING\n      value: \"Hello from the environment\"\n    - name: DEMO_FAREWELL\n      value: \"Such a sweet sorrow\"\n</code></pre>"},{"location":"snippets/kubernetes/#metadataannotations","title":"metadata.annotations","text":"<pre><code>      template:\n        metadata:\n          annotations:\n            version: abc4444\n\n        spec:\n          containers:\n          - name: cronjob\n            env:\n            - name: MY_VERSION\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.annotations['version']\n</code></pre>"},{"location":"snippets/kubernetes/#metadataname-metadatanamespace","title":"metadata.name metadata.namespace","text":"<p>ref: https://kubernetes.io/docs/tasks/inject-data-application/downward-api-volume-expose-pod-information/#capabilities-of-the-downward-api <pre><code>          env:\n          - name: POD_NAMESPACE\n            valueFrom:\n              fieldRef:\n                fieldPath: metadata.namespace\n          - name: POD_NAME\n            valueFrom:\n              fieldRef:\n                fieldPath: metadata.name\n</code></pre></p>"},{"location":"snippets/kubernetes/#secret","title":"Secret","text":"<p>Encode/Decode <pre><code>echo -n 'mykey' | base64\necho -n 'bXlrZXk=' | base64 -D\n</code></pre></p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: mysecret\ntype: Opaque\ndata:\n  mykey: bXlrZXk=\n</code></pre> <pre><code>spec:\n  containers:\n  - name: mycontainer\n    image: redis\n    env:\n    - name: SECRET_USERNAME\n      valueFrom:\n        secretKeyRef:\n          name: mysecret\n          key: mykey\n</code></pre> <pre><code>kubectl get secret tls -o \"jsonpath={.data['tls\\.key']}\"\n</code></pre>"},{"location":"snippets/kubernetes/#envfrom","title":"envFrom","text":"<pre><code>spec:\n  containers:\n  - name: http\n    image: asia.gcr.io/swag-2c052/swag:42ff66b1\n    envFrom:\n    - configMapRef:\n        name: myconfigmap\n    - secretRef:\n        name: mysecret\n</code></pre>"},{"location":"snippets/kubernetes/#volumemounts-from-configmap","title":"volumeMounts from configmap","text":"PodConfigMap <pre><code>    spec:\n      volumes:\n      - name: config\n        configMap:\n          name: nginx-config\n\n      containers:\n      - name: echoserver\n        image: gcr.io/google_containers/echoserver:1.10\n        ports:\n        - containerPort: 8080\n\n        # nginx.conf override\n        volumeMounts:\n        - name: config\n          subPath: nginx.conf\n          mountPath: /etc/nginx/nginx.conf\n          # mountPath: /usr/local/openresty/nginx/conf/nginx.conf\n          readOnly: true\n</code></pre> <pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: nginx-config\n  namespace: ingress-nginx\ndata:\n  nginx.conf: |-\n    events {\n      worker_connections 1024;\n    }\n</code></pre>"},{"location":"snippets/kubernetes/#container-injection","title":"Container Injection","text":""},{"location":"snippets/kubernetes/#etchosts-and-etcresolvconf","title":"/etc/hosts and /etc/resolv.conf","text":"<p>ref:</p> <ul> <li>https://kubernetes.io/docs/concepts/services-networking/add-entries-to-pod-etc-hosts-with-host-aliases/#adding-additional-entries-with-hostaliases</li> <li>https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-s-dns-config</li> </ul> <p>This will append hostname and overwrite /etc/resolv.conf</p> <pre><code>apiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: dnsmasq\n  labels:\n    name: dnsmasq\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 1\n      maxUnavailable: 1\n    type: RollingUpdate\n  template:\n    metadata:\n      labels:\n        name: dnsmasq\n    spec:\n      hostAliases:\n      - ip: \"35.227.233.133\"\n        hostnames:\n        - \"swag.live\"\n      dnsPolicy: \"None\"\n      dnsConfig:\n        nameservers:\n          - 1.1.1.1\n          - 8.8.8.8\n      containers:\n      - image: rammusxu/dnsmasq\n        name: dnsmasq\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"100M\"\n        ports:\n        - containerPort:  53\n          name: dnsmasq\n        - containerPort:  53\n          protocol: UDP\n          name: dnsmasq-udp\n        imagePullPolicy: Always\n</code></pre>"},{"location":"snippets/kubernetes/#container-with-commands","title":"Container with commands","text":"<pre><code>      - name: imagemagick\n        image: swaglive/imagemagick:lastest\n        command: [\"/bin/sh\",\"-e\",\"-o\",\"pipefail\",\"-c\"]\n        # command: [\"/bin/sh\",\"-c\"]\n        args:\n        - |\n          magick montage -quality 90 -resize 211x292^ -gravity center -crop 211x292+0+0 -geometry +4+4 -tile 7x4 -background none +repage $(cat /tmp/covers.txt) /tmp/montage.jpg\n        volumeMounts:\n        - name: tmp\n          mountPath: /tmp\n</code></pre>"},{"location":"snippets/kubernetes/#gke","title":"GKE","text":""},{"location":"snippets/kubernetes/#enable-cdn-in-service","title":"Enable CDN in Service","text":"<pre><code>apiVersion: cloud.google.com/v1beta1\nkind: BackendConfig\nmetadata:\n  namespace: default\n  name: gclb-cdn-hpq\nspec:\n  cdn:\n    enabled: true\n    cachePolicy:\n      includeHost: true\n      includeProtocol: true\n      includeQueryString: true\n---\napiVersion: v1\nkind: Service\nmetadata:\n  namespace: default\n  name: webapp\n  annotations:\n    beta.cloud.google.com/backend-config: '{\"ports\": {\"http\":\"gclb-cdn-hpq\"}}'\nspec:\n  type: NodePort\n  selector:\n    app: webapp\n  ports:\n  - name: http\n    port: 80\n    targetPort: http\n</code></pre>"},{"location":"snippets/kubernetes/#helm","title":"Helm","text":""},{"location":"snippets/kubernetes/#install-a-3rd-party-chart","title":"Install a 3rd party chart","text":"<p>ref: https://artifacthub.io/packages/helm/kvaps/nfs-server-provisioner?modal=install</p> <pre><code>helm repo add kvaps https://kvaps.github.io/charts\nhelm install nfs-server-provisioner kvaps/nfs-server-provisioner --version 1.2.1\nhelm show values kvaps/nfs-server-provisioner --version 1.2.1\nhelm show values kvaps/nfs-server-provisioner --version 1.2.1 &gt; values.yaml\n</code></pre>"},{"location":"snippets/kubernetes/#uninstall","title":"Uninstall","text":"<pre><code>helm uninstall nfs-server-provisioner -n nfs-server\n</code></pre>"},{"location":"snippets/kubernetes/#render-a-chart-to-a-yaml-file","title":"Render a chart to a yaml file","text":"<pre><code>helm template nfs-server-provisioner \\\n  kvaps/nfs-server-provisioner \\\n  --version 1.2.1 \\\n  -f values.yaml \\\n  -n nfs-server &gt; nfs-server.yaml\n</code></pre>"},{"location":"snippets/kubernetes/#cheat-sheet","title":"Cheat sheet","text":"<ul> <li>go temlpate: https://masterminds.github.io/sprig/</li> </ul>"},{"location":"snippets/kubernetes/#show-error-when-value-is-not-defined","title":"Show error when value is not defined","text":"<pre><code>            value: {{ required \"kafkaEndpoint is required\" .Values.kafkaEndpoint }}\n</code></pre>"},{"location":"snippets/kubernetes/#restart-deployment-when-config-changes","title":"Restart deployment when config changes","text":"<pre><code>  template:\n    metadata:\n      annotations:\n        checksum/config: {{ include (print $.Template.BasePath \"/configmap-vector.yaml\") . | sha256sum }}\n</code></pre>"},{"location":"snippets/kubernetes/#render-a-file-to-yaml","title":"Render a file to yaml","text":"<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: {{ include \"vector.fullname\" . }}-python\n  annotations:\n    \"helm.sh/hook\": pre-install,pre-upgrade\ndata:\n  kibana.py: |-\n    {{ tpl (.Files.Get \"conf/test.py\") . | nindent 4 }}\n\n  __init__.py: ''\n</code></pre>"},{"location":"snippets/kubernetes/#multiple-layer-variable-check","title":"multiple layer variable check","text":"<p>Info</p> <p>nil pointer evaluating interface ref: https://github.com/helm/helm/issues/8026#issuecomment-881216078</p> <pre><code>{{- if (.Values.debug).init }}\nsleep 2d\n{{- end }}\n\n---\ndebug:\n  init: true\n</code></pre>"},{"location":"snippets/kubernetes/#helmfile","title":"Helmfile","text":"<pre><code>helmfile apply --skip-deps\n</code></pre>"},{"location":"snippets/kubernetes/#frequent-commands","title":"Frequent Commands","text":""},{"location":"snippets/kubernetes/#gracefully-rolling-restart-deployment","title":"Gracefully rolling restart deployment.","text":"<pre><code>kubectl rollout restart deployment/my-sites --namespace=default\n</code></pre>"},{"location":"snippets/kubernetes/#wait-another-deployment-restart-then-do-something","title":"Wait another deployment restart then do something","text":"<pre><code>kubectl rollout restart deployment/storage --namespace=google-cloud\nkubectl rollout status deployment/storage  --namespace=google-cloud\nkubectl rollout restart deployment/sites --namespace=default\nkubectl rollout status deployment/sites --namespace=default\n</code></pre> <p>log: <pre><code>deployment.apps/storage restarted\nWaiting for deployment \"storage\" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment \"storage\" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment \"storage\" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment \"storage\" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment \"storage\" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment \"storage\" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment \"storage\" rollout to finish: 1 old replicas are pending termination...\nWaiting for deployment \"storage\" rollout to finish: 1 old replicas are pending termination...\ndeployment \"storage\" successfully rolled out\ndeployment.apps/sites restarted\nWaiting for deployment \"sites\" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment \"sites\" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment \"sites\" rollout to finish: 1 out of 3 new replicas have been updated...\nWaiting for deployment \"sites\" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment \"sites\" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment \"sites\" rollout to finish: 2 out of 3 new replicas have been updated...\nWaiting for deployment \"sites\" rollout to finish: 1 old replicas are pending termination...\nWaiting for deployment \"sites\" rollout to finish: 1 old replicas are pending termination...\ndeployment \"sites\" successfully rolled out\n</code></pre></p>"},{"location":"snippets/kubernetes/#create-new-job-from-cronjob","title":"Create new job from cronjob","text":"<pre><code>kubectl create job --from=cronjob/my-daily-task manual-20200101\n</code></pre>"},{"location":"snippets/kubernetes/#reference","title":"Reference","text":"<ul> <li>feiskyer Handbook</li> <li>feiskyer Examples</li> </ul>"},{"location":"snippets/linux/","title":"Linux commands","text":"<p>\u5e38\u7528\u7684 linux \u6307\u4ee4\u96c6\u8207\u7bc4\u4f8b</p>"},{"location":"snippets/linux/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Process:<ul> <li>ps - \u76ee\u524d\u7684\u6240\u6709 process\u3002</li> <li>lsof - \u5217\u51fa open files\u3002</li> <li>screen - \u5728\u80cc\u666f\u57f7\u884c\u7a0b\u5e8f\u3002</li> </ul> </li> <li>Linux Kernel:<ul> <li>sysctl - \u4fee\u6539 Linux Kernel \u53c3\u6578\u3002</li> </ul> </li> <li>Disk, File system:<ul> <li>ls - \u5217\u51fa\u8cc7\u6599\u593e\u5167\u5bb9\u3002</li> <li>du - \u8a08\u7b97\u6a94\u6848\u4f7f\u7528\u7a7a\u9593\u3002</li> <li>lsblk - \u5217\u51fa block devices\u3002</li> <li>dd - \u8f49\u63db\u3001\u8907\u88fd\u3001\u7522\u751f\u6a94\u6848\u3002</li> <li>tail - \u5370\u51fa\u6a94\u6848\u7684\u6700\u5f8c\u5e7e\u884c\u3002</li> <li>untar - \b\u58d3\u7e2e\u3001\u89e3\u58d3\u7e2e\u6a94\u6848\u3002</li> <li>fio - disk i/o \u58d3\u529b\u6e2c\u8a66\u3002</li> </ul> </li> <li>Network:<ul> <li>wget - \u4e0b\u8f09\u7db2\u8def\u8cc7\u6e90\u3002</li> <li>curl - \u4e0b\u8f09\u7db2\u8def\u8cc7\u6e90\u3002</li> <li>httpie - \u4e0b\u8f09\u7db2\u8def\u8cc7\u6e90\u3002RESTful like CLI\u3002</li> <li>netstat</li> <li>ss - socket statistics</li> </ul> </li> <li>Miscellaneous:<ul> <li>parallel - \u4e26\u884c\u57f7\u884c\u6307\u4ee4\u3002</li> </ul> </li> </ul>"},{"location":"snippets/linux/#process","title":"Process","text":""},{"location":"snippets/linux/#ps","title":"ps","text":"<pre><code>ps aux | grep \"java -jar build/libs/Hello-1.0.jar\"\npgrep -f \"java -jar build/libs/Hello-1.0.jar\"\npkill -f \"java -jar build/libs/Hello-1.0.jar\"\n\npgrep -f \"java -jar build/libs/Hello-1.0.jar\" | xargs kill\npkill -f \"java -jar build/libs/Hello-1.0.jar\" || true\n\n\nps aux | grep node\nkill -9 PID\nkillall node\n</code></pre>"},{"location":"snippets/linux/#lsof","title":"lsof","text":"<p>\u5217\u51fa\u4f54\u7528\u4e2d\u7684 port <pre><code># lsof -i -P -n | grep LISTEN\nsystemd-r   645 systemd-resolve   13u  IPv4  16633      0t0  TCP 127.0.0.53:53 (LISTEN)\nsshd        882            root    3u  IPv4  19952      0t0  TCP *:22 (LISTEN)\nsshd        882            root    4u  IPv6  19969      0t0  TCP *:22 (LISTEN)\n</code></pre></p> <p>\u78ba\u5b9a port \u6709\u6c92\u6709\u88ab\u4f54\u7528 <pre><code>lsof -i :22\n</code></pre></p>"},{"location":"snippets/linux/#screen","title":"screen","text":"<p>\u5728\u80cc\u666f\u57f7\u884c\u7a0b\u5e8f\u3002</p> <pre><code>screen\nscreen -ls\nscreen -r 69262.ttys001.mac-mini\n</code></pre> <p>\u71b1\u9375</p> <pre><code>ctrl+a d Detach \u73fe\u5728\u7684 screen\n</code></pre>"},{"location":"snippets/linux/#linux-kernel","title":"Linux Kernel","text":""},{"location":"snippets/linux/#sysctl","title":"sysctl","text":"<p>\u53c3\u6578\u6703\u5728 <code>/proc/sys</code> \u8cc7\u6599\u593e\u4e0b\u3002 <pre><code>sysctl vm.max_map_count\nsysctl -w vm.max_map_count=262144\nsysctl -a | grep vm\nsysctl -a | grep vm.max_map_count\n</code></pre></p>"},{"location":"snippets/linux/#disk-storage","title":"Disk, Storage","text":""},{"location":"snippets/linux/#ls","title":"ls","text":"<pre><code>ls -lh file\n</code></pre>"},{"location":"snippets/linux/#du","title":"du","text":"<pre><code>du -sh .\n</code></pre>"},{"location":"snippets/linux/#lsblk","title":"lsblk","text":"<pre><code>lsblk\nlsblk -a\n</code></pre>"},{"location":"snippets/linux/#dd","title":"dd","text":"<p>Generate random binary file <pre><code># 1 count = 512 Bytes\n# of = output file name\ndd if=/dev/urandom of=dd10 count=20\n</code></pre></p>"},{"location":"snippets/linux/#tail","title":"tail","text":"<p>\u5370\u51fa\u6a94\u6848\u7684\u6700\u5f8c\u5e7e\u884c</p> <p><code>tail -f buxybox-1</code> \u6703\u8ddf\u96a8\u539f\u59cb\u6a94\u6848 <pre><code># tail -f busybox-1\nhi\nhi3\n\n# echo hi &gt;&gt; busybox-1\n# mv busybox-1 busybox-2\n# echo hi2 &gt;&gt; busybox-1\n# echo hi3 &gt;&gt; busybox-2\n</code></pre></p> <p><code>tail -F buxybox-1</code> \u6703\u91cd\u8907\u5617\u8a66\u540c\u4e00\u500b\u6a94\u6848</p> <pre><code># tail -F busybox-1\nhi\ntail: busybox-1 has become inaccessible: No such file or directory\ntail: busybox-1 has appeared; following end of new file\nhi\n\n# echo hi &gt;&gt; busybox-1\n# mv busybox-1 busybox-3\n# echo hi &gt;&gt; busybox-1\n</code></pre>"},{"location":"snippets/linux/#untar","title":"untar","text":"<p>\u58d3\u7e2e\u3001\u89e3\u58d3\u7e2e\u6a94\u6848\u3002 <pre><code>wget https://github.com/openresty/headers-more-nginx-module/archive/refs/tags/v0.33.tar.gz\ntar -xf v0.33.tar.gz\n# .\n# \u251c\u2500\u2500 headers-more-nginx-module-0.33\n# \u2502   \u251c\u2500\u2500 README.markdown\n# \u2502   \u251c\u2500\u2500 config\n# \u2502   \u251c\u2500\u2500 src\n# \u2502   \u251c\u2500\u2500 t\n# \u2502   \u251c\u2500\u2500 util\n# \u2502   \u2514\u2500\u2500 valgrind.suppress\n# \u2514\u2500\u2500 v0.33.tar.gz\n</code></pre></p>"},{"location":"snippets/linux/#monitoring","title":"Monitoring","text":""},{"location":"snippets/linux/#login-log","title":"Login log","text":"<pre><code>last\nlastlog\n</code></pre>"},{"location":"snippets/linux/#keep-tracking-a-command","title":"Keep tracking a command","text":"<pre><code>watch -n 1 -d http http://localhost/\n</code></pre>"},{"location":"snippets/linux/#linux-user","title":"Linux User","text":"<pre><code>/etc/ssh/sshd_config\n/etc/passwd\n/etc/sudoers\nuserdel ashish\nuserdel -r ashish # and Home Directory\n</code></pre>"},{"location":"snippets/linux/#linux-adduser-without-prompts","title":"Linux - adduser without prompts","text":"<pre><code>adduser runner --disabled-password  --gecos \"\"\n</code></pre>"},{"location":"snippets/linux/#linux-add-sudoer-group-to-user","title":"Linux - Add sudoer group to user","text":"<pre><code>echo \"runner ALL=(ALL) NOPASSWD: ALL\" &gt;&gt; /etc/sudoers &amp;&amp;\\\nusermod -aG sudo runner\n</code></pre>"},{"location":"snippets/linux/#cp","title":"cp","text":"<p>Copy folder content to another folder <pre><code>cp -ar plugins/. share-plugins\n</code></pre></p>"},{"location":"snippets/linux/#apt-get","title":"apt-get","text":"<pre><code># ping\napt-get install iputils-ping\n\n# dig, nslookup\napt-get install dnsutils -y\n\n# ps\napt-get install procps\n\n# mysql\napt-get install mysql-client\n</code></pre>"},{"location":"snippets/linux/#network","title":"Network","text":""},{"location":"snippets/linux/#wget","title":"wget","text":"<pre><code># wget -qO- https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-240.0.0-darwin-x86_64.tar.gz | tar xvz -\nwget -qO- your_link_here | tar xvz -\n\nwget -O- https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-sdk-240.0.0-darwin-x86_64.tar.gz | tar xvz -C .\n\n# wget -O- https://github.com/sing1ee/elasticsearch-jieba-plugin/archive/v7.0.0.tar.gz | tar -xzv -C . --strip 1\nwget -O- your_link_here | tar -xzv -C . --strip 1\nwget -c https://github.com/moby/buildkit/releases/download/v0.7.2/buildkit-v0.7.2.linux-amd64.tar.gz -O - | tar -xz\n\n\nwget -q -O tmp.zip http://downloads.wordpress.org/plugin/akismet.2.5.3.zip &amp;&amp; unzip tmp.zip &amp;&amp; rm tmp.zip\n</code></pre>"},{"location":"snippets/linux/#curl","title":"curl","text":"<pre><code>curl -X GET \"https://httpbin.org/ip\" -H \"accept: application/json\"\ncurl https://httpbin.org/ip\n\ncurl https://sdk.cloud.google.com | bash -s -- --disable-prompts\n\n\ncurl -X PUT \"localhost:9200/_cluster/settings\" -u \"elastic:xxx\" \\\n  -H 'Content-Type: application/json; charset=utf-8' \\\n  --data-binary @- &lt;&lt; EOF\n{\n  \"persistent\": {\n    \"cluster.routing.allocation.enable\": \"primaries\"\n  }\n}\nEOF\n</code></pre>"},{"location":"snippets/linux/#get-response-time","title":"Get response time","text":"<pre><code>TARGET=google.com\ncurl -s -o /dev/null -w \"target=${TARGET} time_namelookup=%{time_namelookup} time_connect=%{time_connect} time_appconnect=%{time_appconnect} time_starttransfer=%{time_starttransfer} time_total=%{time_total} size_download=%{size_download} speed_download=%{speed_download} remote_ip=%{remote_ip}\\n\" \"${TARGET}\"\n\ncurl -o /dev/null -s -w 'Total: %{time_total}s\\n'  https://www.google.com\n</code></pre>"},{"location":"snippets/linux/#httpie","title":"httpie","text":"<pre><code>## Print request infomations: header, payload\nhttp localhost:3000 'Accept-Encoding: br, gzip, deflate' -v\n## Print response header only\nhttp localhost:3000 'Accept-Encoding: br, gzip, deflate' -h\n</code></pre>"},{"location":"snippets/linux/#netstat","title":"netstat","text":"<p>Show ports in use <pre><code>netstat -plnt\n</code></pre></p>"},{"location":"snippets/linux/#ss","title":"ss","text":"<p>https://man7.org/linux/man-pages/man8/ss.8.html https://wangchujiang.com/linux-command/c/ss.html <pre><code>ss -ntpl\n</code></pre></p>"},{"location":"snippets/linux/#nc","title":"nc","text":"<pre><code>## Check if a port is opened\n/workspace # nc -vz localhost 3000\nlocalhost (127.0.0.1:3000) open\n</code></pre>"},{"location":"snippets/linux/#stringtext-processing","title":"String(Text) Processing","text":"<pre><code># -P: Perl regex\n# -o: Only match\n# \\K: Only match Perl regex will show\ngrep -oP 'foobar \\K\\w+' test.txt\n# -F: multi delimiter\nawk -F' |\\r' '{print $2 \"/cover.jpg\"}'\n</code></pre>"},{"location":"snippets/linux/#using-variable-in-xargs","title":"Using variable in xargs","text":"<pre><code># curl is wired. https://stackoverflow.com/questions/37014430/awk-how-to-concat-number-with-strings\n# -P: multi process\n# -I: input stream as a variable\nxargs -P 10 -I username curl -sI https://xxxxxxxxxxx/username | grep 'Location: ' | awk '{print $2 \"/a_string\"}'\n</code></pre>"},{"location":"snippets/linux/#get-nth-line-of-stdout-on-linux","title":"Get nth line of stdout on linux","text":"<p>ref: https://stackoverflow.com/questions/1429556/command-to-get-nth-line-of-stdout <pre><code>ls -l | sed -n 2p\nls -l | head -2 | tail -1\n</code></pre></p>"},{"location":"snippets/linux/#parsing-xml-in-bash","title":"Parsing xml in bash","text":"<pre><code>apk add libxml2-utils curl\ncurl -s https://data.iana.org/root-anchors/root-anchors.xml | xmllint --format --xpath 'TrustAnchor/KeyDigest/KeyTag' -\n</code></pre>"},{"location":"snippets/linux/#load-testing","title":"Load Testing","text":""},{"location":"snippets/linux/#generate-high-cpu-usage","title":"Generate High CPU Usage","text":"<pre><code>while true; do echo \"hi\" ; done;\nwhile true; do curl localhost ; done;\n</code></pre>"},{"location":"snippets/linux/#generate-high-memory-usage","title":"Generate High memory usage","text":"<p>ref: https://stackoverflow.com/questions/20200982/how-to-generate-a-memory-shortage-using-bash-script</p> <pre><code>yes | tr \\\\n x | head -c $BYTES | grep n\nyes | tr \\\\n x | head -c 100m | grep n\n</code></pre>"},{"location":"snippets/linux/#jq","title":"jq","text":"<pre><code>$(msg=$(cat $(grep -E \"(mirror to|replace by)\" *.txt -l)) jq -nc '{\"body\":env.msg}')\n</code></pre>"},{"location":"snippets/linux/#miscellaneous","title":"Miscellaneous","text":""},{"location":"snippets/linux/#parallel","title":"parallel","text":"<p>\u958b\u591a\u500b thread \u540c\u6642\u57f7\u884c\u591a\u500b\u6307\u4ee4 <pre><code>parallel docker push ::: \\\n    $DOCKER_REGISTRY_URL/$DOCKER_REPOSITORY_NAME:$DOCKER_REF_TAG-builder \\\n    $DOCKER_REGISTRY_URL/$DOCKER_REPOSITORY_NAME:$DOCKER_REF_TAG \\\n    $DOCKER_REGISTRY_URL/$DOCKER_REPOSITORY_NAME:$DOCKER_TAG\n</code></pre></p>"},{"location":"snippets/lua/","title":"Lua","text":"<pre><code>for k,v in pairs(resp_user.header) do\n    -- ngx.header[k] = v\n    ngx.say(k .. ' ' .. v)\nend\n</code></pre>"},{"location":"snippets/mac-setup/","title":"Mac Setup","text":""},{"location":"snippets/mac-setup/#tool","title":"Tool","text":""},{"location":"snippets/mac-setup/#brew","title":"brew","text":"<p>Install: <pre><code>/usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n\nbrew install bash-completion\n\n# Then add the following line to your ~/.bash_profile:\n[ -f /usr/local/etc/bash_completion ] &amp;&amp; . /usr/local/etc/bash_completion\n</code></pre> Must have: <pre><code>brew install python3\nbrew install pyenv\n\nbrew upgrade\n\npyenv install 3.6.8\n</code></pre></p>"},{"location":"snippets/mac-setup/#terminal","title":"Terminal","text":"<pre><code>brew cask install iterm2\nbrew install zsh zsh-completions\n</code></pre> <p><code>iTerm2 &gt; Preferences &gt; Profiles &gt; Keys</code></p> <p>https://medium.com/@jonnyhaynes/jump-forwards-backwards-and-delete-a-word-in-iterm2-on-mac-os-43821511f0a</p> <ul> <li>\u2325+\u2190</li> <li>\u2325+\u2192</li> <li>escape</li> </ul>"},{"location":"snippets/mac-setup/#zsh","title":"zsh","text":"<p>https://github.com/ohmyzsh/ohmyzsh/wiki/Plugins plugins=(git z httpie zsh-autosuggestions)</p> <p>What I use: - https://github.com/zsh-users/zsh-autosuggestions - git z httpie</p>"},{"location":"snippets/mac-setup/#software","title":"Software","text":"<ul> <li>source tree</li> <li>vs code</li> <li>docker for desktop</li> <li>rectangle - \u87a2\u5e55\u6392\u7248</li> <li>Xnip - \u622a\u5716\u8edf\u9ad4</li> </ul>"},{"location":"snippets/mac-setup/#setting","title":"Setting","text":"<ul> <li>Touchpad<ul> <li>\u9ede\u4e00\u4e0b\u4f86\u9078\u6309</li> </ul> </li> <li>Sharing<ul> <li>Computer name</li> </ul> </li> <li>\u8f14\u52a9\u4f7f\u7528<ul> <li>Touchpad</li> <li>touchpad option &gt; \u62d6\u79fb &gt; \u4e09\u6307\u62d6\u79fb</li> </ul> </li> <li>Keyboard<ul> <li>\u6309\u9375\u91cd\u8907 &gt; \u5feb</li> <li>\u91cd\u8907\u524d\u66ab\u5ef6 &gt; \u77ed</li> <li>\u4f7f\u7528 F1, F2</li> </ul> </li> <li>\u6307\u63ee\u4e2d\u5fc3<ul> <li>\u6839\u64da\u6700\u8fd1\u7684\u4f7f\u7528\u60c5\u6cc1\u91cd\u65b0\u6392\u5217\u7a7a\u9593 &gt; uncheck</li> </ul> </li> </ul>"},{"location":"snippets/make/","title":"Make","text":""},{"location":"snippets/make/#target","title":"\u4f7f\u7528\u53e6\u4e00\u500b target","text":"<pre><code>start:\n    echo this is start\nuse-start:\n    echo this is use-start\n    $(MAKE) start\n</code></pre>"},{"location":"snippets/make/#target-target","title":"target \u4f9d\u8cf4\u53e6\u4e00\u500b target","text":"<pre><code>install: \n    pip install -r requirements.txt\nstart: install\n    mkdocs serve\n</code></pre>"},{"location":"snippets/make/#reference","title":"Reference","text":"<ul> <li>https://devhints.io/makefile</li> </ul>"},{"location":"snippets/mongo/","title":"Mongo","text":""},{"location":"snippets/mongo/#cluster-setup","title":"Cluster setup","text":"<pre><code>rs.initiate(\n  {\n    _id: \"&lt;replSetName&gt;\",\n    configsvr: true,\n    members: [\n      { _id : 0, host : \"cfg1.example.net:27019\" },\n      { _id : 1, host : \"cfg2.example.net:27019\", priority : 0.5 },\n      { _id : 2, host : \"cfg3.example.net:27019\", priority : 0.5 }\n    ]\n  }\n)\n\nrs.initiate(\n  {\n    _id: \"configReplSet\",\n    configsvr: true,\n    members: [\n      { _id : 0, host : \"mongo-configsvr-0.mongo-configsvr:27019\" },\n      { _id : 1, host : \"mongo-configsvr-1.mongo-configsvr:27019\", priority : 0.5  },\n      { _id : 2, host : \"mongo-configsvr-2.mongo-configsvr:27019\", priority : 0.5  }\n    ]\n  }\n)\n\nrs.initiate(\n  {\n    _id: \"rs0\",\n    members: [\n      { _id : 0, host : \"mongo-sh0-0.mongo-sh0:27017\" },\n      { _id : 1, host : \"mongo-sh0-1.mongo-sh0:27017\", priority : 0.5 },\n      { _id : 2, host : \"mongo-sh0-2.mongo-sh0:27017\", priority : 0.5 }\n    ]\n  }\n)\n\nsh.addShard( \"&lt;replSetName&gt;/s1-mongo1.example.net:27017\")\n\nsh.addShard( \"rs0/mongo-sh0-0.mongo-sh0:27017\")\n</code></pre> <pre><code>rs.initiate()\n\nrs.status()\nrs.isMaster()\nrs.config()\nsh.status()\n\nrs.reconfig(rs.config(),{force:true})\nmongo --port 27019 --eval \"rs.reconfig(rs.config(),{force:true})\"\n</code></pre>"},{"location":"snippets/mongo/#config","title":"Config","text":"<pre><code>db.getMongo().setReadPref('secondaryPreferred')\n</code></pre>"},{"location":"snippets/mongo/#auth","title":"Auth","text":"<pre><code>mongo admin -u root -p 'password123' --authenticationDatabase admin\nmongo localhost/rammus -u rammus -p 'rammus1234' --authenticationDatabase admin\n\nmongo localhost/rammus\ndb.auth('rammus','rammus1234')\n</code></pre>"},{"location":"snippets/mongo/#usage","title":"Usage","text":"<pre><code>use myNewDatabase\ndb.myCollection.insertOne( { x: 1 } )\ndb.myCollection.find()\n</code></pre> <p>Connection pools <pre><code>db.serverStatus().connections\ndb.currentOp(true)\ndb.runCommand( { \"connPoolStats\" : 1 } )\n</code></pre></p> <p>Index <pre><code>db.demo.createIndex({name:1})\ndb.demo.createIndex({name:1},{background:true})\n\ndb.demo.dropIndex({name:1})\n\ndb.demo.getIndexes()\n</code></pre></p> <p>Array <pre><code>db.getCollection('feat.rammus').insertOne(\n    {name:\"rammus\"}\n)\ndb.getCollection('feat.rammus').update(\n    {name:\"rammus\"},\n    {\n        $addToSet: {tags: { $each : [\"ban\",\"hid\",\"3\"]}}\n    }\n)\ndb.getCollection('feat.rammus').update(\n    {name:\"rammus\"},\n    {\n        $pull: {tags: { $in : [\"ban\",\"3\"]}}\n    }\n)\n</code></pre></p> <p>Find <pre><code>db.getCollection('feat.rammus').find(\n    { tags: /cover/i }\n)\n</code></pre></p> <p>Log <pre><code>db.getCollection('oplog.rs').find({}).sort({$natural: -1})\n</code></pre></p> <p>Test <pre><code>while true; do kubectl exec -it mongo-mongos-0 -- mongo mongo-mongos:27017/rammus --eval \"db.serverStatus().connections;\" ; done;\n\n\nwhile true; do\n  kubectl exec -it mongo-sh0-0 -- mongo mongo-sh0-0.mongo-sh0:27017/rammus --eval \"db.serverStatus().connections;\"\n  kubectl exec -it mongo-sh0-0 -- mongo mongo-sh0-1.mongo-sh0:27017/rammus --eval \"db.serverStatus().connections;\"\n  kubectl exec -it mongo-sh0-0 -- mongo mongo-sh0-2.mongo-sh0:27017/rammus --eval \"db.serverStatus().connections;\"\ndone;\n\nkubectl exec -it mongo-mongos-0 -- mongo --eval \"db.serverStatus().connections;\"\nkubectl exec -it mongo-mongos-1 -- mongo --eval \"db.serverStatus().connections;\"\nkubectl exec -it mongo-mongos-2 -- mongo --eval \"db.serverStatus().connections;\"\n</code></pre></p> <pre><code>mongo --eval \"db.adminCommand('ping')\" localhost:27017\n</code></pre> <p>Stats <pre><code>db.serverStatus()\ndb.stats()\n\nsh.status()\nrs.status()\ndb.runCommand( \"isMaster\" )\n</code></pre></p>"},{"location":"snippets/mongo/#troubleshooting","title":"Troubleshooting","text":"<p>current \u90fd\u662f\u4e00\u6a23\u7684</p> <p>mongos \u4e0d\u4e00\u5b9a\u9023\u5230\u9019\u500b replica\uff0c\u4e00\u500b replica set \u6709\u4e09\u500b node\uff0c\u6240\u4ee5\u4e09\u500b\u90fd\u8981\u6aa2\u67e5</p>"},{"location":"snippets/nginx/","title":"Nginx","text":"<p>Nginx \u5be6\u7528\u7b46\u8a18</p>"},{"location":"snippets/nginx/#commands","title":"Commands","text":"<pre><code>nginx -s reload\n</code></pre>"},{"location":"snippets/nginx/#proxy_cache","title":"proxy_cache","text":""},{"location":"snippets/nginx/#serve-static-files","title":"Serve static files","text":"<pre><code>location ~* \\.(jpg|png|css|js|js\\.map|svg|json)$ {\n    expires                         max;\n    add_header                      Cache-Control \"public\";\n}\n</code></pre>"},{"location":"snippets/nginx/#upstream-hash","title":"upstream hash","text":"<p>\u589e\u522a server \u6703\u91cd\u65b0\u7522\u751f hash\u3002 <pre><code>upstream proxy {\n  hash $scheme$host$request_uri consistent;\n\n  server                        cache-server-0.cache-server;\n  server                        cache-server-1.cache-server;\n}\n</code></pre></p>"},{"location":"snippets/nginx/#cache-loader-process","title":"cache loader process","text":"<pre><code>/ # ps\nPID   USER     TIME  COMMAND\n    1 root      0:00 {openresty} nginx: master process /usr/local/openresty/bin/openresty -g daemon off;\n    7 nobody    0:00 {openresty} nginx: worker process\n    8 nobody    0:00 {openresty} nginx: worker process\n    9 nobody    0:00 {openresty} nginx: cache manager process\n   10 nobody    0:00 {openresty} nginx: cache loader process\n</code></pre>"},{"location":"snippets/nginx/#special-cases","title":"Special Cases","text":""},{"location":"snippets/nginx/#proxy_pass-to-a-static-direction-path","title":"proxy_pass to a static direction (path)","text":"<p>\"proxy_pass\" cannot have URI part in location given by regular expression</p> <pre><code>location /go404 {\n    rewrite ^ /404$1 break;\n    proxy_pass http://bk$uri;\n}\n</code></pre>"},{"location":"snippets/nginx/#append-a-querystring-to-redirection","title":"Append a querystring to redirection","text":"<p>If a replacement string includes the new request arguments, the previous request arguments are appended after them</p> <pre><code>rewrite ^ http://test.example.com$uri?test=1 permanent;\n</code></pre>"},{"location":"snippets/nginx/#reference","title":"Reference","text":"<ul> <li>\u5e38\u7528\u7684 linux \u6307\u4ee4\u96c6\u8207\u7bc4\u4f8b - https://www.nginx.com/blog/rate-limiting-nginx/</li> </ul>"},{"location":"snippets/visual-studio/","title":"Visual Studio","text":""},{"location":"snippets/visual-studio/#python-env","title":"Python env","text":"<p>https://code.visualstudio.com/docs/python/environments <pre><code>python3 -m venv .venv\nvirtualenv .venv\n</code></pre></p> <p>Note</p> <p>Command + Shift + P -&gt; Python: Select Interpreter Command + Shift + P -&gt; Python: Enable Linting Command + Shift + P -&gt; Python: Select Linter</p> <p> </p>"},{"location":"snippets/visual-studio/#settingsjson","title":"settings.json","text":"<pre><code>    \"[python]\": {\n        \"editor.insertSpaces\": true,\n        \"editor.tabSize\": 4,\n        \"editor.formatOnSave\": true\n    },\n    \"[yaml]\": {\n        \"editor.defaultFormatter\": \"redhat.vscode-yaml\",\n        \"editor.formatOnSave\": true\n    },\n</code></pre>"},{"location":"snippets/visual-studio/#extensionsplugins","title":"Extensions(Plugins)","text":""},{"location":"snippets/visual-studio/#yaml","title":"YAML","text":"<p>https://marketplace.visualstudio.com/items?itemName=redhat.vscode-yaml</p> <p>Command+Shift+P: Preferences: Open User Settings(JSON) <pre><code>    \"[yaml]\": {\n        \"editor.defaultFormatter\": \"redhat.vscode-yaml\",\n        \"editor.formatOnSave\": true\n    },\n</code></pre></p>"}]}