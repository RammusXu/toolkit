
What I learned in 2022.


## 2022-04-26
### Google Sheet - Insert image from Google Drive
1. share image to `Everyone`
2. Get link: https://drive.google.com/file/d/1uw0e0ifHq2ibLIAFw8HH7RPKGe-u7i5x/view?usp=sharing
3. Use url in these ways:
   a. https://lh6.googleusercontent.com/d/1uw0e0ifHq2ibLIAFw8HH7RPKGe-u7i5x
   b. https://drive.google.com/thumbnail?id=1uw0e0ifHq2ibLIAFw8HH7RPKGe-u7i5x

## 2022-03-29
### ElasticSearch - Kibana can't compatible with downstair versions.

```
wget https://artifacts.elastic.co/downloads/kibana/kibana-7.16.3-x86_64.rpm
yum localinstall -y kibana-7.16.3-x86_64.rpm

{"type":"log","@timestamp":"2022-03-29T07:53:52+00:00","tags":["error","elasticsearch-service"],"pid":10677,"message":"This version of Kibana (v7.16.3) is incompatible with the following Elasticsearch nodes inyour cluster:v7.9.3 @ 10.16.41.65:9200 (10.16.41.65), v7.9.3 @ 10.16.41.126:9200 (10.16.41.126) ...}
```

### Kibana - Install in yum
```
wget https://artifacts.elastic.co/downloads/kibana/kibana-7.16.3-x86_64.rpm
yum localinstall -y kibana-7.16.3-x86_64.rpm
```

## 2022-03-15
### ElasticSearch - cluster full restart needs .security-7 index shard

- master might store auth data in memory
  - when masters shutdown, they will need data node contains .security-7 index shard

```
xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.keystore.path: elastic-certificates.p12
xpack.security.transport.ssl.truststore.path: elastic-certificates.p12
```

## 2022-03-11
### ElasticSearch - Change mapping fail, cannot be changed from type [text] to [keyword]

```
"mapper [message] cannot be changed from type [text] to [keyword]"
```

solution:

1. Create new index with new mapping
``` bash
POST _reindex
{
  "source": {
    "index": "rammus-poc"
  },
  "dest": {
    "index": "rammus-poc-20220311"
  }
}
```

2. Use _reindex to migrate data
```bash
PUT rammus-poc-20220311
{
    "settings": {
        "index": {
            "routing": {
                "allocation": {
                    "total_shards_per_node": "1"
                }
            },
            "number_of_shards": "1",
            "priority": "500",
            "number_of_replicas": "1"
        }
    },
    "mappings": {
        "properties": {
          ...
        }
    }
}
```

## 2022-03-09
### awscli - disable ec2 termination protection

```
aws ec2 modify-instance-attribute --no-disable-api-termination --instance-id i-xxxxx --profile rammus-dev
```


## 2022-03-07
### ElasticSearch - update keystore password

```
echo "" | /usr/share/elasticsearch/bin/elasticsearch-keystore add -x -f "xpack.security.transport.ssl.keystore.secure_password"
echo "" | /usr/share/elasticsearch/bin/elasticsearch-keystore add -x -f "xpack.security.transport.ssl.truststore.secure_password"
echo "" | /usr/share/elasticsearch/bin/elasticsearch-keystore add -x -f "xpack.security.http.ssl.keystore.secure_password"
echo "" | /usr/share/elasticsearch/bin/elasticsearch-keystore add -x -f "xpack.security.http.ssl.truststore.secure_password"

```

### Teleport - for loop run command in multiple machines
```
for ip in 172.21.1.1 172.21.1.2 172.21.1.3
do
  tsh ssh ec2-user@${ip} sudo systemctl restart elasticsearch
done
```

### amazon linux - install and start docker

```
yum install docker

## Run docker daemon
systemctl start docker

## Add permission
newgrp docker
sudo usermod -aG docker ec2-user
```
