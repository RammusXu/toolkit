<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="It's Rammus Toolkit. A collection of snippets, examples and solutions."><meta name=author content="Rammus Xu"><link href=https://rammusxu.github.io/toolkit/Today-I-Learned/2021/ rel=canonical><link href=../2020/ rel=prev><link href=../2022/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.28"><title>2021 - Rammus Toolkit</title><link rel=stylesheet href=../../assets/stylesheets/main.6543a935.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-E7VTEXK0WQ"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-E7VTEXK0WQ",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-E7VTEXK0WQ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#2021-12-24 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Rammus Toolkit" class="md-header__button md-logo" aria-label="Rammus Toolkit" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16h-2v-1H8v1H6v-1H2v5h20v-5h-4v1m2-8h-3V6c0-1.1-.9-2-2-2H9c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v4h4v-2h2v2h8v-2h2v2h4v-4c0-1.1-.9-2-2-2m-5 0H9V6h6v2Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Rammus Toolkit </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 2021 </span> </div> </div> </div> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/RammusXu/toolkit title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Rammus Toolkit" class="md-nav__button md-logo" aria-label="Rammus Toolkit" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16h-2v-1H8v1H6v-1H2v5h20v-5h-4v1m2-8h-3V6c0-1.1-.9-2-2-2H9c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v4h4v-2h2v2h8v-2h2v2h4v-4c0-1.1-.9-2-2-2m-5 0H9V6h6v2Z"/></svg> </a> Rammus Toolkit </label> <div class=md-nav__source> <a href=https://github.com/RammusXu/toolkit title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> 👋 Welcome </span> </a> </li> <li class=md-nav__item> <a href=../../help/ class=md-nav__link> <span class=md-ellipsis> 🌈 Help </span> </a> </li> <li class=md-nav__item> <a href=../../writing-tools/ class=md-nav__link> <span class=md-ellipsis> 寫作工具 </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Today I Learned </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Today I Learned </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../2019/ class=md-nav__link> <span class=md-ellipsis> 2019 </span> </a> </li> <li class=md-nav__item> <a href=../2020/ class=md-nav__link> <span class=md-ellipsis> 2020 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 2021 </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 2021 </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#2021-12-24 class=md-nav__link> <span class=md-ellipsis> 2021-12-24 </span> </a> <nav class=md-nav aria-label=2021-12-24> <ul class=md-nav__list> <li class=md-nav__item> <a href=#helm-escape class=md-nav__link> <span class=md-ellipsis> Helm - escape {{ }} </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-12-15 class=md-nav__link> <span class=md-ellipsis> 2021-12-15 </span> </a> <nav class=md-nav aria-label=2021-12-15> <ul class=md-nav__list> <li class=md-nav__item> <a href=#git-clean-merged-local-branches class=md-nav__link> <span class=md-ellipsis> Git - Clean merged local branches </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-08-19 class=md-nav__link> <span class=md-ellipsis> 2021-08-19 </span> </a> <nav class=md-nav aria-label=2021-08-19> <ul class=md-nav__list> <li class=md-nav__item> <a href=#redis-benchmark class=md-nav__link> <span class=md-ellipsis> Redis - benchmark </span> </a> </li> <li class=md-nav__item> <a href=#redis-gui-tools-with-analysis class=md-nav__link> <span class=md-ellipsis> Redis - GUI tools with analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-06-15 class=md-nav__link> <span class=md-ellipsis> 2021-06-15 </span> </a> <nav class=md-nav aria-label=2021-06-15> <ul class=md-nav__list> <li class=md-nav__item> <a href=#git-dont-show-morecontinue class=md-nav__link> <span class=md-ellipsis> Git - don't show more/continue </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-05-06 class=md-nav__link> <span class=md-ellipsis> 2021-05-06 </span> </a> <nav class=md-nav aria-label=2021-05-06> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubernetes-upgrade-cert-manager-to-v131 class=md-nav__link> <span class=md-ellipsis> Kubernetes - Upgrade cert-manager to v1.3.1 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-04-29 class=md-nav__link> <span class=md-ellipsis> 2021-04-29 </span> </a> <nav class=md-nav aria-label=2021-04-29> <ul class=md-nav__list> <li class=md-nav__item> <a href=#redis-cluster-failover class=md-nav__link> <span class=md-ellipsis> Redis - Cluster failover </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-04-15 class=md-nav__link> <span class=md-ellipsis> 2021-04-15 </span> </a> <nav class=md-nav aria-label=2021-04-15> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mongo-sharding-not-enabled-for-db class=md-nav__link> <span class=md-ellipsis> Mongo - sharding not enabled for db </span> </a> </li> <li class=md-nav__item> <a href=#mongo-update-on-a-sharded-collection-must-either-contain-an-exact-match-on-_id-or-must-target-a-single-shard class=md-nav__link> <span class=md-ellipsis> Mongo - update on a sharded collection must either contain an exact match on _id or must target a single shard </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-04-14 class=md-nav__link> <span class=md-ellipsis> 2021-04-14 </span> </a> <nav class=md-nav aria-label=2021-04-14> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mongo-transaction class=md-nav__link> <span class=md-ellipsis> Mongo - transaction </span> </a> </li> <li class=md-nav__item> <a href=#gke-neg-get-502-when-rollingupate class=md-nav__link> <span class=md-ellipsis> GKE - NEG get 502 when rollingUpate </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-04-13 class=md-nav__link> <span class=md-ellipsis> 2021-04-13 </span> </a> <nav class=md-nav aria-label=2021-04-13> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gsutil-download-large-file-with-crcmod-on-macos class=md-nav__link> <span class=md-ellipsis> gsutil - Download large file with crcmod on macOS </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-29 class=md-nav__link> <span class=md-ellipsis> 2021-03-29 </span> </a> <nav class=md-nav aria-label=2021-03-29> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubernetes-install-cert-manager-v120 class=md-nav__link> <span class=md-ellipsis> Kubernetes - Install cert-manager v1.2.0 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-25 class=md-nav__link> <span class=md-ellipsis> 2021-03-25 </span> </a> <nav class=md-nav aria-label=2021-03-25> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-cant-resolve-host-on-build-time class=md-nav__link> <span class=md-ellipsis> docker - Can't resolve host on build time </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-24 class=md-nav__link> <span class=md-ellipsis> 2021-03-24 </span> </a> <nav class=md-nav aria-label=2021-03-24> <ul class=md-nav__list> <li class=md-nav__item> <a href=#linkerd-vs-istio-on-2019 class=md-nav__link> <span class=md-ellipsis> Linkerd vs Istio on 2019 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-18 class=md-nav__link> <span class=md-ellipsis> 2021-03-18 </span> </a> <nav class=md-nav aria-label=2021-03-18> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tcp-3-way-handshake class=md-nav__link> <span class=md-ellipsis> 為什麼 TCP 要 3-way handshake </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-15 class=md-nav__link> <span class=md-ellipsis> 2021-03-15 </span> </a> <nav class=md-nav aria-label=2021-03-15> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-run-different-platform-architecture-images-on-apple-m1-mini class=md-nav__link> <span class=md-ellipsis> Docker - Run different platform architecture images on Apple M1 mini </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-09 class=md-nav__link> <span class=md-ellipsis> 2021-03-09 </span> </a> <nav class=md-nav aria-label=2021-03-09> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubernetes-increase-metrics-server-resources-cpumemory class=md-nav__link> <span class=md-ellipsis> Kubernetes - Increase metrics-server resources (cpu/memory) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-02-23 class=md-nav__link> <span class=md-ellipsis> 2021-02-23 </span> </a> <nav class=md-nav aria-label=2021-02-23> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2021-client-side-real-user-monitoring-rum class=md-nav__link> <span class=md-ellipsis> 2021 Client Side Real User Monitoring (RUM) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-02-05 class=md-nav__link> <span class=md-ellipsis> 2021-02-05 </span> </a> <nav class=md-nav aria-label=2021-02-05> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubernetes-use-annotation-and-initcontainer-to-donwload-gcs-files class=md-nav__link> <span class=md-ellipsis> Kubernetes - Use annotation and initContainer to donwload GCS files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-01-26 class=md-nav__link> <span class=md-ellipsis> 2021-01-26 </span> </a> <nav class=md-nav aria-label=2021-01-26> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-build-a-userspace-wireguard-image class=md-nav__link> <span class=md-ellipsis> Docker - Build a userspace Wireguard image </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-01-25 class=md-nav__link> <span class=md-ellipsis> 2021-01-25 </span> </a> <nav class=md-nav aria-label=2021-01-25> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mongodb-get-wiredtiger-stats class=md-nav__link> <span class=md-ellipsis> MongoDB - Get wiredTiger stats </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-01-21 class=md-nav__link> <span class=md-ellipsis> 2021-01-21 </span> </a> <nav class=md-nav aria-label=2021-01-21> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mkdocs-material-lexers-code-block-supported-programming-languages class=md-nav__link> <span class=md-ellipsis> mkdocs-material lexers - code block supported programming languages </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-01-19 class=md-nav__link> <span class=md-ellipsis> 2021-01-19 </span> </a> <nav class=md-nav aria-label=2021-01-19> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ack-failed-to-provision-volume-with-storageclass-alicloud-disk-ssd-rpc-error-code-internal-desc-sdkservererror class=md-nav__link> <span class=md-ellipsis> ACK - failed to provision volume with StorageClass "alicloud-disk-ssd": rpc error: code = Internal desc = SDK.ServerError </span> </a> </li> <li class=md-nav__item> <a href=#nginx-use-nfs-to-share-proxy_cache class=md-nav__link> <span class=md-ellipsis> Nginx - Use NFS to share proxy_cache </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-01-08 class=md-nav__link> <span class=md-ellipsis> 2021-01-08 </span> </a> <nav class=md-nav aria-label=2021-01-08> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gsutil-upload-file-to-aws-s3 class=md-nav__link> <span class=md-ellipsis> gsutil - Upload file to AWS S3 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../2022/ class=md-nav__link> <span class=md-ellipsis> 2022 </span> </a> </li> <li class=md-nav__item> <a href=../2023/ class=md-nav__link> <span class=md-ellipsis> 2023 </span> </a> </li> <li class=md-nav__item> <a href=../2024/ class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> Snippets </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Snippets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../snippets/alpine-linux/ class=md-nav__link> <span class=md-ellipsis> Alpine linux </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/aws/ class=md-nav__link> <span class=md-ellipsis> AWS </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/bash/ class=md-nav__link> <span class=md-ellipsis> Bash </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/docker-compose/ class=md-nav__link> <span class=md-ellipsis> Docker Compose </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/docker/ class=md-nav__link> <span class=md-ellipsis> Docker </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/dockerfiles/ class=md-nav__link> <span class=md-ellipsis> Dockerfiles </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/elasticsearch/ class=md-nav__link> <span class=md-ellipsis> Elasticsearch </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/fun-markdown/ class=md-nav__link> <span class=md-ellipsis> Fun markdown </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/gcp/ class=md-nav__link> <span class=md-ellipsis> GCP </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/git/ class=md-nav__link> <span class=md-ellipsis> Git </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/github-action/ class=md-nav__link> <span class=md-ellipsis> Github Action </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/gitlabci/ class=md-nav__link> <span class=md-ellipsis> Gitlab CI </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/http/ class=md-nav__link> <span class=md-ellipsis> http </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/jenkins/ class=md-nav__link> <span class=md-ellipsis> Jenkins </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/linux/ class=md-nav__link> <span class=md-ellipsis> Linux commands </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/lua/ class=md-nav__link> <span class=md-ellipsis> Lua </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/mac-setup/ class=md-nav__link> <span class=md-ellipsis> Mac Setup </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/make/ class=md-nav__link> <span class=md-ellipsis> Make </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/mongo/ class=md-nav__link> <span class=md-ellipsis> Mongo </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/nginx/ class=md-nav__link> <span class=md-ellipsis> Nginx </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/prometheus/ class=md-nav__link> <span class=md-ellipsis> Prometheus </span> </a> </li> <li class=md-nav__item> <a href=../../snippets/visual-studio/ class=md-nav__link> <span class=md-ellipsis> Visual Studio </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#2021-12-24 class=md-nav__link> <span class=md-ellipsis> 2021-12-24 </span> </a> <nav class=md-nav aria-label=2021-12-24> <ul class=md-nav__list> <li class=md-nav__item> <a href=#helm-escape class=md-nav__link> <span class=md-ellipsis> Helm - escape {{ }} </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-12-15 class=md-nav__link> <span class=md-ellipsis> 2021-12-15 </span> </a> <nav class=md-nav aria-label=2021-12-15> <ul class=md-nav__list> <li class=md-nav__item> <a href=#git-clean-merged-local-branches class=md-nav__link> <span class=md-ellipsis> Git - Clean merged local branches </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-08-19 class=md-nav__link> <span class=md-ellipsis> 2021-08-19 </span> </a> <nav class=md-nav aria-label=2021-08-19> <ul class=md-nav__list> <li class=md-nav__item> <a href=#redis-benchmark class=md-nav__link> <span class=md-ellipsis> Redis - benchmark </span> </a> </li> <li class=md-nav__item> <a href=#redis-gui-tools-with-analysis class=md-nav__link> <span class=md-ellipsis> Redis - GUI tools with analysis </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-06-15 class=md-nav__link> <span class=md-ellipsis> 2021-06-15 </span> </a> <nav class=md-nav aria-label=2021-06-15> <ul class=md-nav__list> <li class=md-nav__item> <a href=#git-dont-show-morecontinue class=md-nav__link> <span class=md-ellipsis> Git - don't show more/continue </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-05-06 class=md-nav__link> <span class=md-ellipsis> 2021-05-06 </span> </a> <nav class=md-nav aria-label=2021-05-06> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubernetes-upgrade-cert-manager-to-v131 class=md-nav__link> <span class=md-ellipsis> Kubernetes - Upgrade cert-manager to v1.3.1 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-04-29 class=md-nav__link> <span class=md-ellipsis> 2021-04-29 </span> </a> <nav class=md-nav aria-label=2021-04-29> <ul class=md-nav__list> <li class=md-nav__item> <a href=#redis-cluster-failover class=md-nav__link> <span class=md-ellipsis> Redis - Cluster failover </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-04-15 class=md-nav__link> <span class=md-ellipsis> 2021-04-15 </span> </a> <nav class=md-nav aria-label=2021-04-15> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mongo-sharding-not-enabled-for-db class=md-nav__link> <span class=md-ellipsis> Mongo - sharding not enabled for db </span> </a> </li> <li class=md-nav__item> <a href=#mongo-update-on-a-sharded-collection-must-either-contain-an-exact-match-on-_id-or-must-target-a-single-shard class=md-nav__link> <span class=md-ellipsis> Mongo - update on a sharded collection must either contain an exact match on _id or must target a single shard </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-04-14 class=md-nav__link> <span class=md-ellipsis> 2021-04-14 </span> </a> <nav class=md-nav aria-label=2021-04-14> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mongo-transaction class=md-nav__link> <span class=md-ellipsis> Mongo - transaction </span> </a> </li> <li class=md-nav__item> <a href=#gke-neg-get-502-when-rollingupate class=md-nav__link> <span class=md-ellipsis> GKE - NEG get 502 when rollingUpate </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-04-13 class=md-nav__link> <span class=md-ellipsis> 2021-04-13 </span> </a> <nav class=md-nav aria-label=2021-04-13> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gsutil-download-large-file-with-crcmod-on-macos class=md-nav__link> <span class=md-ellipsis> gsutil - Download large file with crcmod on macOS </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-29 class=md-nav__link> <span class=md-ellipsis> 2021-03-29 </span> </a> <nav class=md-nav aria-label=2021-03-29> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubernetes-install-cert-manager-v120 class=md-nav__link> <span class=md-ellipsis> Kubernetes - Install cert-manager v1.2.0 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-25 class=md-nav__link> <span class=md-ellipsis> 2021-03-25 </span> </a> <nav class=md-nav aria-label=2021-03-25> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-cant-resolve-host-on-build-time class=md-nav__link> <span class=md-ellipsis> docker - Can't resolve host on build time </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-24 class=md-nav__link> <span class=md-ellipsis> 2021-03-24 </span> </a> <nav class=md-nav aria-label=2021-03-24> <ul class=md-nav__list> <li class=md-nav__item> <a href=#linkerd-vs-istio-on-2019 class=md-nav__link> <span class=md-ellipsis> Linkerd vs Istio on 2019 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-18 class=md-nav__link> <span class=md-ellipsis> 2021-03-18 </span> </a> <nav class=md-nav aria-label=2021-03-18> <ul class=md-nav__list> <li class=md-nav__item> <a href=#tcp-3-way-handshake class=md-nav__link> <span class=md-ellipsis> 為什麼 TCP 要 3-way handshake </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-15 class=md-nav__link> <span class=md-ellipsis> 2021-03-15 </span> </a> <nav class=md-nav aria-label=2021-03-15> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-run-different-platform-architecture-images-on-apple-m1-mini class=md-nav__link> <span class=md-ellipsis> Docker - Run different platform architecture images on Apple M1 mini </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-03-09 class=md-nav__link> <span class=md-ellipsis> 2021-03-09 </span> </a> <nav class=md-nav aria-label=2021-03-09> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubernetes-increase-metrics-server-resources-cpumemory class=md-nav__link> <span class=md-ellipsis> Kubernetes - Increase metrics-server resources (cpu/memory) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-02-23 class=md-nav__link> <span class=md-ellipsis> 2021-02-23 </span> </a> <nav class=md-nav aria-label=2021-02-23> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2021-client-side-real-user-monitoring-rum class=md-nav__link> <span class=md-ellipsis> 2021 Client Side Real User Monitoring (RUM) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-02-05 class=md-nav__link> <span class=md-ellipsis> 2021-02-05 </span> </a> <nav class=md-nav aria-label=2021-02-05> <ul class=md-nav__list> <li class=md-nav__item> <a href=#kubernetes-use-annotation-and-initcontainer-to-donwload-gcs-files class=md-nav__link> <span class=md-ellipsis> Kubernetes - Use annotation and initContainer to donwload GCS files </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-01-26 class=md-nav__link> <span class=md-ellipsis> 2021-01-26 </span> </a> <nav class=md-nav aria-label=2021-01-26> <ul class=md-nav__list> <li class=md-nav__item> <a href=#docker-build-a-userspace-wireguard-image class=md-nav__link> <span class=md-ellipsis> Docker - Build a userspace Wireguard image </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-01-25 class=md-nav__link> <span class=md-ellipsis> 2021-01-25 </span> </a> <nav class=md-nav aria-label=2021-01-25> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mongodb-get-wiredtiger-stats class=md-nav__link> <span class=md-ellipsis> MongoDB - Get wiredTiger stats </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-01-21 class=md-nav__link> <span class=md-ellipsis> 2021-01-21 </span> </a> <nav class=md-nav aria-label=2021-01-21> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mkdocs-material-lexers-code-block-supported-programming-languages class=md-nav__link> <span class=md-ellipsis> mkdocs-material lexers - code block supported programming languages </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-01-19 class=md-nav__link> <span class=md-ellipsis> 2021-01-19 </span> </a> <nav class=md-nav aria-label=2021-01-19> <ul class=md-nav__list> <li class=md-nav__item> <a href=#ack-failed-to-provision-volume-with-storageclass-alicloud-disk-ssd-rpc-error-code-internal-desc-sdkservererror class=md-nav__link> <span class=md-ellipsis> ACK - failed to provision volume with StorageClass "alicloud-disk-ssd": rpc error: code = Internal desc = SDK.ServerError </span> </a> </li> <li class=md-nav__item> <a href=#nginx-use-nfs-to-share-proxy_cache class=md-nav__link> <span class=md-ellipsis> Nginx - Use NFS to share proxy_cache </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2021-01-08 class=md-nav__link> <span class=md-ellipsis> 2021-01-08 </span> </a> <nav class=md-nav aria-label=2021-01-08> <ul class=md-nav__list> <li class=md-nav__item> <a href=#gsutil-upload-file-to-aws-s3 class=md-nav__link> <span class=md-ellipsis> gsutil - Upload file to AWS S3 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>2021</h1> <p>What I learned in 2021.</p> <h2 id=2021-12-24>2021-12-24<a class=headerlink href=#2021-12-24 title="Permanent link">&para;</a></h2> <h3 id=helm-escape>Helm - escape {{ }}<a class=headerlink href=#helm-escape title="Permanent link">&para;</a></h3> <p>ref: <a href=https://github.com/helm/helm/issues/2798#issuecomment-890478869>https://github.com/helm/helm/issues/2798#issuecomment-890478869</a></p> <div class=highlight><pre><span></span><code>      labels:
        sink_name: loki_syslog
        #Below key useed printf() to escape Helm interprets {{ }}
        message: &gt;-
          {{ printf &quot;{{ message }}&quot; }}
</code></pre></div> <h2 id=2021-12-15>2021-12-15<a class=headerlink href=#2021-12-15 title="Permanent link">&para;</a></h2> <h3 id=git-clean-merged-local-branches>Git - Clean merged local branches<a class=headerlink href=#git-clean-merged-local-branches title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>git branch --merged | egrep -v &quot;(^\*|master)&quot; | xargs git branch -d
</code></pre></div> <h2 id=2021-08-19>2021-08-19<a class=headerlink href=#2021-08-19 title="Permanent link">&para;</a></h2> <h3 id=redis-benchmark>Redis - benchmark<a class=headerlink href=#redis-benchmark title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>&lt; 1 KB , 200k rps, 2ms
&gt; 65 KB, &lt; 100k rps, 4ms
reclaim: Is TTL setted.
aws redis node: 65k connections limited
</code></pre></div> <h3 id=redis-gui-tools-with-analysis>Redis - GUI tools with analysis<a class=headerlink href=#redis-gui-tools-with-analysis title="Permanent link">&para;</a></h3> <p><a href=https://redis.com/redis-enterprise/redis-insight/ >https://redis.com/redis-enterprise/redis-insight/</a></p> <h2 id=2021-06-15>2021-06-15<a class=headerlink href=#2021-06-15 title="Permanent link">&para;</a></h2> <h3 id=git-dont-show-morecontinue>Git - don't show more/continue<a class=headerlink href=#git-dont-show-morecontinue title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>git<span class=w> </span>config<span class=w> </span>--global<span class=w> </span>pager.log<span class=w> </span><span class=nb>false</span>
</code></pre></div> <h2 id=2021-05-06>2021-05-06<a class=headerlink href=#2021-05-06 title="Permanent link">&para;</a></h2> <h3 id=kubernetes-upgrade-cert-manager-to-v131>Kubernetes - Upgrade cert-manager to v1.3.1<a class=headerlink href=#kubernetes-upgrade-cert-manager-to-v131 title="Permanent link">&para;</a></h3> <p>Check exited CRD resources.</p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>get<span class=w> </span>Issuers,ClusterIssuers,Certificates,CertificateRequests,Orders,Challenges<span class=w> </span>--all-namespaces
</code></pre></div> <p>Backup resources.</p> <div class=highlight><pre><span></span><code>kubectl get -o yaml \
     --all-namespaces \
     issuer,clusterissuer,certificates &gt; cert-manager-backup.yaml
</code></pre></div> <p>Use Helm to deploy <code>cert-manager:v1.3.1</code> <div class=highlight><pre><span></span><code>helm install \
  cert-manager jetstack/cert-manager \
  --namespace cert-manager \
  --create-namespace \
  --version v1.3.1 \
  --set installCRDs=true
</code></pre></div></p> <h2 id=2021-04-29>2021-04-29<a class=headerlink href=#2021-04-29 title="Permanent link">&para;</a></h2> <h3 id=redis-cluster-failover>Redis - Cluster failover<a class=headerlink href=#redis-cluster-failover title="Permanent link">&para;</a></h3> <p>3 master down -&gt; cluster shutdown, can't failover to replicas -&gt; when 2 master back, still not back -&gt; need all 3 master back and re-sync</p> <p>1 master + 1 replica down -&gt; cluster shutdown -&gt; 1 master back, still not back</p> <p>2 master down -&gt; cluster shutdown -&gt; 1 master back, still not back</p> <p>conclusion:</p> <ul> <li>If cluster turns down, need all nodes re-sync to get it back.</li> <li>over 1/2 master down at same time will cause cluster down</li> <li>1 shard down will cause cluster down</li> </ul> <h2 id=2021-04-15>2021-04-15<a class=headerlink href=#2021-04-15 title="Permanent link">&para;</a></h2> <h3 id=mongo-sharding-not-enabled-for-db>Mongo - sharding not enabled for db<a class=headerlink href=#mongo-sharding-not-enabled-for-db title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>sh.enableSharding<span class=o>(</span><span class=s2>&quot;mydatabase&quot;</span><span class=o>)</span>
</code></pre></div> <h3 id=mongo-update-on-a-sharded-collection-must-either-contain-an-exact-match-on-_id-or-must-target-a-single-shard>Mongo - update on a sharded collection must either contain an exact match on _id or must target a single shard<a class=headerlink href=#mongo-update-on-a-sharded-collection-must-either-contain-an-exact-match-on-_id-or-must-target-a-single-shard title="Permanent link">&para;</a></h3> <blockquote> <p>A {multi:false} update on a sharded collection must either contain an exact match on _id or must target a single shard but this update targeted _id (and have the collection default collation) or must target a single shard (and have the simple collation), but this update targeted 2 shards. Update request: { q: { nb: 0 }, u: { $set: { date: new Date(1618511355253), c32: 13, c64: 10818 } }, multi: false, upsert: false }, shard key pattern: { c32: 1.0, c64: 1.0 }, full error: {'index': 0, 'code': 72, 'codeName': 'InvalidOptions', 'errmsg': 'A {multi:false} update on a sharded collection must either contain an exact match on _id or must target a single shard but this update targeted _id (and have the collection default collation) or must target a single shard (and have the simple collation), but this update targeted 2 shards. Update request: { q: { nb: 0 }, u: { $set: { date: new Date(1618511355253), c32: 13, c64: 10818 } }, multi: false, upsert: false }, shard key pattern: { c32: 1.0, c64: 1.0 }'}</p> </blockquote> <p>New document <em>must</em> contains shard key fields. In this case is <code>c32, c64</code>.</p> <h2 id=2021-04-14>2021-04-14<a class=headerlink href=#2021-04-14 title="Permanent link">&para;</a></h2> <h3 id=mongo-transaction>Mongo - transaction<a class=headerlink href=#mongo-transaction title="Permanent link">&para;</a></h3> <p><img alt src=../img/2021-04-14-mongo-transaction.png></p> <h3 id=gke-neg-get-502-when-rollingupate>GKE - NEG get 502 when rollingUpate<a class=headerlink href=#gke-neg-get-502-when-rollingupate title="Permanent link">&para;</a></h3> <p>credit:</p> <ul> <li><a href=https://cloud.google.com/kubernetes-engine/docs/how-to/standalone-neg#traffic_does_not_reach_the_endpoints>https://cloud.google.com/kubernetes-engine/docs/how-to/standalone-neg#traffic_does_not_reach_the_endpoints</a></li> <li><a href=https://pracucci.com/graceful-shutdown-of-kubernetes-pods.html>https://pracucci.com/graceful-shutdown-of-kubernetes-pods.html</a></li> </ul> <div class=highlight><pre><span></span><code>        lifecycle:
          preStop:
            exec:
              # SIGTERM triggers a quick exit; gracefully terminate instead
              command: [&quot;nginx&quot;, &quot;-s&quot;, &quot;quit&quot;]
</code></pre></div> <h2 id=2021-04-13>2021-04-13<a class=headerlink href=#2021-04-13 title="Permanent link">&para;</a></h2> <h3 id=gsutil-download-large-file-with-crcmod-on-macos>gsutil - Download large file with crcmod on macOS<a class=headerlink href=#gsutil-download-large-file-with-crcmod-on-macos title="Permanent link">&para;</a></h3> <blockquote> <p><code>pip3 install -U crcmod</code></p> </blockquote> <p>Before:</p> <div class=highlight><pre><span></span><code><span class=c1># gsutil version -l</span>
gsutil<span class=w> </span>version:<span class=w> </span><span class=m>4</span>.55
checksum:<span class=w> </span>adebf7d276641651e3345d12aca978c0<span class=w> </span><span class=o>(</span>OK<span class=o>)</span>
boto<span class=w> </span>version:<span class=w> </span><span class=m>2</span>.49.0
python<span class=w> </span>version:<span class=w> </span><span class=m>3</span>.9.4<span class=w> </span><span class=o>(</span>default,<span class=w> </span>Apr<span class=w>  </span><span class=m>5</span><span class=w> </span><span class=m>2021</span>,<span class=w> </span><span class=m>01</span>:47:16<span class=o>)</span><span class=w> </span><span class=o>[</span>Clang<span class=w> </span><span class=m>11</span>.0.0<span class=w> </span><span class=o>(</span>clang-1100.0.33.17<span class=o>)]</span>
OS:<span class=w> </span>Darwin<span class=w> </span><span class=m>18</span>.7.0
multiprocessing<span class=w> </span>available:<span class=w> </span>True
using<span class=w> </span>cloud<span class=w> </span>sdk:<span class=w> </span>True
pass<span class=w> </span>cloud<span class=w> </span>sdk<span class=w> </span>credentials<span class=w> </span>to<span class=w> </span>gsutil:<span class=w> </span>True
config<span class=w> </span>path<span class=o>(</span>s<span class=o>)</span>:<span class=w> </span>/Users/rammus/.boto,<span class=w> </span>/Users/rammus/.config/gcloud/legacy_credentials/rammus.xu@swag.live/.boto
gsutil<span class=w> </span>path:<span class=w> </span>/usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/bin/gsutil
<span class=hll>compiled<span class=w> </span>crcmod:<span class=w> </span>False
</span>installed<span class=w> </span>via<span class=w> </span>package<span class=w> </span>manager:<span class=w> </span>False
editable<span class=w> </span>install:<span class=w> </span>False
</code></pre></div> <p>After:</p> <div class=highlight><pre><span></span><code><span class=c1># gsutil version -l</span>
gsutil<span class=w> </span>version:<span class=w> </span><span class=m>4</span>.55
checksum:<span class=w> </span>adebf7d276641651e3345d12aca978c0<span class=w> </span><span class=o>(</span>OK<span class=o>)</span>
boto<span class=w> </span>version:<span class=w> </span><span class=m>2</span>.49.0
python<span class=w> </span>version:<span class=w> </span><span class=m>3</span>.9.4<span class=w> </span><span class=o>(</span>default,<span class=w> </span>Apr<span class=w>  </span><span class=m>5</span><span class=w> </span><span class=m>2021</span>,<span class=w> </span><span class=m>01</span>:47:16<span class=o>)</span><span class=w> </span><span class=o>[</span>Clang<span class=w> </span><span class=m>11</span>.0.0<span class=w> </span><span class=o>(</span>clang-1100.0.33.17<span class=o>)]</span>
OS:<span class=w> </span>Darwin<span class=w> </span><span class=m>18</span>.7.0
multiprocessing<span class=w> </span>available:<span class=w> </span>True
using<span class=w> </span>cloud<span class=w> </span>sdk:<span class=w> </span>True
pass<span class=w> </span>cloud<span class=w> </span>sdk<span class=w> </span>credentials<span class=w> </span>to<span class=w> </span>gsutil:<span class=w> </span>True
config<span class=w> </span>path<span class=o>(</span>s<span class=o>)</span>:<span class=w> </span>/Users/rammus/.boto,<span class=w> </span>/Users/rammus/.config/gcloud/legacy_credentials/rammus.xu@swag.live/.boto
gsutil<span class=w> </span>path:<span class=w> </span>/usr/local/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/bin/gsutil
<span class=hll>compiled<span class=w> </span>crcmod:<span class=w> </span>True
</span>installed<span class=w> </span>via<span class=w> </span>package<span class=w> </span>manager:<span class=w> </span>False
editable<span class=w> </span>install:<span class=w> </span>False
</code></pre></div> <h2 id=2021-03-29>2021-03-29<a class=headerlink href=#2021-03-29 title="Permanent link">&para;</a></h2> <h3 id=kubernetes-install-cert-manager-v120>Kubernetes - Install cert-manager v1.2.0<a class=headerlink href=#kubernetes-install-cert-manager-v120 title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>helm<span class=w> </span>repo<span class=w> </span>add<span class=w> </span>jetstack<span class=w> </span>https://charts.jetstack.io
helm<span class=w> </span>repo<span class=w> </span>update

helm<span class=w> </span>install<span class=w> </span><span class=se>\</span>
<span class=w>  </span>cert-manager<span class=w> </span>jetstack/cert-manager<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--namespace<span class=w> </span>cert-manager<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--version<span class=w> </span>v1.2.0<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--create-namespace<span class=w> </span><span class=se>\</span>
<span class=w>  </span>--set<span class=w> </span><span class=nv>installCRDs</span><span class=o>=</span><span class=nb>true</span>
</code></pre></div> <h2 id=2021-03-25>2021-03-25<a class=headerlink href=#2021-03-25 title="Permanent link">&para;</a></h2> <h3 id=docker-cant-resolve-host-on-build-time>docker - Can't resolve host on build time<a class=headerlink href=#docker-cant-resolve-host-on-build-time title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>Resolving github.com (github.com)... failed: Name does not resolve.
wget: unable to resolve host address &#39;github.com&#39;
</code></pre></div> <div class="admonition solution"> <p class=admonition-title>Solution</p> <p>Upgrade docker desktop to &gt; <a href=https://github.com/docker/for-mac/issues/5020#issuecomment-760298977>3.1.0</a></p> </div> <p>This happens on my Macbook Pro (<code>docker desktop: 2.5.0.1</code>).</p> <p>It's fixed after I upgrade to <code>3.2.2</code>.</p> <h2 id=2021-03-24>2021-03-24<a class=headerlink href=#2021-03-24 title="Permanent link">&para;</a></h2> <h3 id=linkerd-vs-istio-on-2019>Linkerd vs Istio on 2019<a class=headerlink href=#linkerd-vs-istio-on-2019 title="Permanent link">&para;</a></h3> <p><a href=https://medium.com/@michael_87395/benchmarking-istio-linkerd-cpu-c36287e32781>https://medium.com/@michael_87395/benchmarking-istio-linkerd-cpu-c36287e32781</a></p> <blockquote> <p>Istio’s Envoy proxy uses more than 50% more CPU than Linkerd’s</p> </blockquote> <ul> <li>k8s: 1.12.7-gke.7</li> <li>node: n1-standard-4</li> <li>4-16 nodes</li> <li>linkerd: 2.3.0 (now: 2.10)</li> <li>istio: 1.0.6 (now: 1.9.0)</li> </ul> <h2 id=2021-03-18>2021-03-18<a class=headerlink href=#2021-03-18 title="Permanent link">&para;</a></h2> <h3 id=tcp-3-way-handshake>為什麼 TCP 要 3-way handshake<a class=headerlink href=#tcp-3-way-handshake title="Permanent link">&para;</a></h3> <p><a href=https://draveness.me/whys-the-design-tcp-three-way-handshake/ >https://draveness.me/whys-the-design-tcp-three-way-handshake/</a></p> <ul> <li>TCP 是雙向對話 (bi-directional communication protocol)</li> <li>雙方都需要 SYN, ACK</li> </ul> <div class=highlight><pre><span></span><code>Client ------SYN-----&gt; Server
Client &lt;---ACK/SYN---- Server
Client ------ACK-----&gt; Server
</code></pre></div> <h2 id=2021-03-15>2021-03-15<a class=headerlink href=#2021-03-15 title="Permanent link">&para;</a></h2> <h3 id=docker-run-different-platform-architecture-images-on-apple-m1-mini>Docker - Run different platform architecture images on Apple M1 mini<a class=headerlink href=#docker-run-different-platform-architecture-images-on-apple-m1-mini title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code>rammus.xu@mac-mini<span class=w> </span>~<span class=w> </span>%<span class=w> </span>docker<span class=w> </span>run<span class=w> </span>-it<span class=w> </span>--rm<span class=w> </span>alpine<span class=w> </span>uname<span class=w> </span>-a
Linux<span class=w> </span>ffb2f47751c8<span class=w> </span><span class=m>4</span>.19.121-linuxkit<span class=w> </span><span class=c1>#1 SMP PREEMPT Thu Jan 21 15:45:22 UTC 2021 aarch64 Linux</span>
rammus.xu@mac-mini<span class=w> </span>~<span class=w> </span>%<span class=w> </span>docker<span class=w> </span>run<span class=w> </span>-it<span class=w> </span>--rm<span class=w> </span>--platform<span class=w> </span>amd64<span class=w> </span>alpine<span class=w> </span>uname<span class=w> </span>-a
Unable<span class=w> </span>to<span class=w> </span>find<span class=w> </span>image<span class=w> </span><span class=s1>&#39;alpine:latest&#39;</span><span class=w> </span>locally
latest:<span class=w> </span>Pulling<span class=w> </span>from<span class=w> </span>library/alpine
ba3557a56b15:<span class=w> </span>Pull<span class=w> </span><span class=nb>complete</span>
Digest:<span class=w> </span>sha256:a75afd8b57e7f34e4dad8d65e2c7ba2e1975c795ce1ee22fa34f8cf46f96a3be
Status:<span class=w> </span>Downloaded<span class=w> </span>newer<span class=w> </span>image<span class=w> </span><span class=k>for</span><span class=w> </span>alpine:latest
docker:<span class=w> </span>Error<span class=w> </span>response<span class=w> </span>from<span class=w> </span>daemon:<span class=w> </span>image<span class=w> </span>with<span class=w> </span>reference<span class=w> </span>alpine<span class=w> </span>was<span class=w> </span>found<span class=w> </span>but<span class=w> </span>does<span class=w> </span>not<span class=w> </span>match<span class=w> </span>the<span class=w> </span>specified<span class=w> </span>platform:<span class=w> </span>wanted<span class=w> </span>darwin/amd64,<span class=w> </span>actual:<span class=w> </span>linux/amd64.
See<span class=w> </span><span class=s1>&#39;docker run --help&#39;</span>.
rammus.xu@mac-mini<span class=w> </span>~<span class=w> </span>%<span class=w> </span>docker<span class=w> </span>run<span class=w> </span>-it<span class=w> </span>--rm<span class=w> </span>--platform<span class=w> </span>linux/amd64<span class=w> </span>alpine<span class=w> </span>uname<span class=w> </span>-a
Linux<span class=w> </span>f313db1d82a1<span class=w> </span><span class=m>4</span>.19.121-linuxkit<span class=w> </span><span class=c1>#1 SMP PREEMPT Thu Jan 21 15:45:22 UTC 2021 x86_64 Linux</span>
rammus.xu@mac-mini<span class=w> </span>~<span class=w> </span>%<span class=w> </span>docker<span class=w> </span>run<span class=w> </span>-it<span class=w> </span>--rm<span class=w> </span>--platform<span class=w> </span>linux/i386<span class=w> </span>alpine<span class=w> </span>uname<span class=w> </span>-a
Unable<span class=w> </span>to<span class=w> </span>find<span class=w> </span>image<span class=w> </span><span class=s1>&#39;alpine:latest&#39;</span><span class=w> </span>locally
latest:<span class=w> </span>Pulling<span class=w> </span>from<span class=w> </span>library/alpine
86205afa28f6:<span class=w> </span>Pull<span class=w> </span><span class=nb>complete</span>
Digest:<span class=w> </span>sha256:a75afd8b57e7f34e4dad8d65e2c7ba2e1975c795ce1ee22fa34f8cf46f96a3be
Status:<span class=w> </span>Downloaded<span class=w> </span>newer<span class=w> </span>image<span class=w> </span><span class=k>for</span><span class=w> </span>alpine:latest
Linux<span class=w> </span>4aff8fb39ae9<span class=w> </span><span class=m>4</span>.19.121-linuxkit<span class=w> </span><span class=c1>#1 SMP PREEMPT Thu Jan 21 15:45:22 UTC 2021 i686 Linux</span>
</code></pre></div> <h2 id=2021-03-09>2021-03-09<a class=headerlink href=#2021-03-09 title="Permanent link">&para;</a></h2> <h3 id=kubernetes-increase-metrics-server-resources-cpumemory>Kubernetes - Increase metrics-server resources (cpu/memory)<a class=headerlink href=#kubernetes-increase-metrics-server-resources-cpumemory title="Permanent link">&para;</a></h3> <blockquote> <p>Metrics not available for pod</p> </blockquote> <p>Ref: <a href=https://github.com/kubernetes/autoscaler/tree/master/addon-resizer>https://github.com/kubernetes/autoscaler/tree/master/addon-resizer</a></p> <p>Environment:</p> <ul> <li>Kubernetes: v1.17.15-gke.800</li> </ul> <p>It's 3-5 minutes downtime.</p> <div class=highlight><pre><span></span><code>&gt;<span class=w> </span>kubectl<span class=w> </span>apply<span class=w> </span>-f<span class=w> </span>metrics-server-config.yaml
</code></pre></div> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>    </span><span class=nt>addonmanager.kubernetes.io/mode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">EnsureExists</span>
<span class=w>    </span><span class=nt>kubernetes.io/cluster-service</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">metrics-server-config</span>
<span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
<span class=nt>data</span><span class=p>:</span>
<span class=w>  </span><span class=nt>NannyConfiguration</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|-</span>
<span class=w>    </span><span class=no>apiVersion: nannyconfig/v1alpha1</span>
<span class=w>    </span><span class=no>kind: NannyConfiguration</span>
<span class=w>    </span><span class=no>baseCPU: 200m</span>
<span class=w>    </span><span class=no>cpuPerNode: 2m</span>
<span class=w>    </span><span class=no>baseMemory: 150Mi</span>
<span class=w>    </span><span class=no>memoryPerNode: 4Mi</span>
</code></pre></div> <div class=highlight><pre><span></span><code>&gt;<span class=w> </span>kubectl<span class=w> </span>delete<span class=w> </span>deployment<span class=w> </span>-n<span class=w> </span>kube-system<span class=w> </span>metrics-server-v0.3.6
deployment.apps<span class=w> </span><span class=s2>&quot;metrics-server-v0.3.6&quot;</span><span class=w> </span>deleted
</code></pre></div> <h2 id=2021-02-23>2021-02-23<a class=headerlink href=#2021-02-23 title="Permanent link">&para;</a></h2> <h3 id=2021-client-side-real-user-monitoring-rum>2021 Client Side Real User Monitoring (RUM)<a class=headerlink href=#2021-client-side-real-user-monitoring-rum title="Permanent link">&para;</a></h3> <p>Cloud Hosted:</p> <ul> <li>Aliyun ARMS - <a href=https://www.alibabacloud.com/help/doc-detail/58652.htm>https://www.alibabacloud.com/help/doc-detail/58652.htm</a></li> <li>pricing: <a href=https://www.alibabacloud.com/tc/product/arms/pricing>https://www.alibabacloud.com/tc/product/arms/pricing</a></li> <li>Datadog - <a href=https://www.datadoghq.com/product/real-user-monitoring/ >https://www.datadoghq.com/product/real-user-monitoring/</a></li> <li>Micro Focus - <a href=https://www.microfocus.com/en-us/products/end-user-monitoring/overview>https://www.microfocus.com/en-us/products/end-user-monitoring/overview</a></li> </ul> <p>Self Hosted:</p> <ul> <li>Elastic - <a href=https://www.elastic.co/guide/en/apm/agent/rum-js/current/intro.html>https://www.elastic.co/guide/en/apm/agent/rum-js/current/intro.html</a></li> <li>boomerang - <a href=https://github.com/akamai/boomerang>https://github.com/akamai/boomerang</a></li> <li>server:<ul> <li>2018 <a href=https://github.com/springernature/boomcatch>https://github.com/springernature/boomcatch</a></li> <li>2016 <a href=https://github.com/andreas-marschke/boomerang-express>https://github.com/andreas-marschke/boomerang-express</a></li> </ul> </li> <li><a href=https://matomo.org/ >https://matomo.org/</a></li> <li>demo: <a href=https://demo.matomo.cloud/index.php>https://demo.matomo.cloud/index.php</a></li> <li><a href=https://github.com/basicrum/backoffice>https://github.com/basicrum/backoffice</a></li> </ul> <h2 id=2021-02-05>2021-02-05<a class=headerlink href=#2021-02-05 title="Permanent link">&para;</a></h2> <h3 id=kubernetes-use-annotation-and-initcontainer-to-donwload-gcs-files>Kubernetes - Use annotation and initContainer to donwload GCS files<a class=headerlink href=#kubernetes-use-annotation-and-initcontainer-to-donwload-gcs-files title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>selector</span><span class=p>:</span>
<span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span>
<span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">demo</span>
<span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<span class=w>    </span><span class=nt>metadata</span><span class=p>:</span>
<span class=w>      </span><span class=nt>labels</span><span class=p>:</span>
<span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">demo</span>
<span class=w>      </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>        </span><span class=nt>update</span><span class=p>:</span><span class=w> </span><span class=s>&quot;true&quot;</span>
<span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">assets</span>
<span class=w>        </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">{}</span>
<span class=w>      </span><span class=nt>initContainers</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">download-assets</span>
<span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">gcr.io/google.com/cloudsdktool/cloud-sdk:315.0.0-alpine</span>
<span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;/bin/bash&quot;</span><span class="p p-Indicator">,</span><span class=s>&quot;-c&quot;</span><span class="p p-Indicator">]</span>
<span class=w>        </span><span class=nt>env</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IF_UPDATE</span>
<span class=w>          </span><span class=nt>valueFrom</span><span class=p>:</span>
<span class=w>            </span><span class=nt>fieldRef</span><span class=p>:</span>
<span class=w>              </span><span class=nt>fieldPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">metadata.annotations[&#39;update&#39;]</span>
<span class=w>        </span><span class=nt>args</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="p p-Indicator">|</span>
<span class=w>          </span><span class=no>[ &quot;$IF_UPDATE&quot; = &quot;false&quot; ] &amp;&amp; exit 0</span>
<span class=w>          </span><span class=no>gsutil -m cp -r gs://rammus.tw/assets /assets</span>

<span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">assets</span>
<span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/assets</span>
<span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
<span class=w>        </span><span class=nt>ports</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">assets</span>
<span class=w>          </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/assets</span>
</code></pre></div> <h2 id=2021-01-26>2021-01-26<a class=headerlink href=#2021-01-26 title="Permanent link">&para;</a></h2> <h3 id=docker-build-a-userspace-wireguard-image>Docker - Build a userspace Wireguard image<a class=headerlink href=#docker-build-a-userspace-wireguard-image title="Permanent link">&para;</a></h3> <p><code>ghcr.io/linuxserver/wireguard</code> default to use Linux kernal library. If you want to use userspace library or your machine doesn't support Linux kernal library.</p> <div class=highlight><pre><span></span><code><span class=k>FROM</span><span class=w> </span><span class=s>rust:1.40-slim-buster</span><span class=w> </span><span class=k>AS</span><span class=w> </span><span class=s>builder</span>

<span class=k>ARG</span><span class=w> </span><span class=nv>BORINGTUN_VERSION</span><span class=o>=</span><span class=m>0</span>.3.0

<span class=k>RUN</span><span class=w> </span>cargo<span class=w> </span>install<span class=w> </span>boringtun<span class=w> </span>--version<span class=w> </span><span class=si>${</span><span class=nv>BORINGTUN_VERSION</span><span class=si>}</span>

<span class=c>###</span>

<span class=k>FROM</span><span class=w> </span><span class=s>ghcr.io/linuxserver/wireguard:version-v1.0.20200827</span>

<span class=k>COPY</span><span class=w> </span>--from<span class=o>=</span>builder<span class=w> </span>/usr/local/cargo/bin/boringtun<span class=w> </span>/usr/local/bin

<span class=k>ENV</span><span class=w> </span><span class=nv>WG_QUICK_USERSPACE_IMPLEMENTATION</span><span class=o>=</span>boringtun<span class=w> </span><span class=se>\</span>
<span class=w>    </span><span class=nv>WG_SUDO</span><span class=o>=</span><span class=m>1</span>
</code></pre></div> <h2 id=2021-01-25>2021-01-25<a class=headerlink href=#2021-01-25 title="Permanent link">&para;</a></h2> <h3 id=mongodb-get-wiredtiger-stats>MongoDB - Get wiredTiger stats<a class=headerlink href=#mongodb-get-wiredtiger-stats title="Permanent link">&para;</a></h3> <p>ref: <a href=https://docs.mongodb.com/manual/reference/command/serverStatus/#wiredtiger>https://docs.mongodb.com/manual/reference/command/serverStatus/#wiredtiger</a></p> <div class=highlight><pre><span></span><code>db.runCommand<span class=o>(</span><span class=w> </span><span class=o>{</span><span class=w> </span>serverStatus:<span class=w> </span><span class=m>1</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>)</span>.wiredTiger
</code></pre></div> <h2 id=2021-01-21>2021-01-21<a class=headerlink href=#2021-01-21 title="Permanent link">&para;</a></h2> <h3 id=mkdocs-material-lexers-code-block-supported-programming-languages>mkdocs-material lexers - code block supported programming languages<a class=headerlink href=#mkdocs-material-lexers-code-block-supported-programming-languages title="Permanent link">&para;</a></h3> <p><a href=https://squidfunk.github.io/mkdocs-material/reference/code-blocks/#specifying-the-language>mkdocs-material</a> 使用 <a href=https://pygments.org/docs/lexers/ >pygments</a> 當作語法分析器，以下是能支援的程式語言</p> <div class=highlight><pre><span></span><code>as3, actionscript3
as, actionscript
mxml
bc
gap
mathematica, mma, nb
mupad
at, ambienttalk, ambienttalk/2
ampl
apl
adl
cadl
odin
arrow
c-objdump
ca65
cpp-objdump, c++-objdumb, cxx-objdump
d-objdump
dasm16
gas, asm
hsail, hsa
llvm
llvm-mir-body
llvm-mir
nasm
objdump-nasm
objdump
tasm
autoit
ahk, autohotkey
bare
bbcbasic
blitzbasic, b3d, bplus
blitzmax, bmax
cbmbas
monkey
qbasic, basic
vbscript
bst, bst-pybtex
bib, bibtex
boa
abap
cobolfree
cobol
gooddata-cl
maql
openedge, abl, progress
c
cpp, c++
arduino
charmci
clay
cuda, cu
ec
mql, mq4, mq5, mql4, mql5
nesc
pike
swig
vala, vapi
capnp
chapel, chpl
clean
apacheconf, aconf, apache
augeas
cfengine3, cf3
docker, dockerfile
ini, cfg, dosini
kconfig, menuconfig, linux-config, kernel-config
lighty, lighttpd
nginx
pacmanconf
pkgconfig
properties, jproperties
registry
singularity
squidconf, squid.conf, squid
toml
termcap
terminfo
terraform, tf
pypylog, pypy
vctreestatus
cr, crystal
csound-document, csound-csd
csound, csound-orc
csound-score, csound-sco
css
less
sass
scss
croc
d
minid
smali
None
jsonld, json-ld
json, json-object
yaml
devicetree, dts
dpatch
diff, udiff
wdiff
boo
aspx-cs
csharp, c#
fsharp, f#
nemerle
aspx-vb
vb.net, vbnet
alloy
crmsh, pcmk
flatline
mscgen, msc
pan
protobuf, proto
puppet
rsl
snowball
thrift
vgl
zeek, bro
dylan-console, dylan-repl
dylan
dylan-lid, lid
ecl
eiffel
elm
email, eml
iex
elixir, ex, exs
erlang
erl
aheui
befunge
brainfuck, bf
camkes, idl4
capdl
redcode
ezhil
factor
fan
felix, flx
floscript, flo
forth
fortranfixed
fortran
foxpro, vfp, clipper, xbase
freefem
gdscript, gd
go
abnf
bnf
jsgf
peg
cypher
asy, asymptote
glsl
gnuplot
hlsl
postscript, postscr
pov
agda
cryptol, cry
haskell, hs
hspec
idris, idr
koka
lagda, literate-agda
lcry, literate-cryptol, lcryptol
lhs, literate-haskell, lhaskell
lidr, literate-idris, lidris
hx, haxe, hxsl
haxeml, hxml
systemverilog, sv
verilog, v
vhdl
hexdump
dtd
haml
html
pug, jade
scaml
xml
xslt
idl
igor, igorpro
limbo
control, debcontrol
nsis, nsi, nsh
spec
sourceslist, sources.list, debsources
inform6, i6
i6t
inform7, i7
tads3
io
j
coffee-script, coffeescript, coffee
dart
earl-grey, earlgrey, eg
js, javascript
juttle
kal
lasso, lassoscript
live-script, livescript
mask
objective-j, objectivej, obj-j, objj
ts, typescript
jlcon
julia, jl
aspectj
ceylon
clojure, clj
clojurescript, cljs
golo
gosu
gst
groovy
ioke, ik
jasmin, jasminxt
java
kotlin
pig
sarl
scala
xtend
cpsa
common-lisp, cl, lisp
emacs, elisp, emacs-lisp
fennel, fnl
hylang
newlisp
racket, rkt
scheme, scm
shen
extempore
basemake
cmake
make, makefile, mf, bsdmake
bbcode
groff, nroff, man
md, markdown
trac-wiki, moin
css+mozpreproc
mozhashpreproc
javascript+mozpreproc
mozpercentpreproc
xul+mozpreproc
rst, rest, restructuredtext
tex, latex
tid
matlab
matlabsession
octave
scilab
mime
fstar
ocaml
opa
reason, reasonml
sml
bugs, winbugs, openbugs
jags
modelica
stan
modula2, m2
monte
mosel
ncl
nim, nimrod
nit
nixos, nix
componentpascal, cp
logos
objective-c, objectivec, obj-c, objc
objective-c++, objectivec++, obj-c++, objc++
swift
ooc
parasail
antlr-as, antlr-actionscript
antlr-csharp, antlr-c#
antlr-cpp
antlr-java
antlr
antlr-objc
antlr-perl
antlr-python
antlr-ruby, antlr-rb
ebnf
ragel-c
ragel-cpp
ragel-d
ragel-em
ragel-java
ragel
ragel-objc
ragel-ruby, ragel-rb
treetop
ada, ada95, ada2005
delphi, pas, pascal, objectpascal
pawn
sp
perl6, pl6, raku
perl, pl
php, php3, php4, php5
psysh
zephir
pointless
pony
praat
logtalk
prolog
promql
cython, pyx, pyrex
dg
numpy
python2, py2
py2tb
pycon
python, py, sage, python3, py3
pytb, py3tb
qvto, qvt
rconsole, rout
rd
splus, s, r
shexc, shex
sparql
turtle
rebol
red, red/system
resource, resourcebundle
ride
rnc, rng-compact
roboconf-graph
roboconf-instances
robotframework
fancy, fy
rbcon, irb
rb, ruby, duby
rust, rs
sas
scdoc, scd
applescript
chai, chaiscript
easytrieve
hybris, hy
jcl
lsl
lua
moocode, moo
ms, miniscript
moon, moonscript
rexx, arexx
sgf
bash, sh, ksh, zsh, shell
console, shell-session
bat, batch, dosbatch, winbatch
execline
fish, fishshell
doscon
powershell, posh, ps1, psm1
ps1con
slurm, sbatch
tcsh, csh
tcshcon
sieve
slash
newspeak
smalltalk, squeak, st
nusmv
snobol
solidity
raw
text
mysql
plpgsql
psql, postgresql-console, postgres-console
postgresql, postgres
rql
sql
sqlite3
tsql, t-sql
stata, do
sc, supercollider
tcl
html+ng2
ng2
html+cheetah, html+spitfire, htmlcheetah
js+cheetah, javascript+cheetah, js+spitfire, javascript+spitfire
cheetah, spitfire
xml+cheetah, xml+spitfire
cfc
cfm
cfs
css+django, css+jinja
css+erb, css+ruby
css+genshitext, css+genshi
css+php
css+smarty
django, jinja
erb
html+evoque
evoque
xml+evoque
genshi, kid, xml+genshi, xml+kid
genshitext
html+handlebars
handlebars
html+django, html+jinja, htmldjango
html+genshi, html+kid
html+php
html+smarty
js+django, javascript+django, js+jinja, javascript+jinja
js+erb, javascript+erb, js+ruby, javascript+ruby
js+genshitext, js+genshi, javascript+genshitext, javascript+genshi
js+php, javascript+php
js+smarty, javascript+smarty
jsp
css+lasso
html+lasso
js+lasso, javascript+lasso
xml+lasso
liquid
css+mako
html+mako
js+mako, javascript+mako
mako
xml+mako
mason
css+myghty
html+myghty
js+myghty, javascript+myghty
myghty
xml+myghty
rhtml, html+erb, html+ruby
smarty
ssp
tea
html+twig
twig
html+velocity
velocity
xml+velocity
xml+django, xml+jinja
xml+erb, xml+ruby
xml+php
xml+smarty
yaml+jinja, salt, sls
ttl, teraterm, teratermmacro
cucumber, gherkin
tap
awk, gawk, mawk, nawk
vim
pot, po
http
irc
kmsg, dmesg
notmuch
todotxt
coq
isabelle
lean
tnt
rts, trafficscript
typoscriptcssdata
typoscripthtmldata
typoscript
icon
ucode
unicon
urbiscript
usd, usda
vcl
vclsnippets, vclsnippet
boogie
silver
webidl
cirru
duel, jbst, jsonml+bst
qml, qbs
slim
xquery, xqy, xq, xql, xqm
whiley
x10, xten
xorg.conf
yang
zig
</code></pre></div> <h2 id=2021-01-19>2021-01-19<a class=headerlink href=#2021-01-19 title="Permanent link">&para;</a></h2> <h3 id=ack-failed-to-provision-volume-with-storageclass-alicloud-disk-ssd-rpc-error-code-internal-desc-sdkservererror>ACK - failed to provision volume with StorageClass "alicloud-disk-ssd": rpc error: code = Internal desc = SDK.ServerError<a class=headerlink href=#ack-failed-to-provision-volume-with-storageclass-alicloud-disk-ssd-rpc-error-code-internal-desc-sdkservererror title="Permanent link">&para;</a></h3> <blockquote> <p>ErrorCode: InvalidDiskSize.NotSupported</p> </blockquote> <p>因為申請太小的容量，所以出現這個錯誤。</p> <p>ref: <a href=https://help.aliyun.com/document_detail/127601.html>https://help.aliyun.com/document_detail/127601.html</a></p> <ul> <li>高效云盘：最小20 GiB。</li> <li>SSD云盘：最小20 GiB。</li> <li>ESSD云盘：最小20 GiB。</li> </ul> <h3 id=nginx-use-nfs-to-share-proxy_cache>Nginx - Use NFS to share proxy_cache<a class=headerlink href=#nginx-use-nfs-to-share-proxy_cache title="Permanent link">&para;</a></h3> <div class=highlight><pre><span></span><code><span class=nx>proxy_cache_path</span><span class=w> </span><span class=o>/</span><span class=kd>var</span><span class=err>/cache/nginx levels=1:2 keys_zone=storage:128m inactive=1y max_size=64G use_temp_path=off;</span>
</code></pre></div> <p>Must to add <code>use_temp_path=off</code> which default to <code>on</code>.</p> <h2 id=2021-01-08>2021-01-08<a class=headerlink href=#2021-01-08 title="Permanent link">&para;</a></h2> <h3 id=gsutil-upload-file-to-aws-s3>gsutil - Upload file to AWS S3<a class=headerlink href=#gsutil-upload-file-to-aws-s3 title="Permanent link">&para;</a></h3> <p>Least AWS user permission. <div class=highlight><pre><span></span><code><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;Version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2012-10-17&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;Statement&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;Sid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;VisualEditor0&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>                </span><span class=s2>&quot;s3:PutObject&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=s2>&quot;s3:PutObjectAcl&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=s2>&quot;s3:GetObject&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=s2>&quot;s3:GetObjectAcl&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=s2>&quot;s3:DeleteObject&quot;</span>
<span class=w>            </span><span class=p>],</span>
<span class=w>            </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::backup.rammus.tw/*&quot;</span>
<span class=w>        </span><span class=p>},</span>
<span class=w>        </span><span class=p>{</span>
<span class=w>            </span><span class=nt>&quot;Sid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;VisualEditor1&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Effect&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Allow&quot;</span><span class=p>,</span>
<span class=w>            </span><span class=nt>&quot;Action&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>                </span><span class=s2>&quot;s3:ListBucket&quot;</span><span class=p>,</span>
<span class=w>                </span><span class=s2>&quot;s3:GetBucketLocation&quot;</span>
<span class=w>            </span><span class=p>],</span>
<span class=w>            </span><span class=nt>&quot;Resource&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;arn:aws:s3:::backup.rammus.tw&quot;</span>
<span class=w>        </span><span class=p>}</span>
<span class=w>    </span><span class=p>]</span>
<span class=p>}</span>
</code></pre></div></p> <p>Generate configuration <div class=highlight><pre><span></span><code><span class=nb>export</span><span class=w> </span><span class=nv>AWS_ACCESS_KEY_ID</span><span class=o>=</span>
<span class=nb>export</span><span class=w> </span><span class=nv>AWS_SECRET_ACCESS_KEY</span><span class=o>=</span>

cat<span class=w> </span><span class=s>&lt;&lt; EOF &gt; ~/.boto</span>
<span class=s>[Credentials]</span>
<span class=s>aws_access_key_id = $AWS_ACCESS_KEY_ID</span>
<span class=s>aws_secret_access_key = $AWS_SECRET_ACCESS_KEY</span>

<span class=s>[s3]</span>
<span class=s>calling_format = boto.s3.connection.OrdinaryCallingFormat</span>
<span class=s>use-sigv4=True</span>
<span class=s>host=s3.ap-northeast-1.amazonaws.com</span>
<span class=s>EOF</span>
</code></pre></div></p> <p>Start to uplaod <div class=highlight><pre><span></span><code>gsutil<span class=w> </span>cp<span class=w> </span>a<span class=w> </span>s3://backup.rammus.tw
</code></pre></div></p> <aside class=md-source-file> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 8, 2024</span> </span> <span class=md-source-file__fact> <span class=md-icon title=Created> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 8, 2024</span> </span> </aside> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> <a href=http://creativecommons.org/licenses/by-nc-nd/4.0/ rel=license><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png></a> <br> Copyright © 2015- Rammus Xu </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/rammusxu target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://www.linkedin.com/in/rammusxu target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.fe8b6f2b.min.js></script> <script src=https://unpkg.com/tablesort@5.3.0/dist/tablesort.min.js></script> <script src=../../javascripts/tablesort.js></script> </body> </html>